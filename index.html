<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NATRIS HR Integrated Portal</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --gw-main: #2563eb; --gw-sidebar: #1e293b; --gw-bg: #f8fafc;
            --gw-border: #e2e8f0; --text-strong: #0f172a; --text-body: #334155;
            --text-sub: #64748b; --white: #ffffff; --point-orange: #f59e0b; --naver-green: #03c75a;
            --danger: #ef4444; --slack-purple: #4a154b;
        }
        * { box-sizing: border-box; transition: all 0.2s ease-out; }
        body { margin: 0; font-family: "Pretendard Variable", sans-serif; color: var(--text-body); background-color: var(--gw-bg); display: flex; min-height: 100vh; overflow: hidden; }

        /* --- ë¡œê·¸ì¸ --- */
        #loginOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 40px; border-radius: 16px; text-align: center; width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .login-divider { display: flex; align-items: center; margin: 25px 0; color: var(--text-sub); font-size: 13px; }
        .login-divider::before, .login-divider::after { content: ""; flex: 1; height: 1px; background: var(--gw-border); }
        .login-divider span { padding: 0 15px; }
        .btn-google { width: 100%; padding: 14px; background: white; color: #333; border: 1px solid var(--gw-border); border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-google:hover { background: #f8fafc; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn-google img { width: 20px; height: 20px; }
        
        /* --- ì‚¬ìš©ì ì •ë³´ ë“œë¡­ë‹¤ìš´ --- */
        .user-info-wrapper { position: relative; }
        .user-info { display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 8px 16px; border-radius: 8px; }
        .user-info:hover { background: var(--gw-bg); }
        .user-avatar { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--gw-main); }
        .user-dropdown { position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border: 1px solid var(--gw-border); border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); min-width: 250px; display: none; z-index: 100; }
        .user-dropdown.show { display: block; }
        .dropdown-header { padding: 20px; border-bottom: 1px solid var(--gw-border); }
        .dropdown-menu { padding: 8px 0; }
        .dropdown-item { padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; color: var(--text-body); }
        .dropdown-item:hover { background: var(--gw-bg); }
        .dropdown-item.danger { color: var(--danger); }
        .dropdown-item.danger:hover { background: #fef2f2; }
        
        .logout-btn { padding: 8px 16px; background: var(--danger); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; margin-left: 10px; }
        .logout-btn:hover { background: #dc2626; }

        /* --- ê¶Œí•œ ì•ˆë‚´ ë°°ì§€ --- */
        .permission-badge { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 700; margin-left: 10px; }
        .badge-admin { background: #fef3c7; color: #92400e; }
        .badge-user { background: #dbeafe; color: #1e40af; }

        /* --- ì‚¬ì´ë“œë°” --- */
        nav { width: 250px; background: var(--gw-sidebar); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .nav-header { padding: 30px 24px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .nav-menu { padding: 20px 0; flex: 1; overflow-y: auto; }
        .nav-footer { padding: 20px 24px; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-footer-btn { width: 100%; padding: 12px; background: rgba(239, 68, 68, 0.1); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .nav-footer-btn:hover { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .menu-cat { padding: 15px 24px 5px; font-size: 11px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        .menu-item { padding: 13px 24px; display: block; color: #cbd5e1; text-decoration: none; font-size: 14px; cursor: pointer; border-left: 4px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; padding-left: 32px; }
        .menu-item.active { background: rgba(37, 99, 235, 0.15); color: #60a5fa; font-weight: 700; border-left: 4px solid var(--gw-main); }
        .logo-text { font-size: 25pt; font-weight: 900; color: #000; background: #fff; display: block; padding: 10px 0; border-radius: 4px; margin: 20px; text-align: center; }

        /* --- ë©”ì¸ ì˜ì—­ --- */
        #mainContent { display: none; width: 100%; height: 100vh; }
        #mainContent.auth-success { display: flex; }
        .container { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        header { height: 64px; background: var(--white); border-bottom: 1px solid var(--gw-border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; position: sticky; top: 0; z-index: 10; }
        main { padding: 30px; display: none; max-width: 1400px; animation: fadeIn 0.4s ease-out; }
        main.active { display: block; }

        /* --- UI ì¹´ë“œ & ë²„íŠ¼ --- */
        .card { background: var(--white); border-radius: 12px; border: 1px solid var(--gw-border); overflow: hidden; margin-bottom: 24px; }
        .card-header { padding: 18px 24px; border-bottom: 1px solid var(--gw-border); background: #fafafa; font-weight: 700; }
        .card-body { padding: 20px 24px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .btn-primary { width: 100%; padding: 12px; background: var(--gw-main); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-naver { background: var(--naver-green); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-naver:hover { background: #02b350; }
        .input-box { width: 100%; padding: 10px; border: 1px solid var(--gw-border); border-radius: 6px; margin-bottom: 10px; font-size: 14px; }

        /* --- í†µê³„ ì¹´ë“œ --- */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, var(--gw-main) 0%, #1d4ed8 100%); color: white; padding: 20px; border-radius: 12px; }
        .stat-value { font-size: 32px; font-weight: 900; margin: 10px 0; }
        .stat-label { font-size: 13px; opacity: 0.9; }

        /* --- íšŒì‹ ê²€ìƒ‰ ìŠ¤íƒ€ì¼ --- */
        .search-box { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 30px; border-radius: 12px; color: white; margin-bottom: 30px; }
        .search-row { display: grid; grid-template-columns: 1fr 1fr 1.5fr 1fr; gap: 15px; margin-bottom: 15px; }
        .search-input { padding: 12px; border-radius: 6px; width: 100%; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.1); }
        .search-input option { color: #000; }
        .restaurant-card { border: 1px solid var(--gw-border); border-radius: 12px; padding: 20px; margin-bottom: 20px; background: white; cursor: pointer; position: relative; }
        .restaurant-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .room-badge { position: absolute; top: 20px; right: 20px; background: #eef2ff; color: var(--gw-main); padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 700; }
        .room-info { background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px dashed #cbd5e1; }
        .owner-badge { position: absolute; bottom: 20px; right: 20px; background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; }

        /* --- í–‰ì • ë§í¬ ìŠ¤íƒ€ì¼ --- */
        .link-card { text-align: center; text-decoration: none; color: var(--text-body); padding: 15px; border: 1px solid var(--gw-border); border-radius: 12px; background: #fff; font-size: 13px; }
        .link-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .link-card img { width: 32px; height: 32px; margin-bottom: 8px; border-radius: 6px; }
        .calendar-wrapper { position: relative; padding-bottom: 60%; height: 0; overflow: hidden; border-radius: 12px; border: 1px solid var(--gw-border); }
        .calendar-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }

        /* --- ëª¨ë‹¬ --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 16px; max-width: 500px; width:90%; padding: 30px; }

        /* --- ë°ì´í„° ì†Œìœ ì í‘œì‹œ --- */
        .data-owner-info { background: #f0f9ff; border: 1px solid #bae6fd; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; color: #0c4a6e; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h1 style="color:var(--gw-main); font-weight:900; margin-bottom:10px;">NATRIS</h1>
            <p style="color:var(--text-sub); font-size:14px; margin-bottom:30px;">HR í†µí•© í¬í„¸ ì‹œìŠ¤í…œ</p>
            
            <!-- êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ -->
            <button class="btn-google" onclick="googleLogin()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                <span>Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</span>
            </button>

            <div class="login-divider">
                <span>ë˜ëŠ” ì§ì› ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</span>
            </div>

            <!-- ì‚¬ìš©ì ì„ íƒ -->
            <select id="userSelect" class="input-box" style="margin-bottom:15px;">
                <option value="">ì‚¬ìš©ì ì„ íƒ</option>
                <option value="user1@natris.com">ê¹€ë‚˜íŠ¸</option>
                <option value="user2@natris.com">ì´ë¦¬ìŠ¤</option>
                <option value="user3@natris.com">ë°•í¬íƒˆ</option>
            </select>

            <input type="password" id="pwInput" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="if(event.keyCode==13) checkPassword()">
            <button class="btn-primary" onclick="checkPassword()">ì§ì› ê³„ì •ìœ¼ë¡œ ì ‘ì†</button>
            
            <p style="font-size:12px; color:var(--text-sub); margin-top:20px;">
                ğŸ”’ ë³´ì•ˆ ì¸ì¦ í›„ ì‹œìŠ¤í…œ ì´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤<br>
                ğŸ‘¥ ê° ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </p>
        </div>
    </div>

    <div id="mainContent">
        <nav>
            <div class="nav-header">
                <h3>ğŸ’  HR PORTAL</h3>
                <div id="userRoleDisplay" style="font-size:11px; color:#94a3b8; margin-top:8px;"></div>
            </div>
            <div class="nav-menu">
                <div class="menu-cat">Dashboard</div>
                <div class="menu-item active" onclick="showPage('page-dashboard', this)">ğŸ“Š ë‚´ ëŒ€ì‹œë³´ë“œ</div>
                
                <div class="menu-cat">Management</div>
                <div class="menu-item" onclick="showPage('page-home', this)">ğŸ“… ì „ì‚¬ ì¼ì •</div>
                <div class="menu-item" onclick="showPage('page-supply', this)">ğŸ›’ ë¹„í’ˆ/íƒë°° ê´€ë¦¬</div>
                <div class="menu-item" onclick="showPage('page-insure', this)">ğŸ›¡ï¸ 4ëŒ€ë³´í—˜ ê³µë‹¨</div>
                
                <div class="menu-cat">Welfare</div>
                <div class="menu-item" onclick="showPage('page-dinner', this)">ğŸ´ íšŒì‹/ë£¸ ê²€ìƒ‰</div>
                <div class="menu-item" onclick="showPage('page-room-admin', this)">âš™ï¸ ë‚´ ë£¸ ì •ë³´ ê´€ë¦¬</div>
            </div>
            <div class="logo-text">NATRIS</div>
            
            <!-- ì‚¬ì´ë“œë°” í•˜ë‹¨ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
            <div class="nav-footer">
                <button class="nav-footer-btn" onclick="logout()">
                    ğŸšª <span>ë¡œê·¸ì•„ì›ƒ</span>
                </button>
            </div>
        </nav>

        <div class="container">
            <header>
                <div id="dateDisplay" style="font-weight: 600;"></div>
                <div style="display:flex; align-items:center;">
                    <div id="timeDisplay" style="font-weight:700; color:var(--gw-main); font-size: 18px; margin-right:20px;"></div>
                    <div class="user-info-wrapper">
                        <div id="userInfoDisplay"></div>
                        <!-- ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
                        <div id="userDropdown" class="user-dropdown">
                            <div class="dropdown-header">
                                <div id="dropdown-user-name" style="font-weight:700; font-size:15px; margin-bottom:4px;"></div>
                                <div id="dropdown-user-email" style="font-size:12px; color:var(--text-sub);"></div>
                            </div>
                            <div class="dropdown-menu">
                                <div class="dropdown-item" onclick="showPage('page-dashboard', document.querySelector('.menu-item')); toggleUserDropdown()">
                                    ğŸ“Š ë‚´ ëŒ€ì‹œë³´ë“œ
                                </div>
                                <div class="dropdown-item" onclick="showPage('page-room-admin', document.querySelectorAll('.menu-item')[5]); toggleUserDropdown()">
                                    âš™ï¸ ë‚´ ë£¸ ê´€ë¦¬
                                </div>
                                <div class="dropdown-item danger" onclick="logout()">
                                    ğŸšª ë¡œê·¸ì•„ì›ƒ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- ìƒˆë¡œìš´ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
            <main id="page-dashboard" class="active">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                    <div>
                        <h2 style="margin:0;">ğŸ“Š ë‚´ ëŒ€ì‹œë³´ë“œ</h2>
                        <p style="color:var(--text-sub); margin:5px 0 0 0;">ë‚´ê°€ ë“±ë¡í•œ ë°ì´í„° í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</p>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <div class="stat-label">ğŸ“ ë‚´ê°€ ë“±ë¡í•œ ì‹ë‹¹</div>
                        <div class="stat-value" id="myRestaurantCount">0</div>
                        <div style="font-size:12px; opacity:0.8;">ê°œ</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <div class="stat-label">ğŸšª ë“±ë¡ëœ ë£¸ ìˆ˜</div>
                        <div class="stat-value" id="myRoomCount">0</div>
                        <div style="font-size:12px; opacity:0.8;">ê°œ</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <div class="stat-label">ğŸ“ ë“±ë¡ ì§€ì—­ ìˆ˜</div>
                        <div class="stat-value" id="myLocationCount">0</div>
                        <div style="font-size:12px; opacity:0.8;">ê³³</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">ğŸ¢ ë‚´ê°€ ë“±ë¡í•œ ì‹ë‹¹ ëª©ë¡</div>
                    <div class="card-body">
                        <div id="myRestaurantList" style="max-height:500px; overflow-y:auto;"></div>
                    </div>
                </div>
            </main>

            <main id="page-home">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="margin:0;">ğŸ“… ì „ì‚¬ ê³µìš© ì¼ì •</h2>
                    <button class="btn-primary" style="width:auto;" onclick="window.open('https://calendar.google.com', '_blank')">ì¼ì • ìˆ˜ì •í•˜ê¸°</button>
                </div>
                <div class="calendar-wrapper">
                    <iframe src="https://calendar.google.com/calendar/embed?src=ko.south_korea%23holiday%40group.v.calendar.google.com&ctz=Asia%2FSeoul"></iframe>
                </div>
            </main>

            <main id="page-supply">
                <h2>ğŸ›’ ë¹„í’ˆ ë° íƒë°° ê´€ë¦¬</h2>
                <div class="card">
                    <div class="card-header">êµ¬ë§¤ ì‚¬ì´íŠ¸ í€µë§í¬</div>
                    <div class="card-body grid-4">
                        <a href="https://www.coupang.com" target="_blank" class="link-card"><img src="https://image7.coupangcdn.com/image/coupang/favicon/v2/favicon.ico"><div>ì¿ íŒ¡</div></a>
                        <a href="https://www.coffee.co.kr" target="_blank" class="link-card"><img src="https://www.coffee.co.kr/favicon.ico"><div>ì»¤í”¼ëª°</div></a>
                        <a href="https://www.naver.com" target="_blank" class="link-card"><img src="https://www.naver.com/favicon.ico"><div>ë„¤ì´ë²„</div></a>
                        <a href="https://www.officedepot.co.kr" target="_blank" class="link-card"><img src="https://www.officedepot.co.kr/favicon.ico"><div>ì˜¤í”¼ìŠ¤ë””í¬</div></a>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">ğŸ“¦ íƒë°° í†µí•© ì¡°íšŒ</div>
                    <div class="card-body">
                        <input type="text" id="trackingNum" class="input-box" placeholder="ìš´ì†¡ì¥ ë²ˆí˜¸ ì…ë ¥">
                        <button class="btn-naver" onclick="window.open('https://search.naver.com/search.naver?query=íƒë°°ì¡°íšŒ+'+document.getElementById('trackingNum').value)">ë„¤ì´ë²„ íƒë°°ì¡°íšŒ ì—°ê²°</button>
                    </div>
                </div>
            </main>

            <main id="page-insure">
                <h2>ğŸ›¡ï¸ 4ëŒ€ë³´í—˜ ë° ì‹ ê³  ì‚¬ì´íŠ¸</h2>
                <div class="grid-4">
                    <a href="https://www.4insure.or.kr" target="_blank" class="link-card"><strong>4ëŒ€ì‚¬íšŒë³´í—˜</strong></a>
                    <a href="https://total.comwel.or.kr" target="_blank" class="link-card"><strong>ê³ ìš©ì‚°ì¬í† íƒˆ</strong></a>
                    <a href="https://www.hometax.go.kr" target="_blank" class="link-card"><strong>êµ­ì„¸ì²­ í™ˆíƒìŠ¤</strong></a>
                    <a href="https://www.nhis.or.kr" target="_blank" class="link-card"><strong>ê±´ê°•ë³´í—˜ê³µë‹¨</strong></a>
                </div>
            </main>

            <main id="page-dinner">
                <div class="data-owner-info">
                    â„¹ï¸ <strong>ëª¨ë“  ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì‹ë‹¹</strong>ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì‹ë‹¹ ì¹´ë“œì— ë“±ë¡ì ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                <div class="search-box">
                    <h2 style="margin-top:0;">ğŸ” íšŒì‹ ë£¸ ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰</h2>
                    <div class="search-row">
                        <div><label style="font-size:12px; opacity:0.8;">ğŸ‘¥ ì¸ì›ìˆ˜</label><input type="number" id="roomPartySize" class="search-input" value="10"></div>
                        <div><label style="font-size:12px; opacity:0.8;">ğŸ“ ì§€ì—­</label>
                            <select id="roomLocation" class="search-input">
                                <option value="">ì „ì²´ ì§€ì—­</option>
                                <optgroup label="ë™ë‚¨ê¶Œ (ê°•ë‚¨/ì†¡íŒŒ)">
                                    <option value="ê°•ë‚¨êµ¬">ê°•ë‚¨êµ¬ (ì—­ì‚¼/ì‚¼ì„±/ë…¼í˜„)</option>
                                    <option value="ì„œì´ˆêµ¬">ì„œì´ˆêµ¬ (êµëŒ€/ê°•ë‚¨ì—­)</option>
                                    <option value="ì†¡íŒŒêµ¬">ì†¡íŒŒêµ¬ (ì ì‹¤/ë°©ì´)</option>
                                    <option value="ê°•ë™êµ¬">ê°•ë™êµ¬ (ì²œí˜¸)</option>
                                </optgroup>
                                <optgroup label="ë„ì‹¬ê¶Œ (ì¢…ë¡œ/ì¤‘êµ¬)">
                                    <option value="ì¢…ë¡œêµ¬">ì¢…ë¡œêµ¬ (ê´‘í™”ë¬¸/ì¢…ê°)</option>
                                    <option value="ì¤‘êµ¬">ì¤‘êµ¬ (ì„ì§€ë¡œ/ëª…ë™/ì‹œì²­)</option>
                                    <option value="ìš©ì‚°êµ¬">ìš©ì‚°êµ¬ (í•œë‚¨/ì´íƒœì›/ìš©ì‚°)</option>
                                </optgroup>
                                <optgroup label="ì„œë¶ê¶Œ (ë§ˆí¬/ì„œëŒ€ë¬¸)">
                                    <option value="ë§ˆí¬êµ¬">ë§ˆí¬êµ¬ (í™ëŒ€/í•©ì •/ê³µë•)</option>
                                    <option value="ì„œëŒ€ë¬¸êµ¬">ì„œëŒ€ë¬¸êµ¬ (ì‹ ì´Œ)</option>
                                    <option value="ì€í‰êµ¬">ì€í‰êµ¬</option>
                                </optgroup>
                                <optgroup label="ì„œë‚¨ê¶Œ (ì—¬ì˜ë„/êµ¬ë¡œ)">
                                    <option value="ì˜ë“±í¬êµ¬">ì˜ë“±í¬êµ¬ (ì—¬ì˜ë„/ë‹¹ì‚°)</option>
                                    <option value="êµ¬ë¡œêµ¬">êµ¬ë¡œêµ¬ (êµ¬ë¡œë””ì§€í„¸)</option>
                                    <option value="ê¸ˆì²œêµ¬">ê¸ˆì²œêµ¬ (ê°€ì‚°ë””ì§€í„¸)</option>
                                    <option value="ê°•ì„œêµ¬">ê°•ì„œêµ¬ (ë§ˆê³¡/ë°œì‚°)</option>
                                    <option value="ê´€ì•…êµ¬">ê´€ì•…êµ¬ (ì„œìš¸ëŒ€ì…êµ¬)</option>
                                    <option value="ë™ì‘êµ¬">ë™ì‘êµ¬ (ì‚¬ë‹¹/ë…¸ëŸ‰ì§„)</option>
                                    <option value="ì–‘ì²œêµ¬">ì–‘ì²œêµ¬</option>
                                </optgroup>
                                <optgroup label="ë™ë¶ê¶Œ (ì„±ë™/ê´‘ì§„)">
                                    <option value="ì„±ë™êµ¬">ì„±ë™êµ¬ (ì„±ìˆ˜/ì™•ì‹­ë¦¬)</option>
                                    <option value="ê´‘ì§„êµ¬">ê´‘ì§„êµ¬ (ê±´ëŒ€)</option>
                                    <option value="ë™ëŒ€ë¬¸êµ¬">ë™ëŒ€ë¬¸êµ¬</option>
                                    <option value="ì¤‘ë‘êµ¬">ì¤‘ë‘êµ¬</option>
                                    <option value="ì„±ë¶êµ¬">ì„±ë¶êµ¬</option>
                                    <option value="ê°•ë¶êµ¬">ê°•ë¶êµ¬</option>
                                    <option value="ë„ë´‰êµ¬">ë„ë´‰êµ¬</option>
                                    <option value="ë…¸ì›êµ¬">ë…¸ì›êµ¬</option>
                                </optgroup>
                                <optgroup label="ê²½ê¸° ì£¼ìš”">
                                    <option value="íŒêµ">íŒêµ/ë¶„ë‹¹</option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€ ì§€ì—­</option>
                                </optgroup>
                            </select>
                        </div>
                        <div><label style="font-size:12px; opacity:0.8;">ğŸ½ï¸ ë©”ë‰´ íƒ€ì…</label>
                            <select id="roomCategory" class="search-input">
                                <option value="">ì „ì²´</option><option value="ê³ ê¸°" selected>ê³ ê¸°</option><option value="ì¼ì‹">ì¼ì‹</option><option value="í•œì‹">í•œì‹</option><option value="ì¤‘ì‹">ì¤‘ì‹</option><option value="ì–‘ì‹">ì–‘ì‹/í¬ì°¨</option>
                            </select>
                        </div>
                        <div><label style="font-size:12px; opacity:0.8;">ğŸ¢ ì‹ë‹¹ëª…</label><input type="text" id="roomNameSearch" class="search-input" placeholder="ì´ë¦„ ì…ë ¥"></div>
                    </div>
                    <div class="grid-2">
                        <button class="btn-primary" onclick="searchRooms()">ì‚¬ë‚´ DBì—ì„œ ì°¾ê¸°</button>
                        <button class="btn-naver" onclick="searchNaverMaps()">ë„¤ì´ë²„ ì§€ë„ë¡œ ì°¾ê¸°</button>
                    </div>
                </div>
                <div id="searchResults"></div>
            </main>

            <main id="page-room-admin">
                <div class="data-owner-info">
                    â„¹ï¸ ì—¬ê¸°ì— ë“±ë¡í•œ ì‹ë‹¹ì€ <strong>ë‚´ ê³„ì •ì—ë§Œ ì—°ê²°</strong>ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </div>
                <div class="card">
                    <div class="card-header">ğŸª ì‹ë‹¹ ë° ë£¸ ë“±ë¡</div>
                    <div class="card-body">
                        <div class="grid-2">
                            <input type="text" id="adminRestName" class="input-box" placeholder="ì‹ë‹¹ëª… *">
                            <select id="adminLocation" class="input-box">
                                <option value="ê°•ë‚¨êµ¬">ê°•ë‚¨êµ¬ (ì—­ì‚¼/ì‚¼ì„±/ë…¼í˜„)</option>
                                <option value="ì„œì´ˆêµ¬">ì„œì´ˆêµ¬ (êµëŒ€/ê°•ë‚¨ì—­)</option>
                                <option value="ì†¡íŒŒêµ¬">ì†¡íŒŒêµ¬ (ì ì‹¤/ë°©ì´)</option>
                                <option value="ì˜ë“±í¬êµ¬">ì˜ë“±í¬êµ¬ (ì—¬ì˜ë„)</option>
                                <option value="ì¢…ë¡œêµ¬">ì¢…ë¡œêµ¬ (ê´‘í™”ë¬¸)</option>
                                <option value="ì¤‘êµ¬">ì¤‘êµ¬ (ì„ì§€ë¡œ)</option>
                                <option value="ë§ˆí¬êµ¬">ë§ˆí¬êµ¬ (í™ëŒ€/ê³µë•)</option>
                                <option value="ìš©ì‚°êµ¬">ìš©ì‚°êµ¬ (í•œë‚¨/ìš©ì‚°)</option>
                                <option value="ì„±ë™êµ¬">ì„±ë™êµ¬ (ì„±ìˆ˜)</option>
                                <option value="ê´‘ì§„êµ¬">ê´‘ì§„êµ¬ (ê±´ëŒ€)</option>
                                <option value="ê°•ì„œêµ¬">ê°•ì„œêµ¬ (ë§ˆê³¡)</option>
                                <option value="êµ¬ë¡œêµ¬">êµ¬ë¡œêµ¬ (êµ¬ë””)</option>
                                <option value="ê¸ˆì²œêµ¬">ê¸ˆì²œêµ¬ (ê°€ë””)</option>
                                <option value="ë™ì‘êµ¬">ë™ì‘êµ¬ (ì‚¬ë‹¹)</option>
                                <option value="ì„œëŒ€ë¬¸êµ¬">ì„œëŒ€ë¬¸êµ¬ (ì‹ ì´Œ)</option>
                                <option value="íŒêµ">íŒêµ/ë¶„ë‹¹</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€ ì§€ì—­</option>
                            </select>
                            <input type="text" id="adminPhone" class="input-box" placeholder="ì „í™”ë²ˆí˜¸">
                            <select id="adminCategory" class="input-box">
                                <option value="ê³ ê¸°">ê³ ê¸°/êµ¬ì´</option><option value="ì¼ì‹">ì¼ì‹</option><option value="í•œì‹">í•œì‹</option><option value="ì¤‘ì‹">ì¤‘ì‹</option><option value="ì–‘ì‹">ì–‘ì‹/í¬ì°¨</option>
                            </select>
                        </div>
                        <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-top: 10px; border: 1px solid var(--gw-border);">
                            <h4 style="margin-top:0">ğŸšª ë£¸ ìƒì„¸ ì •ë³´</h4>
                            <div class="grid-2">
                                <input type="text" id="adminRoomName" class="input-box" placeholder="ë£¸ ì´ë¦„ (ì˜ˆ: VIPì‹¤)">
                                <div style="display:flex; gap:5px;"><input type="number" id="adminMinCap" class="input-box" placeholder="ìµœì†Œ"><input type="number" id="adminMaxCap" class="input-box" placeholder="ìµœëŒ€"></div>
                            </div>
                        </div>
                        <button class="btn-primary" id="addBtn" style="margin-top:20px;" onclick="addRestaurant()">ğŸ’¾ ë‚´ DBì— ë“±ë¡</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">ğŸ“‹ ë‚´ê°€ ë“±ë¡í•œ ì‹ë‹¹ ëª©ë¡</div>
                    <div class="card-body">
                        <div id="myRestaurantsAdmin"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <h2 id="m-title" style="margin-top:0; color:var(--gw-main);"></h2>
            <div id="m-body" style="line-height:1.6; font-size:15px; margin-bottom: 20px;"></div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px;">
                <button class="btn-primary" id="m-call-btn">ğŸ“ ì „í™”</button>
                <button class="btn-naver" id="m-map-btn">ğŸ“ ì§€ë„</button>
                <button class="btn-primary" style="background:var(--danger);" id="m-delete-btn">ğŸ—‘ï¸ ì‚­ì œ</button>
            </div>
            <button class="btn-primary" style="background:#64748b; margin-top:10px;" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyDCNQACd79vDnnEE0XMkH0zDAHStDBGHdI",
            authDomain: "hrgroup-f280c.firebaseapp.com",
            projectId: "hrgroup-f280c",
            storageBucket: "hrgroup-f280c.firebasestorage.app",
            messagingSenderId: "438389766938",
            appId: "1:438389766938:web:dfeaa77a130c108d93caa3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´
        let currentUser = null;
        let currentUserEmail = null;
        let currentUserName = null;
        let currentUserRole = null;

        // ì‚¬ìš©ì ê³„ì • ì •ë³´
        const userAccounts = {
            'user1@natris.com': { password: '1234', name: 'ê¹€ë‚˜íŠ¸', role: 'HRíŒ€ì¥' },
            'user2@natris.com': { password: '5678', name: 'ì´ë¦¬ìŠ¤', role: 'HRë‹´ë‹¹' },
            'user3@natris.com': { password: '9012', name: 'ë°•í¬íƒˆ', role: 'ì´ë¬´' }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                currentUserEmail = user.email;
                onLoginSuccess();
            }
        });

        // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ê°ì§€
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('userDropdown');
            const userInfo = document.getElementById('userInfoDisplay');
            if (dropdown && userInfo && !userInfo.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ í† ê¸€
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // êµ¬ê¸€ ë¡œê·¸ì¸ í•¨ìˆ˜
        async function googleLogin() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                const result = await auth.signInWithPopup(provider);
                currentUser = result.user;
                currentUserEmail = result.user.email;
                
                console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', currentUser.displayName);
                onLoginSuccess();
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    alert('ë¡œê·¸ì¸ ì°½ì´ ë‹«í˜”ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } else if (error.code === 'auth/popup-blocked') {
                    alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }

        // ì§ì› ê³„ì • ë¡œê·¸ì¸
        function checkPassword() {
            const selectedUser = document.getElementById('userSelect').value;
            const pw = document.getElementById('pwInput').value;
            
            if (!selectedUser) {
                alert("ì‚¬ìš©ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }
            
            const userInfo = userAccounts[selectedUser];
            
            if (userInfo && pw === userInfo.password) {
                currentUserEmail = selectedUser;
                currentUserName = userInfo.name;
                currentUserRole = userInfo.role;
                
                console.log('âœ… ì§ì› ë¡œê·¸ì¸ ì„±ê³µ:', currentUserName);
                onLoginSuccess();
            } else { 
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); 
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logout() {
            if (confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì €ì¥ë˜ì§€ ì•Šì€ ì‘ì—…ì´ ìˆë‹¤ë©´ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”.')) {
                try {
                    await auth.signOut();
                    
                    currentUser = null;
                    currentUserEmail = null;
                    currentUserName = null;
                    currentUserRole = null;
                    
                    document.getElementById('loginOverlay').style.display = 'flex';
                    document.getElementById('mainContent').classList.remove('auth-success');
                    document.getElementById('userDropdown').classList.remove('show');
                    
                    document.querySelectorAll('main').forEach(m => m.classList.remove('active'));
                    document.getElementById('page-dashboard').classList.add('active');
                    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.menu-item')[0].classList.add('active');
                    
                    console.log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                    
                    setTimeout(() => {
                        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }, 100);
                    
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì²˜ë¦¬
        function onLoginSuccess() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContent').classList.add('auth-success');
            startClock();
            updateUserDisplay();
            loadDashboard();
            loadMyRestaurantsAdmin();
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateUserDisplay() {
            const userDisplay = document.getElementById('userInfoDisplay');
            const roleDisplay = document.getElementById('userRoleDisplay');
            const dropdownName = document.getElementById('dropdown-user-name');
            const dropdownEmail = document.getElementById('dropdown-user-email');
            
            if (currentUser) {
                const photoURL = currentUser.photoURL || 'https://via.placeholder.com/36';
                const displayName = currentUser.displayName || currentUser.email;
                
                userDisplay.innerHTML = `
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <img src="${photoURL}" alt="User" class="user-avatar">
                        <div style="text-align:left;">
                            <div style="font-size:13px; font-weight:600;">${displayName}</div>
                            <div style="font-size:11px; color:var(--text-sub);">${currentUser.email}</div>
                        </div>
                        <div style="font-size:10px; color:var(--text-sub);">â–¼</div>
                    </div>
                `;
                
                roleDisplay.innerHTML = `ğŸ‘¤ ì‚¬ìš©ì: ${displayName}`;
                dropdownName.innerText = displayName;
                dropdownEmail.innerText = currentUser.email;
            } else if (currentUserEmail) {
                const displayName = currentUserName || 'ì§ì›';
                const userRole = currentUserRole || 'ì§ì›';
                
                const initial = displayName.charAt(0);
                const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
                const color = colors[displayName.charCodeAt(0) % colors.length];
                
                userDisplay.innerHTML = `
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <div style="width:36px; height:36px; border-radius:50%; background:${color}; display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:16px;">${initial}</div>
                        <div style="text-align:left;">
                            <div style="font-size:13px; font-weight:600;">${displayName} (${userRole})</div>
                            <div style="font-size:11px; color:var(--text-sub);">${currentUserEmail}</div>
                        </div>
                        <div style="font-size:10px; color:var(--text-sub);">â–¼</div>
                    </div>
                `;
                
                roleDisplay.innerHTML = `ğŸ‘¤ ${displayName} (${userRole})`;
                dropdownName.innerText = `${displayName} (${userRole})`;
                dropdownEmail.innerText = currentUserEmail;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ë¡œë“œ
        async function loadDashboard() {
            if (!currentUserEmail && !currentUser) return;
            
            const userEmail = currentUserEmail || currentUser.email;
            
            try {
                const snap = await db.collection('restaurants')
                    .where('createdBy', '==', userEmail)
                    .get();
                
                let totalRooms = 0;
                let locations = new Set();
                let listHtml = '';
                
                snap.forEach(doc => {
                    const data = doc.data();
                    totalRooms += data.rooms.length;
                    locations.add(data.location);
                    
                    listHtml += `
                        <div style="border-bottom:1px solid var(--gw-border); padding:15px 0;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <div style="font-weight:700; font-size:16px;">${data.name}</div>
                                    <div style="color:var(--text-sub); font-size:13px; margin-top:4px;">
                                        ğŸ“ ${data.location} Â· ğŸ½ï¸ ${data.category} Â· ğŸšª ë£¸ ${data.rooms.length}ê°œ
                                    </div>
                                </div>
                                <button class="btn-primary" style="width:80px; padding:8px; font-size:12px;" onclick="deleteMyRestaurant('${doc.id}')">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('myRestaurantCount').innerText = snap.size;
                document.getElementById('myRoomCount').innerText = totalRooms;
                document.getElementById('myLocationCount').innerText = locations.size;
                document.getElementById('myRestaurantList').innerHTML = listHtml || '<div style="text-align:center; padding:40px; color:var(--text-sub);">ë“±ë¡ëœ ì‹ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤.<br><br>âš™ï¸ "ë‚´ ë£¸ ì •ë³´ ê´€ë¦¬" ë©”ë‰´ì—ì„œ ì‹ë‹¹ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</div>';
                
            } catch(e) {
                console.error(e);
            }
        }

        // ê´€ë¦¬ì í˜ì´ì§€ - ë‚´ ì‹ë‹¹ ëª©ë¡ ë¡œë“œ
        async function loadMyRestaurantsAdmin() {
            if (!currentUserEmail && !currentUser) return;
            
            const userEmail = currentUserEmail || currentUser.email;
            
            try {
                const snap = await db.collection('restaurants')
                    .where('createdBy', '==', userEmail)
                    .get();
                
                let html = '';
                
                snap.forEach(doc => {
                    const data = doc.data();
                    html += `
                        <div style="border:1px solid var(--gw-border); border-radius:8px; padding:15px; margin-bottom:15px; background:#f8fafc;">
                            <div style="display:flex; justify-content:space-between; align-items:start;">
                                <div style="flex:1;">
                                    <div style="font-weight:700; font-size:16px; margin-bottom:8px;">${data.name}</div>
                                    <div style="font-size:13px; color:var(--text-sub); line-height:1.6;">
                                        ğŸ“ ${data.phone || 'ë¯¸ë“±ë¡'}<br>
                                        ğŸ“ ${data.location} Â· ğŸ½ï¸ ${data.category}
                                    </div>
                                    <div style="margin-top:10px; padding:10px; background:white; border-radius:6px; border:1px solid var(--gw-border);">
                                        <div style="font-weight:600; font-size:12px; color:var(--gw-main); margin-bottom:5px;">ë“±ë¡ëœ ë£¸:</div>
                                        ${data.rooms.map(r => `<div style="font-size:12px;">ğŸšª ${r.name} (${r.minCapacity}~${r.maxCapacity}ì¸)</div>`).join('')}
                                    </div>
                                </div>
                                <button class="btn-primary" style="width:60px; padding:8px; font-size:12px; background:var(--danger);" onclick="deleteMyRestaurant('${doc.id}')">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('myRestaurantsAdmin').innerHTML = html || '<div style="text-align:center; padding:40px; color:var(--text-sub);">ë“±ë¡ëœ ì‹ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤.<br><br>ìœ„ ì–‘ì‹ì„ ì‘ì„±í•˜ì—¬ ìƒˆë¡œìš´ ì‹ë‹¹ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</div>';
                
            } catch(e) {
                console.error(e);
            }
        }

        // ë‚´ ì‹ë‹¹ ì‚­ì œ
        async function deleteMyRestaurant(id) {
            if (!confirm('ì´ ì‹ë‹¹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await db.collection('restaurants').doc(id).delete();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadDashboard();
                loadMyRestaurantsAdmin();
            } catch(e) {
                console.error(e);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹œê³„ ì‹œì‘
        function startClock() {
            const up = () => {
                const n = new Date();
                document.getElementById('dateDisplay').innerText = n.toLocaleDateString('ko-KR', {year:'numeric', month:'long', day:'numeric', weekday:'short'});
                document.getElementById('timeDisplay').innerText = n.toLocaleTimeString('ko-KR', {hour12:false});
            };
            setInterval(up, 1000); up();
        }

        // í˜ì´ì§€ ì „í™˜
        function showPage(pId, el) {
            document.querySelectorAll('main').forEach(m => m.classList.remove('active'));
            document.getElementById(pId).classList.add('active');
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            
            if (pId === 'page-dashboard') {
                loadDashboard();
            }
            if (pId === 'page-room-admin') {
                loadMyRestaurantsAdmin();
            }
        }

        // íšŒì‹/ë£¸ ê²€ìƒ‰ ë¡œì§
        async function searchRooms() {
            const size = parseInt(document.getElementById('roomPartySize').value) || 0;
            const loc = document.getElementById('roomLocation').value;
            const cat = document.getElementById('roomCategory').value;
            const keyword = document.getElementById('roomNameSearch').value.trim();
            const resDiv = document.getElementById('searchResults');
            resDiv.innerHTML = "ğŸ” ì‚¬ë‚´ ë°ì´í„°ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...";

            try {
                let query = db.collection('restaurants');
                
                if (loc !== "") {
                    query = query.where('location', '==', loc);
                }

                const snap = await query.get();
                let html = "";
                
                snap.forEach(doc => {
                    const data = doc.data();
                    
                    if(cat && data.category !== cat) return;
                    if(keyword && !data.name.includes(keyword)) return;
                    
                    const matchRooms = data.rooms.filter(r => r.minCapacity <= size && r.maxCapacity >= size);
                    
                    const ownerEmail = data.createdBy || 'ì•Œ ìˆ˜ ì—†ìŒ';
                    const ownerName = ownerEmail.split('@')[0];
                    
                    const isMyData = (currentUserEmail || (currentUser && currentUser.email)) === ownerEmail;
                    
                    matchRooms.forEach(room => {
                        html += `
                            <div class="restaurant-card" onclick="openModal('${doc.id}', ${JSON.stringify(data).replace(/"/g, '&quot;')}, '${room.name}', ${isMyData})">
                                <span class="room-badge">${data.category}</span>
                                <span class="owner-badge">ğŸ‘¤ ${ownerName}</span>
                                <div style="font-weight:700; font-size:18px;">${data.name}</div>
                                <div style="color:var(--text-sub); font-size:13px;">ğŸ“ ${data.phone || 'ì •ë³´ì—†ìŒ'} Â· ğŸ“ ${data.location}</div>
                                <div class="room-info">
                                    <div style="color:var(--gw-main); font-weight:700;">âœ… ì¶”ì²œ ë£¸: ${room.name}</div>
                                    <div style="font-size:14px;">ì ì • ì¸ì›: ${room.minCapacity}~${room.maxCapacity}ì¸</div>
                                </div>
                            </div>`;
                    });
                });
                resDiv.innerHTML = html || `<div style="padding:40px; text-align:center; color:var(--text-sub);">ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤. <br><br>ğŸ“ ë„¤ì´ë²„ ì§€ë„ë¡œ ì°¾ê¸° ë²„íŠ¼ì„ ì´ìš©í•´ ë³´ì„¸ìš”.</div>`;
            } catch(e) {
                console.error(e);
                resDiv.innerHTML = "âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }

        // ë„¤ì´ë²„ ê²€ìƒ‰
        function searchNaverMaps() {
            const loc = document.getElementById('roomLocation').value;
            const cat = document.getElementById('roomCategory').value;
            const query = `${loc} ${cat} ë£¸ ì‹ë‹¹`;
            window.open(`https://map.naver.com/v5/search/${encodeURIComponent(query)}`, '_blank');
        }

        // ë£¸ ë“±ë¡ ë¡œì§
        async function addRestaurant() {
            const name = document.getElementById('adminRestName').value.trim();
            const min = parseInt(document.getElementById('adminMinCap').value);
            const max = parseInt(document.getElementById('adminMaxCap').value);
            
            if(!name || isNaN(min)) return alert("ì‹ë‹¹ëª…ê³¼ ìµœì†Œ ì¸ì› ì •ë³´ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
            if(!currentUserEmail && !currentUser) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

            const userEmail = currentUserEmail || currentUser.email;

            try {
                await db.collection('restaurants').add({
                    name, 
                    location: document.getElementById('adminLocation').value,
                    phone: document.getElementById('adminPhone').value.trim(),
                    category: document.getElementById('adminCategory').value,
                    rooms: [{ 
                        name: document.getElementById('adminRoomName').value || "ì¼ë°˜ë£¸", 
                        minCapacity: min, 
                        maxCapacity: max 
                    }],
                    createdAt: new Date(),
                    createdBy: userEmail
                });
                alert("âœ… ë“±ë¡ ì™„ë£Œ!");
                document.getElementById('adminRestName').value = "";
                document.getElementById('adminPhone').value = "";
                document.getElementById('adminRoomName').value = "";
                document.getElementById('adminMinCap').value = "";
                document.getElementById('adminMaxCap').value = "";
                
                loadDashboard();
                loadMyRestaurantsAdmin();
            } catch(e) {
                console.error(e);
                alert("âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
            }
        }

        // ëª¨ë‹¬ & ì‚­ì œ ë¡œì§
        function openModal(id, data, rName, isMyData) {
            document.getElementById('m-title').innerText = data.name;
            
            const ownerEmail = data.createdBy || 'ì•Œ ìˆ˜ ì—†ìŒ';
            const ownerName = ownerEmail.split('@')[0];
            
            document.getElementById('m-body').innerHTML = `
                ì¶”ì²œ ë£¸: <b>${rName}</b><br>
                ì „í™”ë²ˆí˜¸: ${data.phone || 'ì—†ìŒ'}<br>
                ìœ„ì¹˜: ${data.location}<br>
                ë©”ë‰´: ${data.category}<br>
                <div style="margin-top:10px; padding:8px; background:#f0f9ff; border-radius:6px; font-size:12px;">
                    ğŸ‘¤ ë“±ë¡ì: ${ownerName}
                </div>
            `;
            
            document.getElementById('m-call-btn').onclick = () => { 
                if(data.phone) location.href='tel:'+data.phone; 
                else alert('ë²ˆí˜¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'); 
            };
            document.getElementById('m-map-btn').onclick = () => window.open('https://map.naver.com/v5/search/'+encodeURIComponent(data.name));
            
            const deleteBtn = document.getElementById('m-delete-btn');
            if (isMyData) {
                deleteBtn.style.display = 'block';
                deleteBtn.onclick = async () => {
                    if(confirm("ì´ ì‹ë‹¹ ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?")) { 
                        await db.collection('restaurants').doc(id).delete(); 
                        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); 
                        closeModal(); 
                        searchRooms();
                        loadDashboard();
                        loadMyRestaurantsAdmin();
                    }
                };
            } else {
                deleteBtn.style.display = 'none';
            }
            
            document.getElementById('detailModal').classList.add('show');
        }
        
        function closeModal() { 
            document.getElementById('detailModal').classList.remove('show'); 
        }
    </script>
</body>
</html>

