<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WorkHub - Enterprise Groupware</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client"></script>
<style>
:root{--bg:#f5f6fa;--bg-card:#fff;--bg-side:#1a1d2e;--bg-input:#f8f9fb;--bd:#e5e7eb;--bd-focus:#6366f1;--t1:#111827;--t2:#6b7280;--t3:#9ca3af;--tw:#fff;--ac:#6366f1;--ac-l:#eef2ff;--ac-d:#4f46e5;--ok:#10b981;--ok-l:#d1fae5;--wn:#f59e0b;--wn-l:#fef3c7;--err:#ef4444;--err-l:#fee2e2;--or:#f97316;--pu:#8b5cf6;--sh:0 1px 3px rgba(0,0,0,.1);--sh-md:0 4px 6px -1px rgba(0,0,0,.1);--sh-lg:0 10px 15px -3px rgba(0,0,0,.1);--sh-xl:0 20px 25px -5px rgba(0,0,0,.1);--r:8px;--rl:12px;--rxl:16px;--ff:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;--hh:60px;--sw:250px;--tr:all .2s cubic-bezier(.4,0,.2,1)}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}html{-webkit-font-smoothing:antialiased}body{font-family:var(--ff);font-size:.875rem;color:var(--t1);background:var(--bg);line-height:1.6;min-height:100vh;overflow-x:hidden}button{font-family:var(--ff);cursor:pointer;border:none;background:none}input,textarea,select{font-family:var(--ff);border:none;outline:none}[hidden]{display:none!important}
@keyframes sU{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}@keyframes sD{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:none}}@keyframes fI{from{opacity:0}to{opacity:1}}@keyframes tI{from{opacity:0;transform:translateX(40px)}to{opacity:1;transform:none}}@keyframes tO{from{opacity:1}to{opacity:0;transform:translateX(40px)}}@keyframes sp{to{transform:rotate(360deg)}}@keyframes pl{0%,100%{opacity:.4}50%{opacity:1}}@keyframes bI{0%{opacity:0;transform:scale(.3)}50%{transform:scale(1.05)}100%{opacity:1;transform:scale(1)}}@keyframes fp{0%,100%{box-shadow:0 4px 20px rgba(99,102,241,.4)}50%{box-shadow:0 4px 20px rgba(99,102,241,.65),0 0 0 10px rgba(99,102,241,.06)}}@keyframes dB{0%,80%,100%{opacity:0}40%{opacity:1}}@keyframes barSlide{from{height:0;opacity:0}to{height:20px;opacity:1}}@keyframes menuIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}@keyframes iconPop{0%{transform:scale(1)}50%{transform:scale(1.25) rotate(-8deg)}100%{transform:scale(1)}}@keyframes menuFlash{0%{background:rgba(99,102,241,.5);transform:translateX(10px)}50%{background:rgba(99,102,241,.35)}100%{background:rgba(99,102,241,.25);transform:translateX(4px)}}
.tw{position:fixed;top:16px;right:16px;z-index:99999;display:flex;flex-direction:column;gap:8px;pointer-events:none}.to{pointer-events:auto;display:flex;align-items:center;gap:10px;padding:12px 20px;border-radius:var(--r);font-size:.8125rem;font-weight:500;max-width:380px;box-shadow:var(--sh-lg);animation:tI .3s ease-out both;border-left:4px solid transparent;background:#fff}.to--d{animation:tO .25s ease-in both}.to--ok{color:#065f46;border-left-color:var(--ok)}.to--err{color:#991b1b;border-left-color:var(--err)}.to--info{color:var(--t1);border-left-color:var(--ac)}
.lp{min-height:100vh;display:flex}.lp-l{flex:1;background:linear-gradient(135deg,#1e1b4b,#312e81,#4f46e5);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;position:relative;overflow:hidden}.lp-l::before{content:'';position:absolute;width:500px;height:500px;border-radius:50%;background:rgba(255,255,255,.03);top:-180px;right:-180px}.lp-l::after{content:'';position:absolute;width:350px;height:350px;border-radius:50%;background:rgba(255,255,255,.02);bottom:-80px;left:-80px}.lp-brand{position:relative;z-index:1;text-align:center;color:#fff}.lp-brand h1{font-size:3rem;font-weight:900;letter-spacing:-1.5px;margin-bottom:.5rem}.lp-brand p{font-size:1rem;opacity:.7;letter-spacing:.5px}.lp-feats{position:relative;z-index:1;margin-top:3rem;display:flex;flex-direction:column;gap:1.25rem}.lp-ft{display:flex;align-items:center;gap:12px;color:rgba(255,255,255,.85);font-size:.875rem;font-weight:500}.lp-ft-i{width:40px;height:40px;border-radius:10px;background:rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;flex-shrink:0}.lp-ft-i svg{width:20px;height:20px;stroke:rgba(255,255,255,.9);fill:none;stroke-width:2}.lp-r{width:480px;display:flex;align-items:center;justify-content:center;padding:3rem;background:#fff}.lp-form{width:100%;max-width:360px}.lp-form h2{font-size:1.75rem;font-weight:800;color:var(--t1);margin-bottom:.5rem}.lp-form>p{color:var(--t2);margin-bottom:2rem;font-size:.9375rem}.bg{width:100%;padding:14px;background:#fff;border:1px solid var(--bd);border-radius:var(--r);font-size:.9375rem;font-weight:600;color:var(--t1);display:flex;align-items:center;justify-content:center;gap:10px;transition:var(--tr)}.bg:hover:not(:disabled){background:var(--bg-input);box-shadow:var(--sh-md);transform:translateY(-1px)}.bg:disabled{opacity:.5;cursor:wait}.bg svg{width:20px;height:20px;flex-shrink:0}.sp{display:inline-block;width:20px;height:20px;border:2.5px solid var(--bd);border-top-color:var(--ac);border-radius:50%;animation:sp .6s linear infinite}.le{margin-top:12px;padding:12px 16px;background:var(--err-l);border:1px solid #fecaca;border-radius:var(--r);font-size:.8125rem;color:#991b1b;display:none;line-height:1.6}.le--s{display:block}.le strong{font-weight:700}.lp-foot{text-align:center;font-size:.75rem;color:var(--t3);margin-top:2rem}
.hd{height:var(--hh);background:#fff;border-bottom:1px solid var(--bd);position:sticky;top:0;z-index:20;box-shadow:0 1px 2px rgba(0,0,0,.05)}.hd-in{max-width:1600px;margin:0 auto;height:100%;padding:0 24px;display:flex;align-items:center;justify-content:space-between}.hd-left{display:flex;align-items:center;gap:16px}.hd-menu{display:none;padding:6px;border-radius:6px;color:var(--t2);transition:var(--tr)}.hd-menu:hover{background:var(--bg-input)}.hd-logo{font-size:1.375rem;font-weight:900;color:var(--ac);letter-spacing:-1px;cursor:pointer;user-select:none}.hd-search{margin-left:24px;position:relative}.hd-search input{width:260px;padding:8px 12px 8px 36px;background:var(--bg-input);border:1px solid var(--bd);border-radius:var(--r);font-size:.8125rem;color:var(--t1);transition:var(--tr)}.hd-search input:focus{border-color:var(--ac);background:#fff;box-shadow:0 0 0 3px rgba(99,102,241,.1)}.hd-search input::placeholder{color:var(--t3)}.hd-search svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:var(--t3);pointer-events:none}.hd-rt{display:flex;align-items:center;gap:8px}.hd-noti{position:relative;width:36px;height:36px;border-radius:var(--r);display:flex;align-items:center;justify-content:center;color:var(--t2);transition:var(--tr)}.hd-noti:hover{background:var(--bg-input)}.hd-noti svg{width:20px;height:20px}.hd-noti-b{position:absolute;top:4px;right:4px;width:8px;height:8px;background:var(--err);border-radius:50%;border:2px solid #fff}.hd-div{width:1px;height:28px;background:var(--bd);margin:0 8px}.hd-prof{display:flex;align-items:center;gap:10px;padding:6px 12px 6px 6px;border-radius:var(--r);transition:var(--tr);cursor:pointer}.hd-prof:hover{background:var(--bg-input)}.hd-av{width:32px;height:32px;border-radius:50%;background:var(--ac-l);display:flex;align-items:center;justify-content:center;overflow:hidden}.hd-av img{width:100%;height:100%;object-fit:cover}.hd-av svg{width:16px;height:16px;color:var(--ac)}.hd-pi{display:flex;flex-direction:column}.hd-pn{font-size:.8125rem;font-weight:600;color:var(--t1);line-height:1.2}.hd-pe{font-size:.6875rem;color:var(--t3);line-height:1.2}.hd-lo{width:36px;height:36px;border-radius:var(--r);display:flex;align-items:center;justify-content:center;color:var(--t3);transition:var(--tr)}.hd-lo:hover{background:var(--err-l);color:var(--err)}.hd-lo svg{width:18px;height:18px}
.al{display:flex;min-height:calc(100vh - var(--hh))}.sb{width:var(--sw);background:var(--bg-side);flex-shrink:0;display:flex;flex-direction:column;padding:20px 12px;overflow-y:auto;transition:transform .3s cubic-bezier(.4,0,.2,1)}.sb-lb{font-size:.6875rem;font-weight:700;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:1.5px;padding:12px 14px 8px;margin-top:4px;animation:menuIn .3s ease-out both}.sb-nav{display:flex;flex-direction:column;gap:2px}.sb-lk{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:var(--r);font-size:.8125rem;font-weight:500;color:rgba(255,255,255,.6);transition:var(--tr);position:relative;transform:translateX(0)}.sb-lk:hover{transform:translateX(6px);background:rgba(255,255,255,.07);color:rgba(255,255,255,.9)}.sb-lk:active{transform:translateX(3px) scale(.98)}.sb-lk--on{background:rgba(99,102,241,.25);color:#fff;font-weight:600;transform:translateX(4px)}.sb-lk--on::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--ac);border-radius:0 4px 4px 0;animation:barSlide .3s ease-out}.sb-lk svg{width:18px;height:18px;flex-shrink:0;opacity:.7;fill:none;stroke:currentColor;stroke-width:2;transition:transform .25s ease}.sb-lk:hover svg{transform:scale(1.15) rotate(-5deg)}.sb-lk--on svg{opacity:1;animation:iconPop .3s ease-out}.sb-lk .bdg{margin-left:auto;padding:2px 8px;border-radius:10px;font-size:.6875rem;font-weight:700;background:var(--err);color:#fff;line-height:1.4}.sb-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:29}
.sb-nav button:nth-child(1){animation:menuIn .3s ease-out both;animation-delay:.05s}
.sb-nav button:nth-child(2){animation:menuIn .3s ease-out both;animation-delay:.1s}
.sb-nav button:nth-child(3){animation:menuIn .3s ease-out both;animation-delay:.15s}
.sb-nav button:nth-child(4){animation:menuIn .3s ease-out both;animation-delay:.2s}
.sb-nav button:nth-child(5){animation:menuIn .3s ease-out both;animation-delay:.25s}
.mn{flex:1;padding:28px 32px;max-width:1200px;min-width:0;animation:fI .3s ease-out}.ph{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.pt{font-size:1.5rem;font-weight:800;color:var(--t1);letter-spacing:-.5px}.bc{display:flex;align-items:center;gap:6px;font-size:.75rem;color:var(--t3);margin-bottom:4px}.bc a{color:var(--t2);transition:color .15s;cursor:pointer}.bc a:hover{color:var(--ac)}
.cd{background:var(--bg-card);border-radius:var(--rl);border:1px solid var(--bd);box-shadow:0 1px 2px rgba(0,0,0,.05);transition:var(--tr)}.cd:hover{box-shadow:var(--sh)}.cd-b{padding:20px 24px}.cd-h{padding:16px 24px;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center}.cd-h h3{font-size:1rem;font-weight:700;color:var(--t1)}
.sr{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:24px}.sc{background:#fff;border-radius:var(--rl);border:1px solid var(--bd);padding:20px 24px;box-shadow:0 1px 2px rgba(0,0,0,.05);transition:var(--tr);position:relative;overflow:hidden}.sc:hover{box-shadow:var(--sh-md);transform:translateY(-2px)}.sc::after{content:'';position:absolute;top:0;right:0;width:80px;height:80px;border-radius:50%;opacity:.06;transform:translate(20px,-20px)}.sc:nth-child(1)::after{background:var(--ac)}.sc:nth-child(2)::after{background:var(--ok)}.sc:nth-child(3)::after{background:var(--wn)}.sc:nth-child(4)::after{background:var(--pu)}.sc-t{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.sc-lb{font-size:.75rem;font-weight:600;color:var(--t2);text-transform:uppercase;letter-spacing:.5px}.sc-ic{width:40px;height:40px;border-radius:var(--r);display:flex;align-items:center;justify-content:center}.sc-ic svg{width:20px;height:20px;fill:none;stroke:currentColor;stroke-width:2}.sc-ic--a{background:var(--ac-l);color:var(--ac)}.sc-ic--o{background:var(--ok-l);color:var(--ok)}.sc-ic--w{background:var(--wn-l);color:var(--wn)}.sc-ic--p{background:#ede9fe;color:var(--pu)}.sc-v{font-size:1.75rem;font-weight:800;color:var(--t1);letter-spacing:-1px;line-height:1}.sc-ch{display:inline-flex;align-items:center;gap:3px;font-size:.75rem;font-weight:600;margin-top:8px;padding:2px 8px;border-radius:20px;background:var(--ok-l);color:#065f46}
.dg{display:grid;grid-template-columns:1fr 1fr;gap:20px}.rl{display:flex;flex-direction:column;gap:2px}.rr{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:var(--r);transition:var(--tr);cursor:pointer}.rr:hover{background:var(--bg-input)}.rd{width:8px;height:8px;border-radius:50%;flex-shrink:0}.rd--a{background:var(--ac)}.rd--o{background:var(--ok)}.rd--w{background:var(--wn)}.rd--e{background:var(--err)}.ri{flex:1;min-width:0}.ri-t{font-size:.8125rem;font-weight:600;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ri-s{font-size:.75rem;color:var(--t3);margin-top:1px}.ri-tm{font-size:.6875rem;color:var(--t3);white-space:nowrap}.qg{display:grid;grid-template-columns:1fr 1fr;gap:10px}.qc{display:flex;flex-direction:column;align-items:center;gap:8px;padding:20px 12px;background:var(--bg-input);border:1px solid var(--bd);border-radius:var(--rl);transition:var(--tr);cursor:pointer}.qc:hover{border-color:var(--ac);background:var(--ac-l);transform:translateY(-2px);box-shadow:var(--sh-md)}.qc-i{width:44px;height:44px;border-radius:var(--r);display:flex;align-items:center;justify-content:center}.qc-i svg{width:22px;height:22px;fill:none;stroke:currentColor;stroke-width:2}.qc span{font-size:.75rem;font-weight:600;color:var(--t2)}.qc:hover span{color:var(--ac)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:var(--r);font-size:.8125rem;font-weight:600;transition:var(--tr);white-space:nowrap}.btn svg{width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2}.btn-p{background:var(--ac);color:#fff;box-shadow:0 1px 2px rgba(99,102,241,.3)}.btn-p:hover{background:var(--ac-d);box-shadow:0 4px 12px rgba(99,102,241,.3);transform:translateY(-1px)}.btn-o{background:#fff;color:var(--t2);border:1px solid var(--bd)}.btn-o:hover{border-color:var(--ac);color:var(--ac);background:var(--ac-l)}.btn-d{background:var(--err);color:#fff}.btn-d:hover{background:#dc2626}.bi{width:32px;height:32px;border-radius:6px;display:flex;align-items:center;justify-content:center;color:var(--t3);transition:var(--tr)}.bi:hover{background:var(--bg-input);color:var(--t1)}.bi svg{width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2}.bi-e{color:var(--ac)}.bi-e:hover{background:var(--ac-l)}.bi-d{color:var(--err)}.bi-d:hover{background:var(--err-l)}
.nl{display:flex;flex-direction:column;gap:12px}.nc{background:#fff;border:1px solid var(--bd);border-radius:var(--rl);padding:20px 24px;box-shadow:0 1px 2px rgba(0,0,0,.05);transition:var(--tr)}.nc:hover{box-shadow:var(--sh-md)}.nc-top{display:flex;justify-content:space-between;align-items:flex-start}.nc-body{flex:1;min-width:0}.nc-tl{font-size:1.0625rem;font-weight:700;color:var(--t1);margin-bottom:6px}.nc-ct{font-size:.8125rem;color:var(--t2);line-height:1.7;white-space:pre-wrap}.nc-act{display:flex;gap:4px;flex-shrink:0;margin-left:12px}.nc-mt{display:flex;align-items:center;gap:16px;font-size:.75rem;color:var(--t3);margin-top:16px;padding-top:12px;border-top:1px solid var(--bd)}.nc-mt span{display:flex;align-items:center;gap:4px}.nc-mt svg{width:14px;height:14px;fill:none;stroke:currentColor;stroke-width:2}.es{text-align:center;padding:60px 24px}.es svg{width:56px;height:56px;color:var(--t3);margin:0 auto 12px;fill:none;stroke:currentColor;stroke-width:1.5}.es p{font-size:1rem;font-weight:600;color:var(--t2)}.es span{font-size:.8125rem;color:var(--t3);display:block;margin-top:4px}
.mo{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;padding:16px;z-index:50;animation:fI .15s ease-out}.mo-bx{width:100%;max-width:560px;background:#fff;border-radius:var(--rxl);box-shadow:var(--sh-xl);animation:sD .2s ease-out;overflow:hidden}.mo-hd{padding:20px 24px;border-bottom:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center}.mo-hd h3{font-size:1.125rem;font-weight:700}.mo-bd{padding:24px}.mo-ft{padding:16px 24px;border-top:1px solid var(--bd);display:flex;justify-content:flex-end;gap:8px;background:var(--bg-input)}.fg{margin-bottom:16px}.fg:last-child{margin-bottom:0}.fl{display:block;font-size:.8125rem;font-weight:600;color:var(--t1);margin-bottom:6px}.fi{width:100%;padding:10px 14px;background:var(--bg-input);border:1px solid var(--bd);border-radius:var(--r);font-size:.8125rem;color:var(--t1);transition:var(--tr)}.fi::placeholder{color:var(--t3)}.fi:focus{border-color:var(--bd-focus);background:#fff;box-shadow:0 0 0 3px rgba(99,102,241,.1)}textarea.fi{resize:vertical;min-height:140px;line-height:1.7}select.fi{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239ca3af' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}
.db{background:linear-gradient(135deg,#ea580c,#dc2626,#db2777);border-radius:var(--rxl);padding:28px 32px;color:#fff;margin-bottom:24px;position:relative;overflow:hidden}.db::before{content:'';position:absolute;top:-40%;right:-10%;width:250px;height:250px;background:rgba(255,255,255,.07);border-radius:50%}.db h2{font-size:1.5rem;font-weight:800;position:relative;z-index:1}.db p{font-size:.875rem;opacity:.85;position:relative;z-index:1;margin-top:4px}.dg2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}.fgr{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}.fc{display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;background:#fff;border:2px solid var(--bd);border-radius:var(--rl);cursor:pointer;transition:var(--tr);font-size:.75rem;font-weight:500;color:var(--t2)}.fc:hover{border-color:var(--or);color:var(--or);transform:translateY(-2px)}.fc--on{border-color:var(--or);background:#fff7ed;color:var(--or);font-weight:700;box-shadow:0 4px 12px rgba(249,115,22,.15)}.fc-i{font-size:1.5rem;line-height:1}.fc-n{line-height:1.2;text-align:center}.pb{display:flex;gap:8px;flex-wrap:wrap}.pp{padding:8px 16px;background:#fff;border:2px solid var(--bd);border-radius:var(--r);font-size:.8125rem;font-weight:500;color:var(--t2);transition:var(--tr);cursor:pointer}.pp:hover{border-color:var(--ac);color:var(--ac)}.pp--on{border-color:var(--ac);background:var(--ac-l);color:var(--ac);font-weight:700}.dsb{width:100%;padding:14px;background:linear-gradient(135deg,#ea580c,#dc2626);border-radius:var(--rl);color:#fff;font-size:1rem;font-weight:700;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 15px rgba(234,88,12,.3);transition:var(--tr);margin-top:20px}.dsb:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(234,88,12,.4)}.dsb:disabled{opacity:.5;transform:none}.dsb svg{width:20px;height:20px;fill:none;stroke:currentColor;stroke-width:2}
.dlc{margin-top:24px}.dlh{display:flex;justify-content:space-between;align-items:center}.dls{display:flex;gap:16px;margin:16px 0}.dls-i{padding:12px 20px;background:var(--bg-input);border-radius:var(--r);text-align:center;flex:1}.dls-v{font-size:1.25rem;font-weight:800;color:var(--t1)}.dls-l{font-size:.6875rem;color:var(--t3);margin-top:2px}.dlf{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}.dlf-i{padding:5px 12px;border-radius:20px;font-size:.75rem;font-weight:600;background:var(--bg-input);color:var(--t2);transition:var(--tr);cursor:pointer;border:1px solid transparent}.dlf-i:hover{border-color:var(--ac);color:var(--ac)}.dlf-i--on{background:var(--ac);color:#fff;border-color:var(--ac)}.dll{display:flex;flex-direction:column;gap:10px}.dli{display:flex;align-items:center;gap:14px;padding:14px 18px;background:var(--bg-input);border-radius:var(--rl);transition:var(--tr)}.dli:hover{background:#fff;box-shadow:var(--sh)}.dli-e{font-size:1.5rem;flex-shrink:0}.dli-inf{flex:1;min-width:0}.dli-nm{font-size:.875rem;font-weight:700;color:var(--t1)}.dli-mt{font-size:.75rem;color:var(--t3);margin-top:2px;display:flex;gap:10px;flex-wrap:wrap}.dli-st{color:var(--wn);font-size:.75rem;letter-spacing:1px}.dli-act{display:flex;gap:4px;flex-shrink:0}.dli-nv{padding:4px 10px;border-radius:20px;background:#03c75a;color:#fff;font-size:.6875rem;font-weight:700;transition:var(--tr);cursor:pointer;border:none}.dli-nv:hover{background:#02b351}.dle{text-align:center;padding:40px 20px;color:var(--t3)}.dle p{font-size:.875rem}
/* CALENDAR */
.cal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.cal-nav{display:flex;align-items:center;gap:12px}.cal-nav button{width:36px;height:36px;border-radius:50%;border:1px solid var(--bd);background:#fff;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:var(--tr)}.cal-nav button:hover{background:var(--ac-l);color:var(--ac)}.cal-mo{font-size:1.125rem;font-weight:700;min-width:140px;text-align:center}.cal-gd{display:grid;grid-template-columns:repeat(7,1fr);gap:2px}.cal-dh{padding:8px 4px;text-align:center;font-size:.6875rem;font-weight:700;color:var(--t3);text-transform:uppercase}.cal-dy{min-height:80px;padding:6px;border:1px solid var(--bd);border-radius:var(--r);cursor:pointer;transition:var(--tr);background:#fff;position:relative}.cal-dy:hover{background:var(--ac-l)}.cal-dy.today{border-color:var(--ac);background:rgba(99,102,241,.04)}.cal-dy.other{opacity:.3}.cal-dy .dn{font-size:.75rem;font-weight:600;margin-bottom:2px}.cal-dy.today .dn{color:var(--ac)}.cal-dy .dn.sun{color:var(--err)}.cal-dy .dn.sat{color:var(--ac)}.cal-ev{font-size:.625rem;padding:2px 4px;border-radius:4px;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;color:#fff;font-weight:500}.cal-ev.c0{background:var(--ac)}.cal-ev.c1{background:var(--ok)}.cal-ev.c2{background:var(--err)}.cal-ev.c3{background:var(--wn);color:#000}.cal-mr{font-size:.625rem;color:var(--ac);font-weight:700;cursor:pointer}.cal-auth{text-align:center;padding:40px;background:var(--bg-input);border-radius:var(--rl);border:2px dashed var(--bd)}.cal-auth p{margin-bottom:16px;color:var(--t2);font-size:.875rem}.cal-up{display:flex;flex-direction:column;gap:2px}.cal-ui{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:var(--r);transition:var(--tr);cursor:pointer}.cal-ui:hover{background:var(--bg-input)}.cal-ui-t{font-size:.8125rem;font-weight:600;color:var(--t1)}.cal-ui-s{font-size:.75rem;color:var(--t3);margin-top:1px}.cal-ui-tm{font-size:.6875rem;color:var(--t3);white-space:nowrap;margin-left:auto;padding:2px 8px;border-radius:4px;background:var(--ac-l);color:var(--ac);font-weight:600}
#cb{position:fixed;bottom:24px;right:24px;z-index:9990;display:flex;flex-direction:column;align-items:flex-end}.cb-f{width:56px;height:56px;border-radius:50%;background:var(--ac);color:#fff;box-shadow:0 4px 20px rgba(99,102,241,.4);font-size:1.25rem;display:flex;align-items:center;justify-content:center;transition:var(--tr);animation:fp 3s ease-in-out infinite;position:relative}.cb-f:hover{transform:scale(1.1);box-shadow:0 8px 30px rgba(99,102,241,.5)}.cb-bg{position:absolute;top:-2px;right:-2px;width:20px;height:20px;background:var(--err);border-radius:50%;font-size:.65rem;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;border:2px solid #fff;animation:bI .3s ease-out}.cb-tp{position:absolute;right:calc(100% + 12px);top:50%;transform:translateY(-50%);background:var(--bg-side);color:#fff;padding:8px 14px;border-radius:var(--r);font-size:.75rem;font-weight:500;white-space:nowrap;box-shadow:var(--sh-lg);animation:fI .3s;pointer-events:none}.cb-tp::after{content:'';position:absolute;top:50%;right:-6px;transform:translateY(-50%);border:6px solid transparent;border-left-color:var(--bg-side)}.cb-w{width:400px;max-height:580px;background:#fff;border-radius:var(--rxl);box-shadow:var(--sh-xl);border:1px solid var(--bd);display:none;flex-direction:column;overflow:hidden;margin-bottom:10px;animation:sU .25s ease-out}.cb-w--o{display:flex}.cb-hd{padding:16px 20px;background:var(--ac);color:#fff;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}.cb-hd-l{display:flex;align-items:center;gap:10px}.cb-hd-av{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:1rem}.cb-hd-i h4{font-size:.875rem;font-weight:700}.cb-hd-i span{font-size:.6875rem;opacity:.8;display:flex;align-items:center;gap:4px}.cb-hd-i span::before{content:'';width:6px;height:6px;border-radius:50%;background:#4ade80}.cb-cl{color:#fff;font-size:1.25rem;padding:4px 8px;border-radius:6px;cursor:pointer;transition:var(--tr)}.cb-cl:hover{background:rgba(255,255,255,.15)}.cb-ms{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:8px;max-height:340px;min-height:240px;scrollbar-width:thin;scrollbar-color:var(--bd) transparent}.cb-ms::-webkit-scrollbar{width:4px}.cb-ms::-webkit-scrollbar-thumb{background:var(--bd);border-radius:2px}.cb-m{max-width:85%;animation:sU .2s ease-out}.cb-m--b{align-self:flex-start}.cb-m--u{align-self:flex-end}.cb-bb{padding:10px 14px;border-radius:var(--rl);font-size:.8125rem;line-height:1.65;word-break:break-word}.cb-m--b .cb-bb{background:var(--bg-input);color:var(--t1);border-bottom-left-radius:4px}.cb-m--u .cb-bb{background:var(--ac);color:#fff;border-bottom-right-radius:4px}.cb-tm{font-size:.625rem;color:var(--t3);margin-top:2px;padding:0 4px}.cb-m--u .cb-tm{text-align:right}.cb-bb b{font-weight:700}.cb-ty{align-self:flex-start;display:flex;gap:4px;padding:10px 14px}.cb-ty span{width:7px;height:7px;border-radius:50%;background:var(--t3);animation:dB 1.4s infinite}.cb-ty span:nth-child(2){animation-delay:.2s}.cb-ty span:nth-child(3){animation-delay:.4s}.cb-sg{display:flex;flex-wrap:wrap;gap:6px;padding:10px 16px;border-top:1px solid var(--bd);background:var(--bg-input);flex-shrink:0}.cb-sg-b{padding:5px 12px;background:#fff;border:1px solid var(--bd);border-radius:20px;font-size:.6875rem;color:var(--t2);font-weight:500;transition:var(--tr);cursor:pointer}.cb-sg-b:hover{border-color:var(--ac);color:var(--ac);background:var(--ac-l)}.cb-ia{padding:12px;border-top:1px solid var(--bd);display:flex;gap:8px;background:#fff;flex-shrink:0}.cb-in{flex:1;padding:10px 14px;border:1.5px solid var(--bd);border-radius:var(--r);font-size:.8125rem;background:var(--bg-input);transition:var(--tr)}.cb-in:focus{border-color:var(--ac);background:#fff}.cb-sn{padding:10px 16px;background:var(--ac);color:#fff;border-radius:var(--r);font-size:.8125rem;font-weight:600;transition:var(--tr);display:flex;align-items:center;gap:4px;cursor:pointer}.cb-sn:hover{background:var(--ac-d);box-shadow:0 2px 8px rgba(99,102,241,.3)}.cb-sn:disabled{opacity:.4;cursor:not-allowed}.cb-sn svg{width:14px;height:14px;fill:none;stroke:currentColor;stroke-width:2}
@media(max-width:1024px){.sr{grid-template-columns:repeat(2,1fr)}.fgr{grid-template-columns:repeat(3,1fr)}.dg{grid-template-columns:1fr}.hd-search{display:none}}
@media(max-width:768px){.hd-menu{display:block}.sb{position:fixed;top:var(--hh);left:0;bottom:0;z-index:30;transform:translateX(-100%)}.sb--op{transform:translateX(0)}.sb-ov--s{display:block}.mn{padding:16px}.sr{grid-template-columns:1fr 1fr}.dg2{grid-template-columns:1fr}.fgr{grid-template-columns:repeat(3,1fr)}.lp{flex-direction:column}.lp-l{padding:2rem;min-height:auto}.lp-feats{display:none}.lp-r{width:100%;padding:2rem}.lp-brand h1{font-size:2.25rem}.cb-w{width:calc(100vw - 32px);max-height:calc(100vh - 100px)}#cb{bottom:16px;right:16px}.hd-pi{display:none}.cal-dy{min-height:50px}.cal-ev{display:none}.cal-dy .dn{font-size:.6875rem}}
@media(max-width:480px){.sr{grid-template-columns:1fr}.fgr{grid-template-columns:repeat(2,1fr)}.pb{gap:6px}.pp{padding:6px 12px;font-size:.75rem}}
</style>
</head>
<body>
<!-- Toast -->
<div id="toastBox" style="position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:8px;"></div>

<!-- ===== Login Page ===== -->
<div id="pgLogin" class="login-pg">
  <div class="login-card">
    <div class="login-logo">WorkHub</div>
    <p style="text-align:center;color:#64748b;margin-bottom:24px;">íŒ€ ê·¸ë£¹ì›¨ì–´ì— ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
    <button class="btn btn-primary" style="width:100%;padding:14px;" onclick="App.auth.googleLogin()">
      <svg width="18" height="18" viewBox="0 0 48 48" style="vertical-align:middle;margin-right:8px;"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59A14.5 14.5 0 0 1 9.5 24c0-1.59.28-3.14.76-4.59l-7.98-6.19A23.998 23.998 0 0 0 0 24c0 3.77.87 7.35 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
      Googleë¡œ ë¡œê·¸ì¸
    </button>
  </div>
</div>

<!-- ===== App Shell ===== -->
<div id="appShell" class="app" style="display:none;">
  <!-- Header -->
  <header class="hd">
    <button class="hd-menu" onclick="document.querySelector('.sb').classList.toggle('sb--open')">â˜°</button>
    <div class="hd-title">WorkHub</div>
    <div style="flex:1"></div>
    <div class="hd-user">
      <span id="hUsr">ì‚¬ìš©ì</span>
      <button class="btn" style="padding:6px 12px;font-size:12px;background:#ef4444;color:#fff;" onclick="App.auth.logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </header>

  <!-- Sidebar -->
  <nav class="sb">
    <a class="sb-lk sb-lk--on" data-pg="pgDash" onclick="App.rt.go('pgDash')">
      <span class="sb-ico">ğŸ“Š</span><span class="sb-txt">ëŒ€ì‹œë³´ë“œ</span>
    </a>
    <a class="sb-lk" data-pg="pgNotice" onclick="App.rt.go('pgNotice')">
      <span class="sb-ico">ğŸ“‹</span><span class="sb-txt">ê³µì§€ì‚¬í•­</span>
    </a>
    <a class="sb-lk" data-pg="pgDining" onclick="App.rt.go('pgDining')">
      <span class="sb-ico">ğŸ½ï¸</span><span class="sb-txt">ë§›ì§‘ ì°¾ê¸°</span>
    </a>
    <a class="sb-lk" data-pg="pgDinLog" onclick="App.rt.go('pgDinLog')">
      <span class="sb-ico">ğŸ“’</span><span class="sb-txt">íšŒì‹ ì¥ë¶€</span>
    </a>
    <a class="sb-lk" data-pg="pgCal" onclick="App.rt.go('pgCal')">
      <span class="sb-ico">ğŸ“…</span><span class="sb-txt">ìº˜ë¦°ë”</span>
    </a>
  </nav>

  <!-- Main -->
  <main class="mn">
    <!-- Dashboard -->
    <section id="pgDash" class="pg pg--on">
      <h2 class="pg-title">ëŒ€ì‹œë³´ë“œ</h2>
      <div id="dashStats" class="dash-stats"></div>
      <div class="dash-grid">
        <div class="card">
          <div class="card-hd">ìµœê·¼ ê³µì§€</div>
          <div id="dashNotice" class="card-bd" style="min-height:80px;"></div>
        </div>
        <div class="card">
          <div class="card-hd">ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</div>
          <div id="dashCal" class="card-bd" style="min-height:80px;"></div>
        </div>
        <div class="card">
          <div class="card-hd">ìµœê·¼ íšŒì‹</div>
          <div id="dashDinLog" class="card-bd" style="min-height:80px;"></div>
        </div>
      </div>
    </section>

    <!-- Notices -->
    <section id="pgNotice" class="pg">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
        <h2 class="pg-title" style="margin:0;">ê³µì§€ì‚¬í•­</h2>
        <button class="btn btn-primary" onclick="App.notice.openNew()">+ ìƒˆ ê³µì§€</button>
      </div>
      <div id="noticeList" style="margin-top:20px;"></div>
    </section>

    <!-- Dining Finder -->
    <section id="pgDining" class="pg">
      <h2 class="pg-title">ë§›ì§‘ ì°¾ê¸°</h2>
      <div class="din-form">
        <select id="selRegion" class="din-sel">
          <option value="">ì§€ì—­ ì„ íƒ</option>
          <option>ê°•ë‚¨</option><option>í™ëŒ€</option><option>ì´íƒœì›</option>
          <option>ì¢…ë¡œ</option><option>ì‹ ì´Œ</option><option>ì—¬ì˜ë„</option>
          <option>ë§ˆí¬</option><option>ì„±ìˆ˜</option><option>ì„ì§€ë¡œ</option>
          <option>ê´‘í™”ë¬¸</option><option>ì ì‹¤</option><option>ê±´ëŒ€</option>
        </select>
        <select id="selFood" class="din-sel">
          <option value="">ìŒì‹ ì¢…ë¥˜</option>
          <option>í•œì‹</option><option>ì¤‘ì‹</option><option>ì¼ì‹</option>
          <option>ì–‘ì‹</option><option>ê³ ê¸°</option><option>í•´ì‚°ë¬¼</option>
          <option>ì¹˜í‚¨</option><option>ë¶„ì‹</option><option>ì¹´í˜</option>
        </select>
        <select id="selPeople" class="din-sel">
          <option value="">ì¸ì›</option>
          <option>2</option><option>4</option><option>6</option>
          <option>8</option><option>10</option><option>20</option>
        </select>
        <button class="btn btn-primary din-btn" onclick="App.din.search()">ê²€ìƒ‰</button>
      </div>
      <div id="dinResult" style="margin-top:20px;"></div>
    </section>

    <!-- Dining Log -->
    <section id="pgDinLog" class="pg">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
        <h2 class="pg-title" style="margin:0;">íšŒì‹ ì¥ë¶€</h2>
        <button class="btn btn-primary" onclick="App.dl.openNew()">+ ìƒˆ ê¸°ë¡</button>
      </div>
      <div id="dlSummary" style="margin-top:16px;"></div>
      <div style="overflow-x:auto;margin-top:12px;">
        <table class="dl-tbl">
          <thead><tr><th>ë‚ ì§œ</th><th>ì¥ì†Œ</th><th>ì¸ì›</th><th>ê¸ˆì•¡</th><th>ë©”ëª¨</th><th>ì‘ì„±ì</th><th></th></tr></thead>
          <tbody id="dlBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Calendar -->
    <section id="pgCal" class="pg">
      <h2 class="pg-title">ìº˜ë¦°ë”</h2>
      <div id="calAuth" style="text-align:center;padding:40px;">
        <p style="color:#64748b;margin-bottom:16px;">Google ìº˜ë¦°ë”ì™€ ì—°ë™í•˜ì—¬ ì¼ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
        <button class="btn btn-primary" onclick="App.cal.authorize()" style="padding:12px 32px;">
          <svg width="18" height="18" viewBox="0 0 48 48" style="vertical-align:middle;margin-right:8px;"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59A14.5 14.5 0 0 1 9.5 24c0-1.59.28-3.14.76-4.59l-7.98-6.19A23.998 23.998 0 0 0 0 24c0 3.77.87 7.35 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Google ìº˜ë¦°ë” ì—°ë™
        </button>
      </div>
      <div id="calMain" style="display:none;">
        <div class="cal-hd">
          <button class="cal-nav" onclick="App.cal.prev()">â—€</button>
          <span id="calTitle" class="cal-title"></span>
          <button class="cal-nav" onclick="App.cal.next()">â–¶</button>
          <button class="btn" style="margin-left:12px;padding:4px 14px;font-size:13px;" onclick="App.cal.today()">ì˜¤ëŠ˜</button>
          <button class="btn btn-primary" style="margin-left:auto;padding:6px 16px;font-size:13px;" onclick="App.cal.openNew()">+ ì¼ì •</button>
        </div>
        <div class="cal-grid">
          <div class="cal-day-hd">ì¼</div><div class="cal-day-hd">ì›”</div><div class="cal-day-hd">í™”</div>
          <div class="cal-day-hd">ìˆ˜</div><div class="cal-day-hd">ëª©</div><div class="cal-day-hd">ê¸ˆ</div>
          <div class="cal-day-hd">í† </div>
        </div>
        <div id="calBody" class="cal-grid"></div>
        <div style="margin-top:24px;">
          <h3 style="font-size:16px;font-weight:600;margin-bottom:12px;">ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</h3>
          <div id="calUpcoming"></div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- ===== Modals ===== -->
<!-- Notice Modal -->
<div id="modNotice" class="modal-overlay" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <div class="modal-hd"><span id="modNoticeTitle">ìƒˆ ê³µì§€</span><button class="modal-x" onclick="$('modNotice').style.display='none'">&times;</button></div>
    <div class="modal-bd">
      <input id="nTitle" class="form-input" placeholder="ì œëª©">
      <textarea id="nBody" class="form-input" rows="5" placeholder="ë‚´ìš©"></textarea>
      <select id="nPriority" class="form-input">
        <option value="normal">ì¼ë°˜</option>
        <option value="important">ì¤‘ìš”</option>
        <option value="urgent">ê¸´ê¸‰</option>
      </select>
    </div>
    <div class="modal-ft">
      <button class="btn" onclick="$('modNotice').style.display='none'">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="App.notice.save()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- Dining Log Modal -->
<div id="modDL" class="modal-overlay" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <div class="modal-hd"><span id="modDLTitle">ìƒˆ íšŒì‹ ê¸°ë¡</span><button class="modal-x" onclick="$('modDL').style.display='none'">&times;</button></div>
    <div class="modal-bd">
      <label class="form-label">ë‚ ì§œ</label><input id="dlDate" class="form-input" type="date">
      <label class="form-label">ì¥ì†Œ</label><input id="dlPlace" class="form-input" placeholder="ì¥ì†Œëª…">
      <label class="form-label">ì¸ì›</label><input id="dlPpl" class="form-input" type="number" placeholder="ì¸ì› ìˆ˜">
      <label class="form-label">ê¸ˆì•¡ (ì›)</label><input id="dlAmt" class="form-input" type="number" placeholder="ì´ ê¸ˆì•¡">
      <label class="form-label">ë©”ëª¨</label><textarea id="dlMemo" class="form-input" rows="2" placeholder="ë©”ëª¨"></textarea>
    </div>
    <div class="modal-ft">
      <button class="btn" onclick="$('modDL').style.display='none'">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="App.dl.save()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- Calendar Event Modal -->
<div id="modCal" class="modal-overlay" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <div class="modal-hd"><span id="modCalTitle">ìƒˆ ì¼ì •</span><button class="modal-x" onclick="$('modCal').style.display='none'">&times;</button></div>
    <div class="modal-bd">
      <label class="form-label">ì œëª©</label><input id="cEvtTitle" class="form-input" placeholder="ì¼ì • ì œëª©">
      <label class="form-label">ì‹œì‘</label><input id="cEvtStart" class="form-input" type="datetime-local">
      <label class="form-label">ì¢…ë£Œ</label><input id="cEvtEnd" class="form-input" type="datetime-local">
      <label class="form-label">ì¥ì†Œ</label><input id="cEvtLoc" class="form-input" placeholder="ì¥ì†Œ (ì„ íƒ)">
      <label class="form-label">ì„¤ëª…</label><textarea id="cEvtDesc" class="form-input" rows="2" placeholder="ì„¤ëª… (ì„ íƒ)"></textarea>
      <label class="form-label">ì•Œë¦¼</label>
      <select id="cEvtReminder" class="form-input">
        <option value="10">10ë¶„ ì „</option>
        <option value="30" selected>30ë¶„ ì „</option>
        <option value="60">1ì‹œê°„ ì „</option>
        <option value="1440">1ì¼ ì „</option>
      </select>
    </div>
    <div class="modal-ft">
      <button class="btn btn-danger" id="cEvtDel" style="display:none;margin-right:auto;" onclick="App.cal.deleteEvent()">ì‚­ì œ</button>
      <button class="btn" onclick="$('modCal').style.display='none'">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="App.cal.saveEvent()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- Chatbot -->
<button id="chatToggle" class="chat-toggle" onclick="App.chat.toggle()">ğŸ’¬</button>
<div id="chatPanel" class="chat-panel">
  <div class="chat-hd">
    <span>WorkHub ì±—ë´‡</span>
    <button style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;" onclick="App.chat.toggle()">&times;</button>
  </div>
  <div id="chatBody" class="chat-body">
    <div class="chat-msg chat-bot">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?<br>
    <small style="color:#94a3b8;">ì˜ˆ: "ë‚´ì¼ 3ì‹œ íšŒì˜ ì¼ì • ë“±ë¡", "ì˜¤ëŠ˜ ì¼ì • ì•Œë ¤ì¤˜", "ê³µì§€ ë“±ë¡ ì œëª©: ë‚´ìš©"</small></div>
  </div>
  <div class="chat-ft">
    <input id="chatIn" class="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeydown="if(event.key==='Enter')App.chat.send()">
    <button class="chat-send" onclick="App.chat.send()">ì „ì†¡</button>
  </div>
</div>
<script>
/* ========== helpers ========== */
const $=id=>document.getElementById(id);
function toast(m,t){const b=$('toastBox'),d=document.createElement('div');d.style.cssText='padding:12px 20px;background:#1e293b;color:#fff;border-radius:10px;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,.15);opacity:0;transform:translateY(-8px);transition:all .3s;max-width:320px;';d.textContent=m;b.appendChild(d);requestAnimationFrame(()=>{d.style.opacity='1';d.style.transform='translateY(0)';});setTimeout(()=>{d.style.opacity='0';d.style.transform='translateY(-8px)';setTimeout(()=>d.remove(),300);},t||3000);}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function tAgo(ts){if(!ts)return'';const s=Math.floor((Date.now()-ts.toDate().getTime())/1000);if(s<60)return'ë°©ê¸ˆ ì „';if(s<3600)return Math.floor(s/60)+'ë¶„ ì „';if(s<86400)return Math.floor(s/3600)+'ì‹œê°„ ì „';return Math.floor(s/86400)+'ì¼ ì „';}
function fmtDate(d){return d?new Date(d).toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'}):'';}
function fmtMoney(n){return n?Number(n).toLocaleString('ko-KR')+'ì›':'';}

/* ========== Firebase ========== */
firebase.initializeApp({apiKey:"AIzaSyA0Vy3pR-sFNnxgM1F6MFWGP_0mDfpkuBo",authDomain:"workhub2-ad595.firebaseapp.com",projectId:"workhub2-ad595"});
const db=firebase.firestore();

/* ========== Google Calendar config ========== */
const GCAL_CLIENT_ID='535238333900-f0746m5heeijpb55ulhfbm2l15c57r7k.apps.googleusercontent.com';
const GCAL_API_KEY='AIzaSyDcHSt46CHlu_LZYnNUU7xwIlMY7xE8KdU';
const GCAL_DISC='https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
const GCAL_SCOPE='https://www.googleapis.com/auth/calendar';
let gapiInited=false,gisInited=false,tokenClient=null;

/* ========== state ========== */
const S={user:null,calYear:new Date().getFullYear(),calMonth:new Date().getMonth(),calEvents:[],editEvtId:null};

/* ========== App ========== */
const App={};

/* ---------- auth ---------- */
App.auth={
  googleLogin(){
    const prov=new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(prov).catch(e=>toast('ë¡œê·¸ì¸ ì‹¤íŒ¨: '+e.message));
  },
  logout(){
    firebase.auth().signOut();
  },
  onUser(u){
    if(u){
      S.user=u;
      const nm=u.displayName||u.email.split('@')[0];
      $('pgLogin').style.display='none';
      $('appShell').style.display='flex';
      if($('hUsr'))$('hUsr').textContent=nm;
      App.dash.load();App.notice.load();App.dl.load();
    }else{
      S.user=null;
      $('pgLogin').style.display='flex';
      $('appShell').style.display='none';
    }
  }
};
firebase.auth().onAuthStateChanged(App.auth.onUser);

/* ---------- routing ---------- */
App.rt={
  go(pg){
    document.querySelectorAll('.pg').forEach(p=>p.classList.remove('pg--on'));
    $(pg).classList.add('pg--on');
    document.querySelectorAll('.sb-lk').forEach(a=>{
      const wasOn=a.classList.contains('sb-lk--on');
      a.classList.remove('sb-lk--on');
      if(a.dataset.pg===pg){
        a.classList.add('sb-lk--on');
        if(!wasOn){a.style.animation='none';a.offsetHeight;a.style.animation='menuFlash .4s ease-out';}
      }
    });
    document.querySelector('.sb').classList.remove('sb--open');
    if(pg==='pgDash')App.dash.load();
    if(pg==='pgCal')App.cal.show();
  }
};

/* ---------- dashboard ---------- */
App.dash={
  async load(){
    /* stats */
    const ns=await db.collection('notices').get();
    const ds=await db.collection('dinlog').get();
    let total=0;ds.forEach(d=>total+=Number(d.data().amount||0));
    const upcoming=S.calEvents.filter(e=>{const d=new Date(e.start.dateTime||e.start.date);return d>=new Date();}).length;
    $('dashStats').innerHTML=`
      <div class="stat-card"><div class="stat-num">${ns.size}</div><div class="stat-lbl">ê³µì§€ì‚¬í•­</div></div>
      <div class="stat-card"><div class="stat-num">${ds.size}</div><div class="stat-lbl">íšŒì‹ ê¸°ë¡</div></div>
      <div class="stat-card"><div class="stat-num">${fmtMoney(total)}</div><div class="stat-lbl">ì´ íšŒì‹ë¹„</div></div>
      <div class="stat-card"><div class="stat-num">${upcoming}</div><div class="stat-lbl">ì˜ˆì • ì¼ì •</div></div>`;
    /* recent notices */
    const rn=[];ns.forEach(d=>rn.push({id:d.id,...d.data()}));
    rn.sort((a,b)=>(b.created?.toMillis()||0)-(a.created?.toMillis()||0));
    $('dashNotice').innerHTML=rn.slice(0,3).map(n=>`<div style="padding:8px 0;border-bottom:1px solid #f1f5f9;"><strong>${esc(n.title)}</strong> <span style="color:#94a3b8;font-size:12px;">${tAgo(n.created)}</span></div>`).join('')||'<p style="color:#94a3b8;">ê³µì§€ ì—†ìŒ</p>';
    /* upcoming calendar */
    const ue=S.calEvents.filter(e=>{const d=new Date(e.start.dateTime||e.start.date);return d>=new Date();}).slice(0,3);
    $('dashCal').innerHTML=ue.map(e=>`<div style="padding:8px 0;border-bottom:1px solid #f1f5f9;">${esc(e.summary||'(ì œëª©ì—†ìŒ)')} <span style="color:#94a3b8;font-size:12px;">${fmtDate(e.start.dateTime||e.start.date)}</span></div>`).join('')||'<p style="color:#94a3b8;">ì˜ˆì • ì¼ì • ì—†ìŒ</p>';
    /* recent dinlog */
    const rd=[];ds.forEach(d=>rd.push({id:d.id,...d.data()}));
    rd.sort((a,b)=>(b.date||'').localeCompare(a.date||''));
    $('dashDinLog').innerHTML=rd.slice(0,3).map(d=>`<div style="padding:8px 0;border-bottom:1px solid #f1f5f9;">${esc(d.place||'')} <span style="color:#94a3b8;font-size:12px;">${d.date||''} Â· ${fmtMoney(d.amount)}</span></div>`).join('')||'<p style="color:#94a3b8;">ê¸°ë¡ ì—†ìŒ</p>';
  }
};

/* ---------- notices ---------- */
App.notice={
  editId:null,
  async load(){
    const snap=await db.collection('notices').orderBy('created','desc').get();
    let h='';
    snap.forEach(d=>{const n=d.data();const pri=n.priority||'normal';
      const badge=pri==='urgent'?'<span class="badge badge-red">ê¸´ê¸‰</span>':pri==='important'?'<span class="badge badge-yellow">ì¤‘ìš”</span>':'';
      h+=`<div class="card" style="margin-bottom:12px;cursor:pointer;" onclick="App.notice.edit('${d.id}')">
        <div class="card-hd">${badge} ${esc(n.title)}<span style="float:right;font-size:12px;color:#94a3b8;">${tAgo(n.created)} Â· ${esc(n.author||'')}</span></div>
        <div class="card-bd" style="white-space:pre-wrap;">${esc(n.body||'')}</div></div>`;
    });
    $('noticeList').innerHTML=h||'<p style="color:#94a3b8;text-align:center;">ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
  },
  openNew(){this.editId=null;$('modNoticeTitle').textContent='ìƒˆ ê³µì§€';$('nTitle').value='';$('nBody').value='';$('nPriority').value='normal';$('modNotice').style.display='flex';},
  async edit(id){
    const d=await db.collection('notices').doc(id).get();if(!d.exists)return;
    const n=d.data();this.editId=id;$('modNoticeTitle').textContent='ê³µì§€ ìˆ˜ì •';$('nTitle').value=n.title||'';$('nBody').value=n.body||'';$('nPriority').value=n.priority||'normal';$('modNotice').style.display='flex';
  },
  async save(){
    const t=$('nTitle').value.trim(),b=$('nBody').value.trim();if(!t){toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');return;}
    const data={title:t,body:b,priority:$('nPriority').value,author:S.user.displayName||S.user.email,authorUid:S.user.uid,updated:firebase.firestore.FieldValue.serverTimestamp()};
    if(this.editId){await db.collection('notices').doc(this.editId).update(data);toast('ê³µì§€ ìˆ˜ì • ì™„ë£Œ');}
    else{data.created=firebase.firestore.FieldValue.serverTimestamp();await db.collection('notices').add(data);toast('ê³µì§€ ë“±ë¡ ì™„ë£Œ');}
    $('modNotice').style.display='none';this.load();App.dash.load();
  }
};

/* ---------- dining finder ---------- */
App.din={
  search(){
    const r=$('selRegion').value,f=$('selFood').value,p=$('selPeople').value;
    if(!r||!f){toast('ì§€ì—­ê³¼ ìŒì‹ì„ ì„ íƒí•˜ì„¸ìš”');return;}
    const q=r+' '+f+(p?' '+p+'ì¸':'');
    const mapUrl='https://map.naver.com/v5/search/'+encodeURIComponent(q);
    let mc=$('mapResult');
    if(!mc){mc=document.createElement('div');mc.id='mapResult';$('dinResult').appendChild(mc);}
    mc.style.cssText='width:100%;height:500px;margin-top:16px;border-radius:12px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,.1);background:#f0f0f0;';
    mc.innerHTML='<div style="text-align:center;padding:20px;color:#888;">ì§€ë„ ë¡œë”© ì¤‘...</div>';
    const iframe=document.createElement('iframe');
    iframe.src=mapUrl;iframe.style.cssText='width:100%;height:100%;border:none;';iframe.allowFullscreen=true;
    mc.innerHTML='';mc.appendChild(iframe);
    /* fallback: open new tab after 3s if blocked */
    setTimeout(()=>{try{if(!iframe.contentWindow.length&&iframe.contentWindow.length!==undefined){}}catch(e){/* cross-origin expected */}},3000);
    /* link to open in new tab */
    let link=document.getElementById('mapLink');
    if(!link){link=document.createElement('a');link.id='mapLink';link.target='_blank';link.style.cssText='display:inline-block;margin-top:8px;color:var(--primary);font-size:13px;';$('dinResult').appendChild(link);}
    link.href=mapUrl;link.textContent='ìƒˆ ì°½ì—ì„œ ë„¤ì´ë²„ ì§€ë„ ì—´ê¸° â†’';
    toast('"'+q+'" ê²€ìƒ‰ ê²°ê³¼');
  }
};

/* ---------- dining log ---------- */
App.dl={
  editId:null,
  async load(){
    const snap=await db.collection('dinlog').orderBy('date','desc').get();
    let h='',total=0,cnt=0;
    snap.forEach(d=>{const r=d.data();cnt++;total+=Number(r.amount||0);
      h+=`<tr style="cursor:pointer;" onclick="App.dl.edit('${d.id}')">
        <td>${esc(r.date||'')}</td><td>${esc(r.place||'')}</td><td>${r.people||''}</td>
        <td>${fmtMoney(r.amount)}</td><td>${esc(r.memo||'')}</td><td>${esc(r.author||'')}</td>
        <td><button class="btn btn-danger" style="padding:4px 10px;font-size:12px;" onclick="event.stopPropagation();App.dl.del('${d.id}')">ì‚­ì œ</button></td></tr>`;
    });
    $('dlBody').innerHTML=h||'<tr><td colspan="7" style="text-align:center;color:#94a3b8;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    $('dlSummary').innerHTML=`<div style="display:flex;gap:24px;flex-wrap:wrap;">
      <div class="stat-card"><div class="stat-num">${cnt}</div><div class="stat-lbl">ì´ íšŒì‹</div></div>
      <div class="stat-card"><div class="stat-num">${fmtMoney(total)}</div><div class="stat-lbl">ì´ ê¸ˆì•¡</div></div>
      <div class="stat-card"><div class="stat-num">${cnt?fmtMoney(Math.round(total/cnt)):'-'}</div><div class="stat-lbl">í‰ê·  ê¸ˆì•¡</div></div></div>`;
  },
  openNew(){this.editId=null;$('modDLTitle').textContent='ìƒˆ íšŒì‹ ê¸°ë¡';$('dlDate').value=new Date().toISOString().slice(0,10);$('dlPlace').value='';$('dlPpl').value='';$('dlAmt').value='';$('dlMemo').value='';$('modDL').style.display='flex';},
  async edit(id){
    const d=await db.collection('dinlog').doc(id).get();if(!d.exists)return;
    const r=d.data();this.editId=id;$('modDLTitle').textContent='ê¸°ë¡ ìˆ˜ì •';$('dlDate').value=r.date||'';$('dlPlace').value=r.place||'';$('dlPpl').value=r.people||'';$('dlAmt').value=r.amount||'';$('dlMemo').value=r.memo||'';$('modDL').style.display='flex';
  },
  async save(){
    const place=$('dlPlace').value.trim();if(!place){toast('ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”');return;}
    const data={date:$('dlDate').value,place,people:Number($('dlPpl').value)||0,amount:Number($('dlAmt').value)||0,memo:$('dlMemo').value.trim(),author:S.user.displayName||S.user.email,authorUid:S.user.uid};
    if(this.editId){await db.collection('dinlog').doc(this.editId).update(data);toast('ìˆ˜ì • ì™„ë£Œ');}
    else{data.created=firebase.firestore.FieldValue.serverTimestamp();await db.collection('dinlog').add(data);toast('ê¸°ë¡ ì¶”ê°€ ì™„ë£Œ');}
    $('modDL').style.display='none';this.load();App.dash.load();
  },
  async del(id){if(!confirm('ì‚­ì œí• ê¹Œìš”?'))return;await db.collection('dinlog').doc(id).delete();toast('ì‚­ì œ ì™„ë£Œ');this.load();App.dash.load();}
};

/* ---------- calendar ---------- */
App.cal={
  show(){
    if(!gapiInited||!gisInited){
      $('calAuth').style.display='block';$('calMain').style.display='none';return;
    }
    if(gapi.client.getToken()){$('calAuth').style.display='none';$('calMain').style.display='block';this.render();this.fetchEvents();}
    else{$('calAuth').style.display='block';$('calMain').style.display='none';}
  },
  authorize(){
    if(!tokenClient){toast('Google API ë¡œë”© ì¤‘... ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”');return;}
    tokenClient.requestAccessToken({prompt:'consent'});
  },
  prev(){S.calMonth--;if(S.calMonth<0){S.calMonth=11;S.calYear--;}this.render();this.fetchEvents();},
  next(){S.calMonth++;if(S.calMonth>11){S.calMonth=0;S.calYear++;}this.render();this.fetchEvents();},
  today(){S.calYear=new Date().getFullYear();S.calMonth=new Date().getMonth();this.render();this.fetchEvents();},
  render(){
    const y=S.calYear,m=S.calMonth;
    $('calTitle').textContent=y+'ë…„ '+(m+1)+'ì›”';
    const first=new Date(y,m,1).getDay();
    const last=new Date(y,m+1,0).getDate();
    const todayStr=new Date().toISOString().slice(0,10);
    let h='';
    for(let i=0;i<first;i++)h+='<div class="cal-cell cal-empty"></div>';
    for(let d=1;d<=last;d++){
      const ds=y+'-'+String(m+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
      const isToday=ds===todayStr?' cal-today':'';
      const evts=S.calEvents.filter(e=>(e.start.dateTime||e.start.date||'').startsWith(ds));
      let dots=evts.slice(0,3).map(e=>`<div class="cal-evt" title="${esc(e.summary||'')}" onclick="event.stopPropagation();App.cal.editEvent('${e.id}')">${esc((e.summary||'').slice(0,8))}</div>`).join('');
      if(evts.length>3)dots+=`<div style="font-size:10px;color:#94a3b8;">+${evts.length-3}ê°œ</div>`;
      h+=`<div class="cal-cell${isToday}" onclick="App.cal.openNewOnDate('${ds}')"><div class="cal-date">${d}</div>${dots}</div>`;
    }
    $('calBody').innerHTML=h;
  },
  async fetchEvents(){
    try{
      const tMin=new Date(S.calYear,S.calMonth,1).toISOString();
      const tMax=new Date(S.calYear,S.calMonth+1,0,23,59,59).toISOString();
      const res=await gapi.client.calendar.events.list({calendarId:'primary',timeMin:tMin,timeMax:tMax,singleEvents:true,orderBy:'startTime',maxResults:100});
      S.calEvents=res.result.items||[];
      this.render();this.renderUpcoming();App.dash.load();
    }catch(e){console.error(e);toast('ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');}
  },
  renderUpcoming(){
    const now=new Date();
    const ue=S.calEvents.filter(e=>{const d=new Date(e.start.dateTime||e.start.date);return d>=now;}).slice(0,5);
    $('calUpcoming').innerHTML=ue.map(e=>{
      const dt=e.start.dateTime?new Date(e.start.dateTime).toLocaleString('ko-KR',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}):fmtDate(e.start.date);
      return`<div class="card" style="margin-bottom:8px;padding:12px;cursor:pointer;" onclick="App.cal.editEvent('${e.id}')">
        <strong>${esc(e.summary||'(ì œëª©ì—†ìŒ)')}</strong><br><span style="font-size:13px;color:#64748b;">${dt}${e.location?' Â· '+esc(e.location):''}</span></div>`;
    }).join('')||'<p style="color:#94a3b8;">ì´ë²ˆ ë‹¬ ì˜ˆì • ì¼ì • ì—†ìŒ</p>';
  },
  openNew(){
    S.editEvtId=null;$('modCalTitle').textContent='ìƒˆ ì¼ì •';$('cEvtTitle').value='';
    const now=new Date();now.setMinutes(0,0,0);now.setHours(now.getHours()+1);
    const end=new Date(now.getTime()+3600000);
    $('cEvtStart').value=toLocalDT(now);$('cEvtEnd').value=toLocalDT(end);
    $('cEvtLoc').value='';$('cEvtDesc').value='';$('cEvtReminder').value='30';$('cEvtDel').style.display='none';$('modCal').style.display='flex';
  },
  openNewOnDate(ds){
    S.editEvtId=null;$('modCalTitle').textContent='ìƒˆ ì¼ì •';$('cEvtTitle').value='';
    const st=new Date(ds+'T09:00');const en=new Date(ds+'T10:00');
    $('cEvtStart').value=toLocalDT(st);$('cEvtEnd').value=toLocalDT(en);
    $('cEvtLoc').value='';$('cEvtDesc').value='';$('cEvtReminder').value='30';$('cEvtDel').style.display='none';$('modCal').style.display='flex';
  },
  editEvent(id){
    const ev=S.calEvents.find(e=>e.id===id);if(!ev)return;
    S.editEvtId=id;$('modCalTitle').textContent='ì¼ì • ìˆ˜ì •';$('cEvtTitle').value=ev.summary||'';
    if(ev.start.dateTime){$('cEvtStart').value=toLocalDT(new Date(ev.start.dateTime));$('cEvtEnd').value=toLocalDT(new Date(ev.end.dateTime));}
    else{$('cEvtStart').value=ev.start.date+'T09:00';$('cEvtEnd').value=ev.end.date+'T10:00';}
    $('cEvtLoc').value=ev.location||'';$('cEvtDesc').value=ev.description||'';$('cEvtReminder').value='30';$('cEvtDel').style.display='inline-block';$('modCal').style.display='flex';
  },
  async saveEvent(){
    const title=$('cEvtTitle').value.trim();if(!title){toast('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');return;}
    const body={summary:title,location:$('cEvtLoc').value.trim(),description:$('cEvtDesc').value.trim(),
      start:{dateTime:new Date($('cEvtStart').value).toISOString(),timeZone:'Asia/Seoul'},
      end:{dateTime:new Date($('cEvtEnd').value).toISOString(),timeZone:'Asia/Seoul'},
      reminders:{useDefault:false,overrides:[{method:'popup',minutes:Number($('cEvtReminder').value)}]}};
    try{
      if(S.editEvtId){await gapi.client.calendar.events.update({calendarId:'primary',eventId:S.editEvtId,resource:body});toast('ì¼ì • ìˆ˜ì • ì™„ë£Œ');}
      else{await gapi.client.calendar.events.insert({calendarId:'primary',resource:body});toast('ì¼ì • ë“±ë¡ ì™„ë£Œ');}
      $('modCal').style.display='none';this.fetchEvents();
    }catch(e){console.error(e);toast('ì €ì¥ ì‹¤íŒ¨: '+e.message);}
  },
  async deleteEvent(){
    if(!S.editEvtId||!confirm('ì´ ì¼ì •ì„ ì‚­ì œí• ê¹Œìš”?'))return;
    try{await gapi.client.calendar.events.delete({calendarId:'primary',eventId:S.editEvtId});toast('ì¼ì • ì‚­ì œ ì™„ë£Œ');$('modCal').style.display='none';this.fetchEvents();}
    catch(e){toast('ì‚­ì œ ì‹¤íŒ¨');}
  }
};
function toLocalDT(d){return new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,16);}

/* ---------- GAPI init ---------- */
function gapiLoaded(){
  gapi.load('client',async()=>{
    await gapi.client.init({apiKey:GCAL_API_KEY,discoveryDocs:[GCAL_DISC]});
    gapiInited=true;maybeEnableCal();
  });
}
function gisLoaded(){
  tokenClient=google.accounts.oauth2.initTokenClient({client_id:GCAL_CLIENT_ID,scope:GCAL_SCOPE,
    callback(resp){
      if(resp.error)return;
      $('calAuth').style.display='none';$('calMain').style.display='block';
      App.cal.render();App.cal.fetchEvents();toast('Google ìº˜ë¦°ë” ì—°ë™ ì™„ë£Œ');
    }
  });
  gisInited=true;maybeEnableCal();
}
function maybeEnableCal(){if(gapiInited&&gisInited&&gapi.client.getToken()){App.cal.show();}}
/* attach to global callbacks */
window.addEventListener('load',()=>{
  if(typeof gapi!=='undefined')gapiLoaded();
  if(typeof google!=='undefined'&&google.accounts)gisLoaded();
});

/* ---------- chatbot ---------- */
App.chat={
  open:false,
  toggle(){this.open=!this.open;$('chatPanel').classList.toggle('chat-panel--open',this.open);},
  addMsg(text,who){
    const d=document.createElement('div');d.className='chat-msg '+(who==='bot'?'chat-bot':'chat-user');d.innerHTML=text;$('chatBody').appendChild(d);$('chatBody').scrollTop=$('chatBody').scrollHeight;
  },
  async send(){
    const inp=$('chatIn'),txt=inp.value.trim();if(!txt)return;
    this.addMsg(esc(txt),'user');inp.value='';
    /* parse */
    const t=txt.toLowerCase();
    if(t.includes('ì¼ì •')&&(t.includes('ë“±ë¡')||t.includes('ì¶”ê°€')||t.includes('ë§Œë“¤'))){
      this.addMsg(this.parseAndCreateEvent(txt),'bot');
    }else if(t.includes('ì˜¤ëŠ˜')&&t.includes('ì¼ì •')){
      this.addMsg(this.todayEvents(),'bot');
    }else if(t.includes('ë‚´ì¼')&&t.includes('ì¼ì •')){
      this.addMsg(this.tomorrowEvents(),'bot');
    }else if(t.includes('ê³µì§€')&&(t.includes('ë“±ë¡')||t.includes('ì‘ì„±'))){
      this.addMsg(this.parseNotice(txt),'bot');
    }else if(t.includes('ë§›ì§‘')||t.includes('íšŒì‹ì¥ì†Œ')){
      this.addMsg('ğŸ½ï¸ ë§›ì§‘ ì°¾ê¸° í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤!','bot');App.rt.go('pgDining');
    }else{
      this.addMsg('ì£„ì†¡í•©ë‹ˆë‹¤. ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”.<br><small>ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹: "ì¼ì • ë“±ë¡", "ì˜¤ëŠ˜ ì¼ì •", "ë‚´ì¼ ì¼ì •", "ê³µì§€ ë“±ë¡ ì œëª©:ë‚´ìš©", "ë§›ì§‘"</small>','bot');
    }
  },
  parseAndCreateEvent(txt){
    if(!gapi.client.getToken())return'ë¨¼ì € ìº˜ë¦°ë” ì—°ë™ì„ í•´ì£¼ì„¸ìš”.';
    let title='ìƒˆ ì¼ì •',hour=9,min=0;
    const timeMatch=txt.match(/(\d{1,2})[ì‹œ:](\d{0,2})/);
    if(timeMatch){hour=parseInt(timeMatch[1]);min=parseInt(timeMatch[2])||0;}
    const titleMatch=txt.match(/(?:ë“±ë¡|ì¶”ê°€|ë§Œë“¤[ì–´ê¸°])\s+(.+?)(?:\s+\d|$)/);
    if(titleMatch)title=titleMatch[1].trim();
    else{const parts=txt.split(/ë“±ë¡|ì¶”ê°€|ë§Œë“¤/);if(parts[1])title=parts[1].replace(/\d{1,2}[ì‹œ:]\d{0,2}/g,'').trim()||title;}
    let day=new Date();
    if(txt.includes('ë‚´ì¼'))day.setDate(day.getDate()+1);
    if(txt.includes('ëª¨ë ˆ'))day.setDate(day.getDate()+2);
    const st=new Date(day.getFullYear(),day.getMonth(),day.getDate(),hour,min);
    const en=new Date(st.getTime()+3600000);
    gapi.client.calendar.events.insert({calendarId:'primary',resource:{
      summary:title,start:{dateTime:st.toISOString(),timeZone:'Asia/Seoul'},end:{dateTime:en.toISOString(),timeZone:'Asia/Seoul'},
      reminders:{useDefault:false,overrides:[{method:'popup',minutes:30}]}
    }}).then(()=>{toast('ì¼ì • ë“±ë¡ ì™„ë£Œ');App.cal.fetchEvents();});
    return`ğŸ“… ì¼ì •ì„ ë“±ë¡í•©ë‹ˆë‹¤!<br><strong>${esc(title)}</strong><br>${st.toLocaleString('ko-KR',{month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}`;
  },
  todayEvents(){
    const today=new Date().toISOString().slice(0,10);
    const evts=S.calEvents.filter(e=>(e.start.dateTime||e.start.date||'').startsWith(today));
    if(!evts.length)return'ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
    return'ğŸ“‹ ì˜¤ëŠ˜ ì¼ì •:<br>'+evts.map(e=>{
      const t=e.start.dateTime?new Date(e.start.dateTime).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}):'ì¢…ì¼';
      return`â€¢ ${t} - ${esc(e.summary||'(ì œëª©ì—†ìŒ)')}`;}).join('<br>');
  },
  tomorrowEvents(){
    const tm=new Date();tm.setDate(tm.getDate()+1);const ds=tm.toISOString().slice(0,10);
    const evts=S.calEvents.filter(e=>(e.start.dateTime||e.start.date||'').startsWith(ds));
    if(!evts.length)return'ë‚´ì¼ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
    return'ğŸ“‹ ë‚´ì¼ ì¼ì •:<br>'+evts.map(e=>{
      const t=e.start.dateTime?new Date(e.start.dateTime).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}):'ì¢…ì¼';
      return`â€¢ ${t} - ${esc(e.summary||'(ì œëª©ì—†ìŒ)')}`;}).join('<br>');
  },
  parseNotice(txt){
    const m=txt.match(/ì œëª©[:\s]*(.+?)(?:\s+ë‚´ìš©[:\s]*(.+))?$/i);
    if(!m)return'í˜•ì‹: "ê³µì§€ ë“±ë¡ ì œëª©: OO ë‚´ìš©: OO"';
    const title=m[1].trim(),body=(m[2]||'').trim();
    db.collection('notices').add({title,body,priority:'normal',author:S.user.displayName||S.user.email,authorUid:S.user.uid,created:firebase.firestore.FieldValue.serverTimestamp()});
    App.notice.load();App.dash.load();toast('ê³µì§€ ë“±ë¡ ì™„ë£Œ');
    return`ğŸ“‹ ê³µì§€ë¥¼ ë“±ë¡í–ˆìŠµë‹ˆë‹¤!<br><strong>${esc(title)}</strong>${body?'<br>'+esc(body):''}`;
  }
};
</script>
</body>
</html>

