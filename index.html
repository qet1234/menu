<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkHub - ìŠ¤ë§ˆíŠ¸ ê·¸ë£¹ì›¨ì–´</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --c-p50:#f0f9ff;--c-p100:#e0f2fe;
            --c-p500:#0ea5e9;--c-p600:#0284c7;
            --c-a500:#8b5cf6;--c-a600:#7c3aed;
            --c-ok100:#dcfce7;--c-ok500:#22c55e;
            --c-ok600:#16a34a;--c-ok800:#166534;
            --c-w100:#fef3c7;--c-w800:#92400e;
            --c-err50:#fef2f2;--c-err500:#ef4444;
            --c-err600:#dc2626;
            --c-or500:#f97316;
            --c-s50:#f8fafc;--c-s100:#f1f5f9;
            --c-s200:#e2e8f0;--c-s300:#cbd5e1;
            --c-s400:#94a3b8;--c-s500:#64748b;
            --c-s600:#475569;--c-s700:#334155;
            --c-s800:#1e293b;--c-s900:#0f172a;
            --grad:linear-gradient(135deg,var(--c-p500),var(--c-a500));
            --ff:'Noto Sans KR',-apple-system,BlinkMacSystemFont,sans-serif;
            --fd:'Playfair Display',Georgia,serif;
            --hh:64px;--sw:256px;
            --ease-out:cubic-bezier(.4,0,.2,1);
        }
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        html{-webkit-font-smoothing:antialiased}
        body{font-family:var(--ff);font-size:1rem;color:var(--c-s800);background:var(--c-s50);line-height:1.6;min-height:100vh;overflow-x:hidden}
        button{font-family:var(--ff);cursor:pointer;border:none;background:none}
        input,textarea,select{font-family:var(--ff);border:none;outline:none}
        img{max-width:100%;display:block}
        [hidden]{display:none!important}
        .logo{font-family:var(--fd)}

        @keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
        @keyframes slideRight{from{opacity:0;transform:translateX(24px)}to{opacity:1;transform:translateX(0)}}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        @keyframes toastIn{from{opacity:0;transform:translateY(-12px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}
        @keyframes toastOut{from{opacity:1}to{opacity:0;transform:translateY(-12px) scale(.95)}}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}
        @keyframes bounceIn{0%{opacity:0;transform:scale(.3)}50%{transform:scale(1.05)}70%{transform:scale(.9)}100%{opacity:1;transform:scale(1)}}
        @keyframes fabPulse{0%{box-shadow:0 8px 32px rgba(139,92,246,.45)}50%{box-shadow:0 8px 32px rgba(139,92,246,.7),0 0 0 12px rgba(139,92,246,.1)}100%{box-shadow:0 8px 32px rgba(139,92,246,.45)}}
        @keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}

        .anim-slide-up{animation:slideUp .5s ease-out both}
        .anim-slide-right{animation:slideRight .4s ease-out both}

        .toast-container{position:fixed;top:1rem;right:1rem;z-index:9999;display:flex;flex-direction:column;gap:.5rem;pointer-events:none}
        .toast{pointer-events:auto;display:flex;align-items:center;gap:.75rem;padding:.75rem 1.25rem;border-radius:.625rem;font-size:.875rem;font-weight:500;max-width:420px;box-shadow:0 20px 25px -5px rgba(0,0,0,.1);animation:toastIn .3s ease-out both}
        .toast--removing{animation:toastOut .25s ease-in both}
        .toast--success{background:var(--c-ok600);color:#fff}
        .toast--error{background:var(--c-err600);color:#fff}
        .toast--info{background:var(--c-s800);color:#fff}

        .login{min-height:100vh;background:linear-gradient(135deg,var(--c-s900),var(--c-s800),var(--c-s900));display:flex;align-items:center;justify-content:center;padding:1rem;position:relative;overflow:hidden}
        .login::before{content:'';position:absolute;inset:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 25% 15%,rgba(14,165,233,.07),transparent 50%),radial-gradient(ellipse at 75% 85%,rgba(139,92,246,.07),transparent 50%);pointer-events:none}
        .login__wrapper{width:100%;max-width:440px;position:relative;z-index:1}
        .login__brand{text-align:center;margin-bottom:2rem}
        .login__brand h1{font-size:3rem;font-weight:900;color:#fff;letter-spacing:-1px}
        .login__brand p{color:var(--c-s400);font-size:.875rem;letter-spacing:2px;margin-top:.5rem}
        .login__card{background:rgba(255,255,255,.04);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,.08);border-radius:1.25rem;padding:2.5rem;box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
        .login__card h2{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:1.5rem}
        .btn-google{width:100%;padding:.75rem 1rem;background:#fff;border-radius:.625rem;font-size:.9375rem;font-weight:500;color:var(--c-s700);display:flex;align-items:center;justify-content:center;gap:.75rem;transition:all .2s var(--ease-out)}
        .btn-google:hover:not(:disabled){background:var(--c-s50);box-shadow:0 8px 24px rgba(0,0,0,.2);transform:translateY(-1px)}
        .btn-google:disabled{opacity:.6;cursor:wait}
        .btn-google svg{width:20px;height:20px;flex-shrink:0}
        .spinner{display:inline-block;width:20px;height:20px;border:2.5px solid var(--c-s300);border-top-color:var(--c-p500);border-radius:50%;animation:spin .6s linear infinite}
        .login__error{margin-top:.75rem;padding:.75rem 1rem;background:rgba(239,68,68,.15);border:1px solid rgba(239,68,68,.3);border-radius:.625rem;font-size:.75rem;color:#fca5a5;line-height:1.7;display:none}
        .login__error--visible{display:block}
        .login__error strong{color:#fff;font-weight:600}
        .login__footer{text-align:center;font-size:.75rem;color:var(--c-s500);margin-top:1.5rem}

        .header{background:#fff;border-bottom:1px solid var(--c-s200);position:sticky;top:0;z-index:20;box-shadow:0 1px 2px rgba(0,0,0,.05);height:var(--hh)}
        .header__inner{max-width:1440px;margin:0 auto;padding:0 1rem;display:flex;justify-content:space-between;align-items:center;height:100%}
        .header__left{display:flex;align-items:center;gap:1rem}
        .header__menu{display:none;padding:.5rem;border-radius:.5rem;color:var(--c-s600)}
        .header__menu:hover{background:var(--c-s100)}
        .header__logo{font-size:1.5rem;font-weight:900;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .header__right{display:flex;align-items:center;gap:.75rem}
        .header__user{display:flex;align-items:center;gap:.75rem;padding:.5rem 1rem;background:var(--c-s50);border-radius:.625rem}
        .header__avatar{width:32px;height:32px;border-radius:50%;object-fit:cover}
        .header__avatar-fb{width:32px;height:32px;border-radius:50%;background:var(--c-s200);display:flex;align-items:center;justify-content:center}
        .header__avatar-fb svg{width:16px;height:16px;color:var(--c-s500)}
        .header__name{font-size:.875rem;font-weight:500;color:var(--c-s600)}
        .header__logout{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;font-size:.875rem;font-weight:500;color:var(--c-s500);border-radius:.625rem;transition:all .2s}
        .header__logout:hover{background:var(--c-s100);color:var(--c-s800)}
        .header__logout svg{width:16px;height:16px}

        .app-layout{display:flex}

        .sidebar{width:var(--sw);background:#fff;border-right:1px solid var(--c-s200);min-height:calc(100vh - var(--hh));padding:1rem;flex-shrink:0;transition:transform .3s var(--ease-out)}
        .sidebar__nav{display:flex;flex-direction:column;gap:.25rem}
        .sidebar__link{width:100%;display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border-radius:.625rem;font-size:.875rem;font-weight:500;color:var(--c-s500);transition:all .2s}
        .sidebar__link:hover{background:var(--c-s50);color:var(--c-s800)}
        .sidebar__link--active{background:var(--grad);color:#fff;box-shadow:0 4px 15px rgba(139,92,246,.3)}
        .sidebar__link svg{width:20px;height:20px;flex-shrink:0}
        .sidebar__overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:29}

        .main{flex:1;padding:2rem;max-width:1100px;min-width:0}
        .page-title{font-size:1.875rem;font-weight:700;color:var(--c-s900);margin-bottom:2rem}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}
        .page-header .page-title{margin-bottom:0}

        .card{background:#fff;border-radius:.875rem;border:1px solid var(--c-s200);box-shadow:0 1px 2px rgba(0,0,0,.05);transition:all .3s var(--ease-out)}
        .card--hover:hover{transform:translateY(-3px);box-shadow:0 10px 15px -3px rgba(0,0,0,.08)}
        .card__body{padding:1.5rem}

        .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-bottom:2rem}
        .stat__header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
        .stat__label{font-size:1rem;font-weight:600;color:var(--c-s900)}
        .stat__icon svg{width:32px;height:32px}
        .stat__value{font-size:1.75rem;font-weight:700;color:var(--c-s900)}
        .stat__desc{font-size:.875rem;color:var(--c-s400);margin-top:.25rem}

        .bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
        .recent-title{font-size:1.25rem;font-weight:700;color:var(--c-s900);margin-bottom:1rem}
        .recent-item{padding:1rem;background:var(--c-s50);border-radius:.625rem;margin-bottom:.75rem;cursor:pointer;transition:background .2s}
        .recent-item:last-child{margin-bottom:0}
        .recent-item:hover{background:var(--c-s100)}
        .recent-item__title{font-size:.875rem;font-weight:600;color:var(--c-s900);margin-bottom:.25rem}
        .recent-item__body{font-size:.75rem;color:var(--c-s500);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .recent-item__date{font-size:.75rem;color:var(--c-s400);margin-top:.5rem}

        .quick-panel{background:var(--grad);border-radius:.875rem;padding:1.5rem;color:#fff;box-shadow:0 8px 25px rgba(139,92,246,.35)}
        .quick-panel h3{font-size:1.25rem;font-weight:700;margin-bottom:1rem}
        .quick-btn{width:100%;display:flex;align-items:center;justify-content:space-between;padding:1rem;background:rgba(255,255,255,.12);border-radius:.625rem;color:#fff;font-size:.875rem;font-weight:500;backdrop-filter:blur(4px);margin-bottom:.75rem;transition:background .2s}
        .quick-btn:last-child{margin-bottom:0}
        .quick-btn:hover{background:rgba(255,255,255,.22)}
        .quick-btn svg{width:20px;height:20px}

        .btn-add{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.25rem;background:var(--grad);border-radius:.625rem;color:#fff;font-size:.875rem;font-weight:600;box-shadow:0 4px 15px rgba(139,92,246,.3);transition:all .2s}
        .btn-add:hover{transform:translateY(-1px);box-shadow:0 8px 25px rgba(139,92,246,.35)}
        .btn-add svg{width:18px;height:18px}

        .notice{margin-bottom:1rem}
        .notice__top{display:flex;justify-content:space-between;align-items:flex-start}
        .notice__info{flex:1;min-width:0}
        .notice__title{font-size:1.25rem;font-weight:700;color:var(--c-s900);margin-bottom:.5rem}
        .notice__content{font-size:.875rem;color:var(--c-s600);white-space:pre-wrap;line-height:1.7}
        .notice__actions{display:flex;gap:.25rem;flex-shrink:0;margin-left:1rem}
        .notice__actions button{padding:.5rem;border-radius:.375rem;transition:all .2s}
        .notice__actions button svg{width:16px;height:16px}
        .btn-edit{color:var(--c-p500)}.btn-edit:hover{background:var(--c-p50)}
        .btn-del{color:var(--c-err500)}.btn-del:hover{background:var(--c-err50)}
        .notice__meta{display:flex;align-items:center;gap:1rem;font-size:.75rem;color:var(--c-s400);margin-top:1rem;padding-top:1rem;border-top:1px solid var(--c-s100)}
        .notice__meta span{display:inline-flex;align-items:center;gap:.25rem}
        .notice__meta svg{width:14px;height:14px}

        .empty{text-align:center;padding:4rem 2rem}
        .empty svg{width:64px;height:64px;color:var(--c-s300);margin:0 auto 1rem}
        .empty p{font-size:1.125rem;color:var(--c-s400)}
        .empty .empty__sub{font-size:.875rem;color:var(--c-s300);margin-top:.5rem}

        .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;padding:1rem;z-index:50;animation:fadeIn .2s ease-out}
        .modal__dialog{width:100%;border-radius:1.25rem;padding:2.5rem;box-shadow:0 25px 50px -12px rgba(0,0,0,.25);animation:slideUp .3s ease-out}
        .modal__dialog--white{max-width:640px;background:#fff;color:var(--c-s900)}
        .modal__dialog h3{font-size:1.5rem;font-weight:700;margin-bottom:1rem}
        .form-group{margin-bottom:1rem}
        .form-group>label{display:block;font-size:.875rem;font-weight:500;color:var(--c-s700);margin-bottom:.5rem}
        .form-input{width:100%;padding:.75rem 1rem;background:#fff;border:1px solid var(--c-s300);border-radius:.625rem;font-size:.875rem;color:var(--c-s900);transition:all .2s}
        .form-input::placeholder{color:var(--c-s400)}
        .form-input:focus{border-color:var(--c-p500);box-shadow:0 0 0 3px rgba(14,165,233,.15)}
        textarea.form-input{resize:vertical;min-height:180px;line-height:1.7}
        select.form-input{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 1rem center}
        .modal__actions{display:flex;gap:.75rem;margin-top:1.5rem}
        .modal__actions button{flex:1;padding:.75rem;border-radius:.625rem;font-size:.875rem;font-weight:600;transition:all .2s}
        .btn-primary{background:var(--grad);color:#fff}
        .btn-primary:hover{box-shadow:0 4px 15px rgba(139,92,246,.3)}
        .btn-secondary{background:var(--c-s200);color:var(--c-s700)}
        .btn-secondary:hover{background:var(--c-s300)}
        .btn-danger{background:var(--c-err500);color:#fff}

        /* ===== DINING FINDER ===== */
        .dining-hero{
            background:linear-gradient(135deg,#f97316,#ef4444,#ec4899);
            border-radius:1.25rem;padding:2rem;color:#fff;margin-bottom:2rem;
            position:relative;overflow:hidden;
        }
        .dining-hero::before{
            content:'';position:absolute;top:-50%;right:-20%;width:300px;height:300px;
            background:rgba(255,255,255,.08);border-radius:50%;
        }
        .dining-hero::after{
            content:'';position:absolute;bottom:-30%;left:-10%;width:200px;height:200px;
            background:rgba(255,255,255,.05);border-radius:50%;
        }
        .dining-hero h2{font-size:1.5rem;font-weight:800;position:relative;z-index:1;margin-bottom:.25rem}
        .dining-hero p{font-size:.875rem;opacity:.9;position:relative;z-index:1}

        .dining-form{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem}
        .dining-form .form-group{margin-bottom:0}

        .food-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;margin-bottom:0}
        .food-chip{
            display:flex;flex-direction:column;align-items:center;gap:.5rem;
            padding:1rem .5rem;background:#fff;border:2px solid var(--c-s200);
            border-radius:.875rem;cursor:pointer;transition:all .25s var(--ease-out);
            font-size:.8125rem;font-weight:500;color:var(--c-s600);
        }
        .food-chip:hover{border-color:var(--c-p500);color:var(--c-p600);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.08)}
        .food-chip--active{
            border-color:var(--c-or500);background:linear-gradient(135deg,#fff7ed,#fff1f2);
            color:var(--c-or500);font-weight:600;
            box-shadow:0 4px 15px rgba(249,115,22,.2);
        }
        .food-chip__icon{font-size:1.75rem;line-height:1}
        .food-chip__name{font-size:.75rem;text-align:center;line-height:1.3}

        .dining-search-btn{
            width:100%;padding:1rem;background:linear-gradient(135deg,#f97316,#ef4444);
            border-radius:.875rem;color:#fff;font-size:1.0625rem;font-weight:700;
            display:flex;align-items:center;justify-content:center;gap:.75rem;
            box-shadow:0 8px 25px rgba(249,115,22,.35);transition:all .25s;
            margin-top:1.5rem;
        }
        .dining-search-btn:hover{transform:translateY(-2px);box-shadow:0 12px 35px rgba(249,115,22,.45)}
        .dining-search-btn:disabled{opacity:.6;transform:none;cursor:wait}
        .dining-search-btn svg{width:22px;height:22px}

        .dining-recent{margin-top:2rem}
        .dining-recent h3{font-size:1.125rem;font-weight:700;color:var(--c-s900);margin-bottom:1rem}
        .dining-history{display:flex;flex-wrap:wrap;gap:.5rem}
        .dining-history-chip{
            padding:.5rem 1rem;background:var(--c-s100);border-radius:2rem;
            font-size:.75rem;color:var(--c-s600);font-weight:500;
            cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:.375rem;
        }
        .dining-history-chip:hover{background:var(--c-s200);color:var(--c-s800)}
        .dining-history-chip svg{width:14px;height:14px}

        .dining-result-info{
            margin-top:1.5rem;padding:1rem 1.25rem;
            background:var(--c-ok100);border-radius:.75rem;
            font-size:.875rem;color:var(--c-ok800);font-weight:500;
            display:flex;align-items:center;gap:.75rem;
        }
        .dining-result-info svg{width:20px;height:20px;flex-shrink:0}

        .people-btns{display:flex;gap:.5rem;flex-wrap:wrap}
        .people-btn{
            padding:.625rem 1.25rem;background:#fff;border:2px solid var(--c-s200);
            border-radius:.625rem;font-size:.8125rem;font-weight:500;color:var(--c-s600);
            transition:all .2s;cursor:pointer;
        }
        .people-btn:hover{border-color:var(--c-p500);color:var(--c-p600)}
        .people-btn--active{
            border-color:var(--c-p500);background:var(--c-p50);
            color:var(--c-p600);font-weight:600;
        }

        /* ===== CHATBOT ===== */
        #chatbotContainer{position:fixed;bottom:24px;right:24px;z-index:9990;display:flex;flex-direction:column;align-items:flex-end}
        .chatbot-fab{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;border:none;cursor:pointer;box-shadow:0 8px 32px rgba(139,92,246,.45);font-size:1.6rem;display:flex;align-items:center;justify-content:center;transition:all .3s ease;animation:fabPulse 3s ease-in-out infinite;position:relative}
        .chatbot-fab:hover{transform:scale(1.12) rotate(5deg);box-shadow:0 12px 40px rgba(139,92,246,.6)}
        .chatbot-fab__badge{position:absolute;top:-4px;right:-4px;width:22px;height:22px;background:#ef4444;border-radius:50%;font-size:.7rem;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;border:2.5px solid #fff;animation:bounceIn .4s ease-out}
        .chatbot-fab__tooltip{position:absolute;right:calc(100% + 12px);top:50%;transform:translateY(-50%);background:var(--c-s800);color:#fff;padding:.5rem .875rem;border-radius:.5rem;font-size:.75rem;font-weight:500;white-space:nowrap;box-shadow:0 4px 12px rgba(0,0,0,.15);animation:fadeIn .3s ease-out;pointer-events:none}
        .chatbot-fab__tooltip::after{content:'';position:absolute;top:50%;right:-6px;transform:translateY(-50%);border:6px solid transparent;border-left-color:var(--c-s800)}

        .chat-window{width:400px;max-height:600px;background:#fff;border-radius:1.25rem;box-shadow:0 25px 60px -12px rgba(0,0,0,.3);border:1px solid var(--c-s200);display:none;flex-direction:column;overflow:hidden;margin-bottom:.875rem;animation:slideUp .3s ease-out}
        .chat-window--open{display:flex}
        .chat-header{padding:1rem 1.25rem;background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
        .chat-header__left{display:flex;align-items:center;gap:.75rem}
        .chat-header__avatar{width:38px;height:38px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:1.2rem}
        .chat-header__info h4{font-size:.9375rem;font-weight:700}
        .chat-header__info span{font-size:.7rem;opacity:.85;display:flex;align-items:center;gap:.3rem}
        .chat-header__info span::before{content:'';width:7px;height:7px;border-radius:50%;background:#4ade80;display:inline-block}
        .chat-header__close{color:#fff;font-size:1.5rem;padding:.25rem .5rem;border-radius:.375rem;transition:background .2s;line-height:1;cursor:pointer;border:none;background:none}
        .chat-header__close:hover{background:rgba(255,255,255,.15)}
        .chat-messages{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:.5rem;max-height:370px;min-height:280px;scrollbar-width:thin;scrollbar-color:var(--c-s300) transparent}
        .chat-messages::-webkit-scrollbar{width:5px}
        .chat-messages::-webkit-scrollbar-track{background:transparent}
        .chat-messages::-webkit-scrollbar-thumb{background:var(--c-s300);border-radius:3px}
        .chat-msg{max-width:88%;animation:slideUp .25s ease-out}
        .chat-msg--bot{align-self:flex-start}
        .chat-msg--user{align-self:flex-end}
        .chat-msg__bubble{padding:.75rem 1rem;border-radius:.875rem;font-size:.8125rem;line-height:1.65;word-break:break-word}
        .chat-msg--bot .chat-msg__bubble{background:var(--c-s100);color:var(--c-s800);border-bottom-left-radius:.25rem}
        .chat-msg--user .chat-msg__bubble{background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;border-bottom-right-radius:.25rem}
        .chat-msg__time{font-size:.65rem;color:var(--c-s400);margin-top:.2rem;padding:0 .25rem}
        .chat-msg--user .chat-msg__time{text-align:right}
        .chat-msg__bubble b{font-weight:600}
        .chat-msg__bubble code{background:rgba(0,0,0,.06);padding:.125rem .375rem;border-radius:.25rem;font-size:.75rem}
        .chat-typing{align-self:flex-start;display:flex;gap:.3rem;padding:.75rem 1rem;animation:fadeIn .3s}
        .chat-typing span{width:8px;height:8px;border-radius:50%;background:var(--c-s400);animation:pulse 1.4s infinite}
        .chat-typing span:nth-child(2){animation-delay:.2s}
        .chat-typing span:nth-child(3){animation-delay:.4s}
        .chat-suggestions{display:flex;flex-wrap:wrap;gap:.375rem;padding:.625rem 1rem;border-top:1px solid var(--c-s100);background:var(--c-s50);flex-shrink:0}
        .chat-suggest-btn{padding:.375rem .75rem;background:#fff;border:1px solid var(--c-s200);border-radius:2rem;font-size:.7rem;color:var(--c-s600);font-weight:500;transition:all .2s;white-space:nowrap;cursor:pointer}
        .chat-suggest-btn:hover{border-color:var(--c-p500);color:var(--c-p500);background:var(--c-p50)}
        .chat-input-area{padding:.75rem;border-top:1px solid var(--c-s200);display:flex;gap:.5rem;background:#fff;flex-shrink:0}
        .chat-input{flex:1;padding:.625rem 1rem;border:1.5px solid var(--c-s200);border-radius:.75rem;font-size:.8125rem;font-family:var(--ff);outline:none;transition:border-color .2s;background:var(--c-s50)}
        .chat-input:focus{border-color:var(--c-p500);background:#fff}
        .chat-send{padding:.625rem 1rem;background:linear-gradient(135deg,#0ea5e9,#8b5cf6);color:#fff;border-radius:.75rem;font-size:.8125rem;font-weight:600;font-family:var(--ff);transition:all .2s;display:flex;align-items:center;gap:.375rem;cursor:pointer;border:none}
        .chat-send:hover{box-shadow:0 4px 12px rgba(139,92,246,.3);transform:translateY(-1px)}
        .chat-send:disabled{opacity:.5;transform:none;box-shadow:none;cursor:not-allowed}
        .chat-send svg{width:16px;height:16px}
        .chat-notice-card{background:#fff;border:1px solid var(--c-s200);border-radius:.625rem;padding:.75rem;margin-top:.5rem}
        .chat-notice-card__title{font-size:.8125rem;font-weight:700;color:var(--c-s900);margin-bottom:.25rem}
        .chat-notice-card__content{font-size:.75rem;color:var(--c-s500);line-height:1.5}
        .chat-notice-card__meta{font-size:.65rem;color:var(--c-s400);margin-top:.375rem;display:flex;gap:.5rem}
        .chat-notice-card__actions{display:flex;gap:.375rem;margin-top:.5rem}
        .chat-notice-card__actions button{padding:.25rem .625rem;border-radius:.375rem;font-size:.7rem;font-weight:600;transition:all .15s;cursor:pointer;border:none}
        .chat-action-edit{background:var(--c-p50);color:var(--c-p600)}
        .chat-action-edit:hover{background:var(--c-p100)}
        .chat-action-delete{background:var(--c-err50);color:var(--c-err600)}
        .chat-action-delete:hover{background:rgba(239,68,68,.15)}
        .chat-action-view{background:var(--c-s100);color:var(--c-s600)}
        .chat-action-view:hover{background:var(--c-s200)}

        @media(max-width:1024px){.stats-grid{grid-template-columns:1fr 1fr}.food-grid{grid-template-columns:repeat(3,1fr)}}
        @media(max-width:768px){
            .header__menu{display:block}
            .sidebar{position:fixed;top:var(--hh);left:0;bottom:0;z-index:30;transform:translateX(-100%)}
            .sidebar--open{transform:translateX(0)}
            .sidebar__overlay--visible{display:block}
            .main{padding:1rem}
            .bottom-grid{grid-template-columns:1fr}
            .stats-grid{grid-template-columns:1fr}
            .dining-form{grid-template-columns:1fr}
            .food-grid{grid-template-columns:repeat(3,1fr)}
            .header__logout-text{display:none}
            .login__brand h1{font-size:2.25rem}
            .login__card{padding:1.5rem}
            .chat-window{width:calc(100vw - 3rem);max-height:calc(100vh - 120px)}
            #chatbotContainer{bottom:16px;right:16px}
        }
        @media(max-width:480px){
            .food-grid{grid-template-columns:repeat(2,1fr)}
            .people-btns{gap:.375rem}
            .people-btn{padding:.5rem .875rem;font-size:.75rem}
        }
    </style>
</head>
<body>

<div id="toastContainer" class="toast-container" aria-live="polite"></div>

<!-- LOGIN -->
<div id="pageLogin" class="login">
    <div class="login__wrapper anim-slide-up">
        <div class="login__brand">
            <h1 class="logo">WorkHub</h1>
            <p>ê¸°ì—…ì„ ìœ„í•œ ìŠ¤ë§ˆíŠ¸ ê·¸ë£¹ì›¨ì–´</p>
        </div>
        <div class="login__card">
            <h2>ë¡œê·¸ì¸</h2>
            <button id="btnGoogle" class="btn-google" onclick="App.auth.loginGoogle()">
                <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                <span id="btnGoogleText">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</span>
            </button>
            <div id="loginError" class="login__error"></div>
            <p class="login__footer">Google ê³„ì •ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
        </div>
    </div>
</div>

<!-- APP SHELL -->
<div id="appShell" hidden>
    <header class="header">
        <div class="header__inner">
            <div class="header__left">
                <button class="header__menu" onclick="App.ui.toggleSidebar()" aria-label="ë©”ë‰´">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                </button>
                <span class="header__logo logo">WorkHub</span>
            </div>
            <div class="header__right">
                <div class="header__user">
                    <span id="headerAvatar"></span>
                    <span id="headerName" class="header__name"></span>
                </div>
                <button class="header__logout" onclick="App.auth.logout()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    <span class="header__logout-text">ë¡œê·¸ì•„ì›ƒ</span>
                </button>
            </div>
        </div>
    </header>

    <div class="app-layout">
        <div id="sidebarOverlay" class="sidebar__overlay" onclick="App.ui.closeSidebar()"></div>
        <aside id="sidebar" class="sidebar">
            <nav class="sidebar__nav">
                <button class="sidebar__link sidebar__link--active" data-page="dashboard" onclick="App.router.go('dashboard')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    <span>ëŒ€ì‹œë³´ë“œ</span>
                </button>
                <button class="sidebar__link" data-page="notices" onclick="App.router.go('notices')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                    <span>ê³µì§€ì‚¬í•­</span>
                </button>
                <button class="sidebar__link" data-page="dining" onclick="App.router.go('dining')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
                    <span>íšŒì‹ ì°¾ê¸°</span>
                </button>
                <button class="sidebar__link" data-page="chatbot" onclick="App.chat.toggle()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                    <span>AI ì±—ë´‡</span>
                </button>
            </nav>
        </aside>

        <main class="main">
            <!-- Dashboard -->
            <section id="pageDashboard" class="anim-slide-right">
                <h2 class="page-title">ëŒ€ì‹œë³´ë“œ</h2>
                <div class="stats-grid">
                    <div class="card card--hover"><div class="card__body">
                        <div class="stat__header"><h3 class="stat__label">ì „ì²´ ê³µì§€ì‚¬í•­</h3><span class="stat__icon" style="color:var(--c-a500)"><svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg></span></div>
                        <p id="dashNoticeCount" class="stat__value">0</p><p class="stat__desc">ë“±ë¡ëœ ê³µì§€</p>
                    </div></div>
                    <div class="card card--hover"><div class="card__body">
                        <div class="stat__header"><h3 class="stat__label">ìµœê·¼ í™œë™</h3><span class="stat__icon" style="color:var(--c-p500)"><svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span></div>
                        <p id="dashLastActivity" class="stat__value">-</p><p class="stat__desc">ë§ˆì§€ë§‰ ê³µì§€ ë“±ë¡ì¼</p>
                    </div></div>
                    <div class="card card--hover" style="cursor:pointer" onclick="App.router.go('dining')"><div class="card__body">
                        <div class="stat__header"><h3 class="stat__label">íšŒì‹ ì°¾ê¸°</h3><span class="stat__icon" style="color:var(--c-or500)"><svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg></span></div>
                        <p class="stat__value" style="font-size:1.25rem">ğŸ½ï¸ ë§›ì§‘ ê²€ìƒ‰</p><p class="stat__desc">íšŒì‹ ì¥ì†Œë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
                    </div></div>
                </div>
                <div class="bottom-grid">
                    <div class="card"><div class="card__body">
                        <h3 class="recent-title">ìµœê·¼ ê³µì§€ì‚¬í•­</h3>
                        <div id="dashRecentNotices"><div style="padding:2rem;text-align:center;color:var(--c-s400);font-size:.875rem">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</div></div>
                    </div></div>
                    <div class="quick-panel">
                        <h3>ë¹ ë¥¸ ì‹œì‘</h3>
                        <button class="quick-btn" onclick="App.router.go('notices')"><span>ê³µì§€ì‚¬í•­ í™•ì¸í•˜ê¸°</span><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></button>
                        <button class="quick-btn" onclick="App.notices.open()"><span>ìƒˆ ê³µì§€ì‚¬í•­ ì‘ì„±</span><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></button>
                        <button class="quick-btn" onclick="App.router.go('dining')"><span>ğŸ½ï¸ íšŒì‹ ì¥ì†Œ ì°¾ê¸°</span><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></button>
                    </div>
                </div>
            </section>

            <!-- Notices -->
            <section id="pageNotices" hidden>
                <div class="page-header"><h2 class="page-title">ê³µì§€ì‚¬í•­</h2>
                    <button class="btn-add" onclick="App.notices.open()"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg><span>ìƒˆ ê³µì§€ì‚¬í•­</span></button>
                </div>
                <div id="noticeList"></div>
            </section>

            <!-- Dining Finder -->
            <section id="pageDining" hidden>
                <div class="dining-hero">
                    <h2>ğŸ½ï¸ íšŒì‹ ì¥ì†Œ ì°¾ê¸°</h2>
                    <p>ì§€ì—­, ì¸ì›, ìŒì‹ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ë©´ ë„¤ì´ë²„ ì§€ë„ì—ì„œ ë°”ë¡œ ê²€ìƒ‰ë©ë‹ˆë‹¤</p>
                </div>

                <div class="card"><div class="card__body">
                    <div class="dining-form">
                        <!-- ì§€ì—­ ì„ íƒ -->
                        <div class="form-group">
                            <label style="font-size:1rem;font-weight:700;color:var(--c-s900);margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem">
                                ğŸ“ ì§€ì—­ ì„ íƒ
                            </label>
                            <select class="form-input" id="diningArea" style="font-size:.9375rem">
                                <option value="">ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ê°•ë‚¨êµ¬">ê°•ë‚¨êµ¬</option>
                                <option value="ê°•ë™êµ¬">ê°•ë™êµ¬</option>
                                <option value="ê°•ë¶êµ¬">ê°•ë¶êµ¬</option>
                                <option value="ê°•ì„œêµ¬">ê°•ì„œêµ¬</option>
                                <option value="ê´€ì•…êµ¬">ê´€ì•…êµ¬</option>
                                <option value="ê´‘ì§„êµ¬">ê´‘ì§„êµ¬</option>
                                <option value="êµ¬ë¡œêµ¬">êµ¬ë¡œêµ¬</option>
                                <option value="ê¸ˆì²œêµ¬">ê¸ˆì²œêµ¬</option>
                                <option value="ë…¸ì›êµ¬">ë…¸ì›êµ¬</option>
                                <option value="ë„ë´‰êµ¬">ë„ë´‰êµ¬</option>
                                <option value="ë™ëŒ€ë¬¸êµ¬">ë™ëŒ€ë¬¸êµ¬</option>
                                <option value="ë™ì‘êµ¬">ë™ì‘êµ¬</option>
                                <option value="ë§ˆí¬êµ¬">ë§ˆí¬êµ¬</option>
                                <option value="ì„œëŒ€ë¬¸êµ¬">ì„œëŒ€ë¬¸êµ¬</option>
                                <option value="ì„œì´ˆêµ¬">ì„œì´ˆêµ¬</option>
                                <option value="ì„±ë™êµ¬">ì„±ë™êµ¬</option>
                                <option value="ì„±ë¶êµ¬">ì„±ë¶êµ¬</option>
                                <option value="ì†¡íŒŒêµ¬">ì†¡íŒŒêµ¬</option>
                                <option value="ì–‘ì²œêµ¬">ì–‘ì²œêµ¬</option>
                                <option value="ì˜ë“±í¬êµ¬">ì˜ë“±í¬êµ¬</option>
                                <option value="ìš©ì‚°êµ¬">ìš©ì‚°êµ¬</option>
                                <option value="ì€í‰êµ¬">ì€í‰êµ¬</option>
                                <option value="ì¢…ë¡œêµ¬">ì¢…ë¡œêµ¬</option>
                                <option value="ì¤‘êµ¬">ì¤‘êµ¬</option>
                                <option value="ì¤‘ë‘êµ¬">ì¤‘ë‘êµ¬</option>
                            </select>
                        </div>

                        <!-- ì¸ì› ì„ íƒ -->
                        <div class="form-group">
                            <label style="font-size:1rem;font-weight:700;color:var(--c-s900);margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem">
                                ğŸ‘¥ ì¸ì› <span style="font-size:.75rem;font-weight:400;color:var(--c-s400)">(ì„ íƒ)</span>
                            </label>
                            <div class="people-btns" id="peopleBtns">
                                <button class="people-btn" data-people="" onclick="App.dining.setPeople(this)">ìƒê´€ì—†ìŒ</button>
                                <button class="people-btn" data-people="2~4ëª…" onclick="App.dining.setPeople(this)">2~4ëª…</button>
                                <button class="people-btn" data-people="5~10ëª…" onclick="App.dining.setPeople(this)">5~10ëª…</button>
                                <button class="people-btn" data-people="10~20ëª…" onclick="App.dining.setPeople(this)">10~20ëª…</button>
                                <button class="people-btn" data-people="20ëª…ì´ìƒ" onclick="App.dining.setPeople(this)">20ëª… ì´ìƒ</button>
                            </div>
                        </div>
                    </div>

                    <!-- ìŒì‹ ì¢…ë¥˜ -->
                    <div class="form-group">
                        <label style="font-size:1rem;font-weight:700;color:var(--c-s900);margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem">
                            ğŸ´ ìŒì‹ ì¢…ë¥˜
                        </label>
                        <div class="food-grid" id="foodGrid">
                            <button class="food-chip" data-food="ê³ ê¸° ë§›ì§‘" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ¥©</span><span class="food-chip__name">ê³ ê¸°Â·BBQ</span>
                            </button>
                            <button class="food-chip" data-food="ì‚¼ê²¹ì‚´" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ·</span><span class="food-chip__name">ì‚¼ê²¹ì‚´</span>
                            </button>
                            <button class="food-chip" data-food="ì†Œê³ ê¸° ë§›ì§‘" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ‚</span><span class="food-chip__name">ì†Œê³ ê¸°</span>
                            </button>
                            <button class="food-chip" data-food="ì¹˜í‚¨ ë§›ì§‘" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ—</span><span class="food-chip__name">ì¹˜í‚¨</span>
                            </button>
                            <button class="food-chip" data-food="íšŒ í•´ì‚°ë¬¼" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸŸ</span><span class="food-chip__name">íšŒÂ·í•´ì‚°ë¬¼</span>
                            </button>
                            <button class="food-chip" data-food="ì´ˆë°¥ ì¼ì‹" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ£</span><span class="food-chip__name">ì´ˆë°¥Â·ì¼ì‹</span>
                            </button>
                            <button class="food-chip" data-food="ì¤‘ì‹ ì¤‘êµ­ì§‘" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ¥Ÿ</span><span class="food-chip__name">ì¤‘ì‹</span>
                            </button>
                            <button class="food-chip" data-food="ì–‘ì‹ íŒŒìŠ¤íƒ€" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ</span><span class="food-chip__name">ì–‘ì‹Â·íŒŒìŠ¤íƒ€</span>
                            </button>
                            <button class="food-chip" data-food="í•œì‹ í•œì •ì‹" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸš</span><span class="food-chip__name">í•œì‹Â·í•œì •ì‹</span>
                            </button>
                            <button class="food-chip" data-food="ì¡±ë°œ ë³´ìŒˆ" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ¦¶</span><span class="food-chip__name">ì¡±ë°œÂ·ë³´ìŒˆ</span>
                            </button>
                            <button class="food-chip" data-food="ê³±ì°½ ë§‰ì°½" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ«•</span><span class="food-chip__name">ê³±ì°½Â·ë§‰ì°½</span>
                            </button>
                            <button class="food-chip" data-food="ì°œ íƒ• ì°Œê°œ" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ²</span><span class="food-chip__name">ì°œÂ·íƒ•Â·ì°Œê°œ</span>
                            </button>
                            <button class="food-chip" data-food="í”¼ì" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ•</span><span class="food-chip__name">í”¼ì</span>
                            </button>
                            <button class="food-chip" data-food="íƒœêµ­ ë™ë‚¨ì•„ ìŒì‹" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸœ</span><span class="food-chip__name">íƒœêµ­Â·ë™ë‚¨ì•„</span>
                            </button>
                            <button class="food-chip" data-food="ë©•ì‹œì¹¸ íƒ€ì½”" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸŒ®</span><span class="food-chip__name">ë©•ì‹œì¹¸</span>
                            </button>
                            <button class="food-chip" data-food="ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸº</span><span class="food-chip__name">ìˆ ì§‘Â·í˜¸í”„</span>
                            </button>
                            <button class="food-chip" data-food="ì™€ì¸ë°” ì™€ì¸" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ·</span><span class="food-chip__name">ì™€ì¸ë°”</span>
                            </button>
                            <button class="food-chip" data-food="ë·”í˜" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ½ï¸</span><span class="food-chip__name">ë·”í˜</span>
                            </button>
                            <button class="food-chip" data-food="ë² ì´ì»¤ë¦¬ ì¹´í˜" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">â˜•</span><span class="food-chip__name">ì¹´í˜Â·ë””ì €íŠ¸</span>
                            </button>
                            <button class="food-chip" data-food="ë§›ì§‘ ë‹¨ì²´ íšŒì‹" onclick="App.dining.toggleFood(this)">
                                <span class="food-chip__icon">ğŸ‰</span><span class="food-chip__name">ë‹¨ì²´ íšŒì‹</span>
                            </button>
                        </div>
                    </div>

                    <button class="dining-search-btn" id="diningSearchBtn" onclick="App.dining.search()">
                        <svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        ë„¤ì´ë²„ ì§€ë„ì—ì„œ ê²€ìƒ‰í•˜ê¸°
                    </button>

                    <div id="diningResultInfo" class="dining-result-info" style="display:none">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        <span id="diningResultText"></span>
                    </div>
                </div></div>

                <!-- ìµœê·¼ ê²€ìƒ‰ -->
                <div class="dining-recent" id="diningRecent" style="display:none">
                    <h3>ğŸ• ìµœê·¼ ê²€ìƒ‰</h3>
                    <div class="dining-history" id="diningHistory"></div>
                </div>
            </section>
        </main>
    </div>
</div>

<!-- NOTICE MODAL -->
<div id="noticeModal" class="modal" hidden>
    <div class="modal__dialog modal__dialog--white anim-slide-up">
        <h3 id="noticeModalTitle" style="color:var(--c-s900)">ìƒˆ ê³µì§€ì‚¬í•­</h3>
        <div class="form-group"><label for="noticeTitle">ì œëª©</label><input class="form-input" type="text" id="noticeTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
        <div class="form-group"><label for="noticeContent">ë‚´ìš©</label><textarea class="form-input" id="noticeContent" rows="8" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea></div>
        <div class="modal__actions"><button id="noticeModalSave" class="btn-primary" onclick="App.notices.save()">ë“±ë¡</button><button class="btn-secondary" onclick="App.notices.close()">ì·¨ì†Œ</button></div>
    </div>
</div>

<!-- CONFIRM MODAL -->
<div id="confirmModal" class="modal" hidden>
    <div class="modal__dialog modal__dialog--white anim-slide-up" style="max-width:400px;padding:2rem">
        <h3 style="color:var(--c-s900);font-size:1.125rem" id="confirmMessage"></h3>
        <div class="modal__actions"><button class="btn-danger" id="confirmYes">ì‚­ì œ</button><button class="btn-secondary" onclick="App.ui.hideConfirm()">ì·¨ì†Œ</button></div>
    </div>
</div>

<!-- CHATBOT -->
<div id="chatbotContainer">
    <div id="chatWindow" class="chat-window">
        <div class="chat-header">
            <div class="chat-header__left"><div class="chat-header__avatar">ğŸ¤–</div><div class="chat-header__info"><h4>AI ì–´ì‹œìŠ¤í„´íŠ¸</h4><span>ì˜¨ë¼ì¸</span></div></div>
            <button class="chat-header__close" onclick="App.chat.toggle()">âœ•</button>
        </div>
        <div id="chatMessages" class="chat-messages"></div>
        <div id="chatSuggestions" class="chat-suggestions">
            <button class="chat-suggest-btn" onclick="App.chat.quickSend('ê³µì§€ ë“±ë¡')">ğŸ“ ê³µì§€ ë“±ë¡</button>
            <button class="chat-suggest-btn" onclick="App.chat.quickSend('ê³µì§€ ëª©ë¡')">ğŸ“‹ ê³µì§€ ëª©ë¡</button>
            <button class="chat-suggest-btn" onclick="App.chat.quickSend('íšŒì‹ ì°¾ê¸°')">ğŸ½ï¸ íšŒì‹ ì°¾ê¸°</button>
            <button class="chat-suggest-btn" onclick="App.chat.quickSend('ë„ì›€ë§')">â“ ë„ì›€ë§</button>
        </div>
        <div class="chat-input-area">
            <input id="chatInput" class="chat-input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();App.chat.send()}">
            <button id="chatSendBtn" class="chat-send" onclick="App.chat.send()"><svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>ì „ì†¡</button>
        </div>
    </div>
    <button class="chatbot-fab" onclick="App.chat.toggle()" id="chatFab">ğŸ’¬<span class="chatbot-fab__badge" id="chatBadge" style="display:none">!</span></button>
    <div class="chatbot-fab__tooltip" id="chatTooltip" style="display:none">AI ì±—ë´‡ìœ¼ë¡œ ê´€ë¦¬í•´ë³´ì„¸ìš”!</div>
</div>

<script>
const App = (() => {
    'use strict';
    const FIREBASE_CONFIG = Object.freeze({apiKey:'AIzaSyDcHSt46CHlu_LZYnNUU7xwIlMY7xE8KdU',authDomain:'workhub2.firebaseapp.com',projectId:'workhub2'});
    const GIS_SCRIPT_URL='https://accounts.google.com/gsi/client';
    const TOAST_DURATION_MS=3500;const TOAST_ERROR_MS=5000;const LOCAL_PREFIX='wh_';
    const $=(id)=>document.getElementById(id);

    const utils={
        formatDate(iso){try{return new Date(iso).toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'});}catch{return'';}},
        formatDateTime(iso){try{return new Date(iso).toLocaleString('ko-KR');}catch{return'';}},
        formatTime(d){return new Date(d).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'});},
        uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2,8);},
        escapeHtml(str){if(!str)return'';const el=document.createElement('div');el.textContent=str;return el.innerHTML;},
        truncate(str,max=80){return(!str||str.length<=max)?(str||''):str.substring(0,max)+'â€¦';}
    };
    const storage={
        get(key){try{const v=localStorage.getItem(LOCAL_PREFIX+key);return v?JSON.parse(v):null;}catch{return null;}},
        set(key,v){try{localStorage.setItem(LOCAL_PREFIX+key,JSON.stringify(v));}catch{}},
        remove(key){try{localStorage.removeItem(LOCAL_PREFIX+key);}catch{}}
    };

    const state={user:null,page:'dashboard',notices:[],editId:null,sidebarOpen:false,firebaseReady:false,gisReady:false,authListenerAttached:false,loginInProgress:false,chatContext:null,chatOpen:false,diningPeople:'',diningFoods:[],diningHistory:[]};

    const toast={_container:null,init(){this._container=$('toastContainer');},_show(m,t='info',d=TOAST_DURATION_MS){const el=document.createElement('div');el.className=`toast toast--${t}`;el.textContent=m;this._container.appendChild(el);setTimeout(()=>{el.classList.add('toast--removing');el.addEventListener('animationend',()=>el.remove());},d);},success(m){this._show(m,'success');},error(m){this._show(m,'error',TOAST_ERROR_MS);},info(m){this._show(m,'info');}};

    const gis={_loadPromise:null,load(){if(this._loadPromise)return this._loadPromise;this._loadPromise=new Promise((resolve,reject)=>{if(window.google?.accounts?.id){state.gisReady=true;resolve();return;}const s=document.createElement('script');s.src=GIS_SCRIPT_URL;s.async=true;s.defer=true;s.onload=()=>{state.gisReady=true;resolve();};s.onerror=()=>reject(new Error('GIS fail'));document.head.appendChild(s);setTimeout(()=>reject(new Error('GIS timeout')),10000);});return this._loadPromise;}};

    const fb={_auth:null,_initPromise:null,init(){if(this._initPromise)return this._initPromise;this._initPromise=new Promise((resolve)=>{try{firebase.initializeApp(FIREBASE_CONFIG);this._auth=firebase.auth();this._auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);if(!state.authListenerAttached){state.authListenerAttached=true;this._auth.onAuthStateChanged((u)=>{this._handleAuthChange(u);});}state.firebaseReady=true;resolve(true);}catch(err){console.error('[FB]',err);toast.error('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨');resolve(false);}});return this._initPromise;},_handleAuthChange(fu){if(state.loginInProgress)return;if(fu&&!state.user){state.user=this._mapUser(fu);storage.set('session',state.user);auth._onLoginSuccess();}},_mapUser(u){return Object.freeze({name:u.displayName||u.email.split('@')[0],email:u.email,picture:u.photoURL||null,uid:u.uid,provider:'google'});},getAuth(){return this._auth;}};

    const auth={
        async loginGoogle(){if(state.loginInProgress)return;if(!state.firebaseReady){toast.error('ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');return;}const btn=$('btnGoogle'),txt=$('btnGoogleText');state.loginInProgress=true;btn.disabled=true;txt.innerHTML='<span class="spinner"></span> ë¡œê·¸ì¸ ì¤‘...';ui.hideLoginError();try{const provider=new firebase.auth.GoogleAuthProvider();provider.setCustomParameters({prompt:'select_account'});const result=await fb.getAuth().signInWithPopup(provider);state.user=fb._mapUser(result.user);storage.set('session',state.user);this._onLoginSuccess();}catch(err){if(err.code==='auth/popup-closed-by-user')toast.info('ë¡œê·¸ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');else{ui.showLoginError(`<strong>âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨</strong><br>${utils.escapeHtml(err.message)}`);toast.error('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');}}finally{this._resetLoginButton();}},
        async _onLoginSuccess(){state.loginInProgress=false;ui.hideLoginError();await notices._load();ui.showApp();router.go('dashboard');toast.success(`${state.user.name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`);setTimeout(()=>chat._initWelcome(),500);setTimeout(()=>{const tip=$('chatTooltip');if(tip)tip.style.display='block';setTimeout(()=>{if(tip)tip.style.display='none';},4000);},2000);},
        async logout(){try{if(state.firebaseReady&&fb.getAuth())await fb.getAuth().signOut();}catch{}state.user=null;state.notices=[];state.page='dashboard';state.chatContext=null;state.chatOpen=false;storage.remove('session');$('chatWindow').classList.remove('chat-window--open');ui.showLogin();toast.info('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');},
        _resetLoginButton(){state.loginInProgress=false;const btn=$('btnGoogle'),txt=$('btnGoogleText');if(btn)btn.disabled=false;if(txt)txt.textContent='Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸';}
    };

    const PAGES=Object.freeze({dashboard:'pageDashboard',notices:'pageNotices',dining:'pageDining'});
    const router={
        async go(page){if(!PAGES[page])return;state.page=page;if(page!=='dining')await notices._load();
            Object.entries(PAGES).forEach(([key,elId])=>{const el=$(elId);if(!el)return;el.hidden=(key!==page);if(key===page){el.classList.remove('anim-slide-right');void el.offsetWidth;el.classList.add('anim-slide-right');}});
            document.querySelectorAll('.sidebar__link').forEach(btn=>{btn.classList.toggle('sidebar__link--active',btn.dataset.page===page);});
            ui.closeSidebar();
            ({dashboard:()=>ui.renderDashboard(),notices:()=>ui.renderNotices(),dining:()=>dining.renderHistory()})[page]?.();
        }
    };

    const notices={
        _db(){return firebase.firestore().collection('notices');},
        async _load(){try{const snap=await this._db().orderBy('createdAt','desc').get();state.notices=snap.docs.map(d=>({id:d.id,...d.data()}));}catch(err){console.error('ê³µì§€ ë¡œë“œ ì‹¤íŒ¨:',err);state.notices=[];}},
        open(id=null){state.editId=id;const tEl=$('noticeTitle'),cEl=$('noticeContent');if(id){const n=state.notices.find(n=>n.id===id);if(!n)return;tEl.value=n.title;cEl.value=n.content;$('noticeModalTitle').textContent='ê³µì§€ì‚¬í•­ ìˆ˜ì •';$('noticeModalSave').textContent='ìˆ˜ì •';}else{tEl.value='';cEl.value='';$('noticeModalTitle').textContent='ìƒˆ ê³µì§€ì‚¬í•­';$('noticeModalSave').textContent='ë“±ë¡';}$('noticeModal').hidden=false;tEl.focus();},
        close(){$('noticeModal').hidden=true;state.editId=null;},
        async save(){const title=$('noticeTitle').value.trim(),content=$('noticeContent').value.trim();if(!title||!content){toast.error('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}try{if(state.editId){await this._db().doc(state.editId).update({title,content,updatedAt:new Date().toISOString()});toast.success('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');}else{await this._db().add({title,content,author:state.user.name,authorEmail:state.user.email,createdAt:new Date().toISOString()});toast.success('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');}await this._load();this.close();ui.renderNotices();ui.renderDashboard();}catch(err){console.error('ì €ì¥ ì‹¤íŒ¨:',err);toast.error('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');}},
        delete(id){ui.showConfirm('ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',async()=>{try{await this._db().doc(id).delete();await this._load();ui.renderNotices();ui.renderDashboard();toast.success('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');}catch{toast.error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');}});}
    };

    const SVG={
        user:'<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
        edit:'<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
        trash:'<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>',
        bell:'<svg width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>'
    };

    const ui={
        showApp(){$('pageLogin').hidden=true;$('appShell').hidden=false;this.renderHeader();$('chatbotContainer').style.display='flex';},
        showLogin(){$('pageLogin').hidden=false;$('appShell').hidden=true;$('chatbotContainer').style.display='none';},
        renderHeader(){if(!state.user)return;$('headerName').textContent=state.user.name;const a=$('headerAvatar');a.innerHTML=state.user.picture?`<img class="header__avatar" src="${utils.escapeHtml(state.user.picture)}" alt="" referrerpolicy="no-referrer">`:`<span class="header__avatar-fb">${SVG.user}</span>`;},
        toggleSidebar(){state.sidebarOpen=!state.sidebarOpen;$('sidebar').classList.toggle('sidebar--open',state.sidebarOpen);$('sidebarOverlay').classList.toggle('sidebar__overlay--visible',state.sidebarOpen);},
        closeSidebar(){state.sidebarOpen=false;$('sidebar').classList.remove('sidebar--open');$('sidebarOverlay').classList.remove('sidebar__overlay--visible');},
        showLoginError(html){const el=$('loginError');el.innerHTML=html;el.classList.add('login__error--visible');},
        hideLoginError(){const el=$('loginError');el.innerHTML='';el.classList.remove('login__error--visible');},
        showConfirm(message,callback){$('confirmMessage').textContent=message;$('confirmModal').hidden=false;$('confirmYes').onclick=()=>{$('confirmModal').hidden=true;callback();};},
        hideConfirm(){$('confirmModal').hidden=true;},
        renderDashboard(){
            $('dashNoticeCount').textContent=state.notices.length;
            $('dashLastActivity').textContent=state.notices.length>0?utils.formatDate(state.notices[0].createdAt):'-';
            const recentEl=$('dashRecentNotices');const recent=state.notices.slice(0,3);
            recentEl.innerHTML=recent.length?recent.map(n=>`<div class="recent-item" onclick="App.router.go('notices')"><h4 class="recent-item__title">${utils.escapeHtml(n.title)}</h4><p class="recent-item__body">${utils.escapeHtml(utils.truncate(n.content,100))}</p><p class="recent-item__date">${utils.formatDate(n.createdAt)}</p></div>`).join(''):'<div style="padding:2rem;text-align:center;color:var(--c-s400);font-size:.875rem">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        },
        renderNotices(){
            const c=$('noticeList');
            if(!state.notices.length){c.innerHTML=`<div class="card"><div class="card__body"><div class="empty">${SVG.bell}<p>ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p><p class="empty__sub">ìƒˆ ê³µì§€ì‚¬í•­ì„ ë“±ë¡í•´ë³´ì„¸ìš”</p></div></div></div>`;return;}
            c.innerHTML=state.notices.map(n=>`<div class="card card--hover notice"><div class="card__body"><div class="notice__top"><div class="notice__info"><h3 class="notice__title">${utils.escapeHtml(n.title)}</h3><p class="notice__content">${utils.escapeHtml(n.content)}</p></div><div class="notice__actions"><button class="btn-edit" onclick="App.notices.open('${n.id}')">${SVG.edit}</button><button class="btn-del" onclick="App.notices.delete('${n.id}')">${SVG.trash}</button></div></div><div class="notice__meta"><span>${SVG.user}${utils.escapeHtml(n.author)}</span><span>${utils.formatDateTime(n.createdAt)}</span></div></div></div>`).join('');
        }
    };

    /* ===== DINING FINDER ===== */
    const dining = {
        setPeople(btn) {
            document.querySelectorAll('.people-btn').forEach(b => b.classList.remove('people-btn--active'));
            btn.classList.add('people-btn--active');
            state.diningPeople = btn.dataset.people;
        },

        toggleFood(btn) {
            btn.classList.toggle('food-chip--active');
            const food = btn.dataset.food;
            const idx = state.diningFoods.indexOf(food);
            if (idx > -1) state.diningFoods.splice(idx, 1);
            else state.diningFoods.push(food);
        },

        search() {
            const area = $('diningArea').value;
            if (!area) { toast.error('ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            if (state.diningFoods.length === 0) { toast.error('ìŒì‹ ì¢…ë¥˜ë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

            // ê²€ìƒ‰ì–´ ì¡°í•©
            let query = 'ì„œìš¸ ' + area + ' ';
            query += state.diningFoods.join(' ');
            if (state.diningPeople) {
                if (state.diningPeople === '10~20ëª…' || state.diningPeople === '20ëª…ì´ìƒ') {
                    query += ' ë‹¨ì²´ì„';
                }
            }
            query += ' ë§›ì§‘';

            // ë„¤ì´ë²„ ì§€ë„ ê²€ìƒ‰ URL ìƒì„±
            const naverMapUrl = 'https://map.naver.com/p/search/' + encodeURIComponent(query);

            // ìƒˆ íƒ­ì—ì„œ ë„¤ì´ë²„ ì§€ë„ ì—´ê¸°
            window.open(naverMapUrl, '_blank');

            // ê²€ìƒ‰ ê²°ê³¼ ì•ˆë‚´
            const infoEl = $('diningResultInfo');
            const textEl = $('diningResultText');
            infoEl.style.display = 'flex';
            textEl.innerHTML = `<b>"${utils.escapeHtml(query)}"</b> ë„¤ì´ë²„ ì§€ë„ì—ì„œ ê²€ìƒ‰ ì™„ë£Œ! ìƒˆ íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.`;

            // ê²€ìƒ‰ ê¸°ë¡ ì €ì¥
            const record = {
                area,
                foods: [...state.diningFoods],
                people: state.diningPeople,
                query,
                date: new Date().toISOString()
            };
            let history = storage.get('diningHistory') || [];
            history.unshift(record);
            history = history.slice(0, 10); // ìµœê·¼ 10ê°œë§Œ
            storage.set('diningHistory', history);
            state.diningHistory = history;
            this.renderHistory();

            toast.success('ë„¤ì´ë²„ ì§€ë„ì—ì„œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!');
        },

        renderHistory() {
            const history = storage.get('diningHistory') || [];
            state.diningHistory = history;
            const container = $('diningRecent');
            const listEl = $('diningHistory');

            if (history.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            listEl.innerHTML = history.map((h, i) => {
                const label = h.area + ' Â· ' + h.foods.slice(0, 2).join(', ') + (h.foods.length > 2 ? ' ì™¸' : '') + (h.people ? ' Â· ' + h.people : '');
                return `<button class="dining-history-chip" onclick="App.dining.reSearch(${i})">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    ${utils.escapeHtml(label)}
                </button>`;
            }).join('');
        },

        reSearch(index) {
            const history = storage.get('diningHistory') || [];
            const h = history[index];
            if (!h) return;

            // UI ë³µì›
            $('diningArea').value = h.area;
            state.diningPeople = h.people || '';
            state.diningFoods = [...h.foods];

            // ì¸ì› ë²„íŠ¼ ë³µì›
            document.querySelectorAll('.people-btn').forEach(btn => {
                btn.classList.toggle('people-btn--active', btn.dataset.people === state.diningPeople);
            });

            // ìŒì‹ ì¹© ë³µì›
            document.querySelectorAll('.food-chip').forEach(chip => {
                chip.classList.toggle('food-chip--active', state.diningFoods.includes(chip.dataset.food));
            });

            // ë°”ë¡œ ê²€ìƒ‰
            this.search();
        }
    };

    /* ===== CHATBOT ===== */
    const chat={
        toggle(){state.chatOpen=!state.chatOpen;const w=$('chatWindow');if(state.chatOpen){w.classList.add('chat-window--open');$('chatInput').focus();$('chatBadge').style.display='none';$('chatTooltip').style.display='none';}else{w.classList.remove('chat-window--open');}},
        _initWelcome(){const c=$('chatMessages');c.innerHTML='';const name=state.user?state.user.name:'';this._addBotMessage(`ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”${name?', <b>'+utils.escapeHtml(name)+'</b>ë‹˜':''}! AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.\n\nìì—°ì–´ë¡œ í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì‹œë©´ ë„ì™€ë“œë¦´ê²Œìš”.\n\n<b>ğŸ’¡ ì´ëŸ° ê²ƒë“¤ì„ í•  ìˆ˜ ìˆì–´ìš”:</b>\nâ€¢ "ê³µì§€ ë“±ë¡í•´ì¤˜"\nâ€¢ "ê³µì§€ ëª©ë¡ ë³´ì—¬ì¤˜"\nâ€¢ "ê°•ë‚¨ ê³ ê¸° íšŒì‹ ì°¾ì•„ì¤˜"\nâ€¢ "ë§ˆí¬êµ¬ ì‚¼ê²¹ì‚´ 10ëª…"\n\në¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`);this._updateSuggestions(['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ íšŒì‹ ì°¾ê¸°','â“ ë„ì›€ë§']);setTimeout(()=>{if(!state.chatOpen){$('chatBadge').style.display='flex';}},3000);},
        _addMessage(html,isUser){const c=$('chatMessages');const w=document.createElement('div');w.className=`chat-msg chat-msg--${isUser?'user':'bot'}`;w.innerHTML=`<div class="chat-msg__bubble">${html.replace(/\n/g,'<br>')}</div><div class="chat-msg__time">${utils.formatTime(new Date())}</div>`;c.appendChild(w);c.scrollTop=c.scrollHeight;},
        _addBotMessage(html){this._addMessage(html,false);},
        _addUserMessage(text){this._addMessage(utils.escapeHtml(text),true);},
        _showTyping(){const c=$('chatMessages');const el=document.createElement('div');el.className='chat-typing';el.id='chatTypingIndicator';el.innerHTML='<span></span><span></span><span></span>';c.appendChild(el);c.scrollTop=c.scrollHeight;},
        _hideTyping(){const el=$('chatTypingIndicator');if(el)el.remove();},
        _updateSuggestions(items){$('chatSuggestions').innerHTML=items.map(item=>{const clean=item.replace(/^[ğŸ“ğŸ“‹ğŸ”â“ğŸ—‘ï¸âœï¸ğŸ½ï¸#\s]+/,'').trim();return`<button class="chat-suggest-btn" onclick="App.chat.quickSend('${utils.escapeHtml(clean)}')">${item}</button>`;}).join('');},
        quickSend(text){$('chatInput').value=text;this.send();},
        async send(){const input=$('chatInput');const text=input.value.trim();if(!text)return;input.value='';$('chatSendBtn').disabled=true;this._addUserMessage(text);this._showTyping();await new Promise(r=>setTimeout(r,350+Math.random()*350));this._hideTyping();const response=await this._processCommand(text);this._addBotMessage(response.message);if(response.suggestions)this._updateSuggestions(response.suggestions);$('chatSendBtn').disabled=false;$('chatInput').focus();},
        _renderNoticeCard(n,index){return`<div class="chat-notice-card"><div class="chat-notice-card__title">${index!==undefined?(index+1)+'. ':''}${utils.escapeHtml(n.title)}</div><div class="chat-notice-card__content">${utils.escapeHtml(utils.truncate(n.content,80))}</div><div class="chat-notice-card__meta"><span>ğŸ‘¤ ${utils.escapeHtml(n.author)}</span><span>ğŸ“… ${utils.formatDate(n.createdAt)}</span></div><div class="chat-notice-card__actions"><button class="chat-action-view" onclick="App.router.go('notices')">ë³´ê¸°</button><button class="chat-action-edit" onclick="App.notices.open('${n.id}')">ìˆ˜ì •</button><button class="chat-action-delete" onclick="App.notices.delete('${n.id}')">ì‚­ì œ</button></div></div>`;},

        async _processCommand(text){
            const lower=text.replace(/\s+/g,' ').trim().toLowerCase();
            if(state.chatContext)return await this._handleContext(text);

            // ---- DINING via Chat ----
            const diningPatterns=[/íšŒì‹/,/ë§›ì§‘/,/ìŒì‹ì /,/ì‹ë‹¹/,/ë°¥\s*ë¨¹/,/ì €ë…\s*ë¨¹/,/ê³ ê¸°.*(?:ì°¾|ê²€ìƒ‰|ì¶”ì²œ)/,/ì‚¼ê²¹ì‚´.*(?:ì°¾|ê²€ìƒ‰|ì¶”ì²œ)/,/ë¨¹ìœ¼ëŸ¬/];
            if(diningPatterns.some(p=>p.test(lower))){
                // Try to extract area and food
                const areas=['ê°•ë‚¨','ê°•ë™','ê°•ë¶','ê°•ì„œ','ê´€ì•…','ê´‘ì§„','êµ¬ë¡œ','ê¸ˆì²œ','ë…¸ì›','ë„ë´‰','ë™ëŒ€ë¬¸','ë™ì‘','ë§ˆí¬','ì„œëŒ€ë¬¸','ì„œì´ˆ','ì„±ë™','ì„±ë¶','ì†¡íŒŒ','ì–‘ì²œ','ì˜ë“±í¬','ìš©ì‚°','ì€í‰','ì¢…ë¡œ','ì¤‘êµ¬','ì¤‘ë‘'];
                const foodMap={'ê³ ê¸°':'ê³ ê¸° ë§›ì§‘','ì‚¼ê²¹ì‚´':'ì‚¼ê²¹ì‚´','ì†Œê³ ê¸°':'ì†Œê³ ê¸° ë§›ì§‘','ì¹˜í‚¨':'ì¹˜í‚¨ ë§›ì§‘','íšŒ':'íšŒ í•´ì‚°ë¬¼','í•´ì‚°ë¬¼':'íšŒ í•´ì‚°ë¬¼','ì´ˆë°¥':'ì´ˆë°¥ ì¼ì‹','ì¼ì‹':'ì´ˆë°¥ ì¼ì‹','ì¤‘ì‹':'ì¤‘ì‹ ì¤‘êµ­ì§‘','ì¤‘êµ­':'ì¤‘ì‹ ì¤‘êµ­ì§‘','ì–‘ì‹':'ì–‘ì‹ íŒŒìŠ¤íƒ€','íŒŒìŠ¤íƒ€':'ì–‘ì‹ íŒŒìŠ¤íƒ€','í•œì‹':'í•œì‹ í•œì •ì‹','í•œì •ì‹':'í•œì‹ í•œì •ì‹','ì¡±ë°œ':'ì¡±ë°œ ë³´ìŒˆ','ë³´ìŒˆ':'ì¡±ë°œ ë³´ìŒˆ','ê³±ì°½':'ê³±ì°½ ë§‰ì°½','ë§‰ì°½':'ê³±ì°½ ë§‰ì°½','ì°œ':'ì°œ íƒ• ì°Œê°œ','íƒ•':'ì°œ íƒ• ì°Œê°œ','ì°Œê°œ':'ì°œ íƒ• ì°Œê°œ','í”¼ì':'í”¼ì','íƒœêµ­':'íƒœêµ­ ë™ë‚¨ì•„ ìŒì‹','ë™ë‚¨ì•„':'íƒœêµ­ ë™ë‚¨ì•„ ìŒì‹','íƒ€ì½”':'ë©•ì‹œì¹¸ íƒ€ì½”','ìˆ ì§‘':'ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼','í˜¸í”„':'ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼','ì´ìì¹´ì•¼':'ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼','ì™€ì¸':'ì™€ì¸ë°” ì™€ì¸','ë·”í˜':'ë·”í˜','ì¹´í˜':'ë² ì´ì»¤ë¦¬ ì¹´í˜'};

                let foundArea='';
                for(const a of areas){if(lower.includes(a)){foundArea=a+'êµ¬';if(a==='ì¤‘êµ¬')foundArea='ì¤‘êµ¬';break;}}

                let foundFoods=[];
                for(const[keyword,value]of Object.entries(foodMap)){if(lower.includes(keyword)&&!foundFoods.includes(value))foundFoods.push(value);}

                // Extract people count
                const pMatch=lower.match(/(\d+)\s*ëª…/);
                let people='';
                if(pMatch){const n=parseInt(pMatch[1]);if(n<=4)people='2~4ëª…';else if(n<=10)people='5~10ëª…';else if(n<=20)people='10~20ëª…';else people='20ëª…ì´ìƒ';}

                if(foundArea&&foundFoods.length>0){
                    let query='ì„œìš¸ '+foundArea+' '+foundFoods.join(' ');
                    if(people==='10~20ëª…'||people==='20ëª…ì´ìƒ')query+=' ë‹¨ì²´ì„';
                    query+=' ë§›ì§‘';
                    const url='https://map.naver.com/p/search/'+encodeURIComponent(query);
                    window.open(url,'_blank');

                    const record={area:foundArea,foods:foundFoods,people,query,date:new Date().toISOString()};
                    let history=storage.get('diningHistory')||[];history.unshift(record);storage.set('diningHistory',history.slice(0,10));
                    dining.renderHistory();

                    return{message:`ğŸ½ï¸ ë„¤ì´ë²„ ì§€ë„ì—ì„œ ê²€ìƒ‰í–ˆì–´ìš”!\n\nğŸ“ <b>${utils.escapeHtml(foundArea)}</b>\nğŸ´ <b>${foundFoods.join(', ')}</b>${people?'\nğŸ‘¥ <b>'+people+'</b>':''}\n\nğŸ”— ìƒˆ íƒ­ì—ì„œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ ë‹¤ë¥¸ íšŒì‹ ì°¾ê¸°','â“ ë„ì›€ë§']};
                }

                if(foundArea&&foundFoods.length===0){
                    state.chatContext={type:'dining',step:'food',area:foundArea,people};
                    return{message:`ğŸ“ <b>${utils.escapeHtml(foundArea)}</b>ì—ì„œ ê²€ìƒ‰í• ê²Œìš”!\n\nì–´ë–¤ ì¢…ë¥˜ì˜ ìŒì‹ì„ ì›í•˜ì‹œë‚˜ìš”?\nì˜ˆ: ê³ ê¸°, ì‚¼ê²¹ì‚´, íšŒ, ì¤‘ì‹, ì¹˜í‚¨ ë“±`,suggestions:['ğŸ¥© ê³ ê¸°','ğŸ· ì‚¼ê²¹ì‚´','ğŸŸ íšŒ','ğŸ£ ì¼ì‹','ğŸ ì–‘ì‹','ğŸº ìˆ ì§‘']};
                }

                if(!foundArea){
                    state.chatContext={type:'dining',step:'area',foods:foundFoods,people};
                    return{message:`ğŸ½ï¸ íšŒì‹ ì¥ì†Œë¥¼ ì°¾ì•„ë“œë¦´ê²Œìš”!\n\nì„œìš¸ ì–´ëŠ ì§€ì—­ì—ì„œ ì°¾ìœ¼ì‹œë‚˜ìš”?\nì˜ˆ: ê°•ë‚¨, ë§ˆí¬, ì¢…ë¡œ, í™ëŒ€ ë“±`,suggestions:['ê°•ë‚¨','ë§ˆí¬','ì¢…ë¡œ','ì„œì´ˆ','ì˜ë“±í¬','ì†¡íŒŒ']};
                }
            }

            // ---- REGISTER ----
            const registerPatterns=[/^ê³µì§€\s*ë“±ë¡/,/ê³µì§€.*(?:ì˜¬ë ¤|ì‘ì„±|ë“±ë¡|ë§Œë“¤ì–´|ì¨|ìƒì„±|ì¶”ê°€)/,/(?:ì˜¬ë ¤|ì‘ì„±|ë“±ë¡|ë§Œë“¤ì–´|ì¨|ìƒì„±|ì¶”ê°€).*ê³µì§€/,/^(?:ìƒˆ|ì‹ ê·œ)\s*ê³µì§€/,/ê³µì§€.*(?:í•´ì¤˜|í•´ì£¼ì„¸ìš”|ë¶€íƒ)/];
            if(registerPatterns.some(p=>p.test(lower))){let cleaned=text.replace(/^ê³µì§€\s*ë“±ë¡\s*/,'').replace(/ê³µì§€\s*(?:ì˜¬ë ¤|ì‘ì„±|ë“±ë¡|ë§Œë“¤ì–´|ì¨|ìƒì„±|ì¶”ê°€)\s*/g,'').replace(/(?:ì˜¬ë ¤|ì‘ì„±|ë“±ë¡|ë§Œë“¤ì–´|ì¨|ìƒì„±|ì¶”ê°€)\s*.*?ê³µì§€\s*/g,'').replace(/ìƒˆ\s*ê³µì§€\s*/g,'').replace(/(?:í•´ì¤˜|í•´ì£¼ì„¸ìš”|í•´ ì¤˜|ë¶€íƒ|ì¢€)/g,'').trim();if(!cleaned||cleaned.length<2){state.chatContext={type:'register',step:'title'};return{message:'ğŸ“ ê³µì§€ì‚¬í•­ì„ ë“±ë¡í• ê²Œìš”!\n\në¨¼ì € <b>ì œëª©</b>ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',suggestions:['ì·¨ì†Œ']};}const si=cleaned.indexOf(' ');if(si===-1){state.chatContext={type:'register',step:'content',title:cleaned};return{message:`ğŸ“ ì œëª©: <b>${utils.escapeHtml(cleaned)}</b>\n\nì´ì œ <b>ë‚´ìš©</b>ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`,suggestions:['ì·¨ì†Œ']};}const title=cleaned.substring(0,si),body=cleaned.substring(si+1);state.chatContext={type:'register',step:'confirm',title,content:body};return{message:`ğŸ“ ë‹¤ìŒ ë‚´ìš©ìœ¼ë¡œ ê³µì§€ë¥¼ ë“±ë¡í• ê¹Œìš”?\n\n<b>ì œëª©:</b> ${utils.escapeHtml(title)}\n<b>ë‚´ìš©:</b> ${utils.escapeHtml(body)}\n\n"<b>ë“±ë¡</b>" ë˜ëŠ” "<b>ì·¨ì†Œ</b>"`,suggestions:['âœ… ë“±ë¡','âŒ ì·¨ì†Œ','âœï¸ ìˆ˜ì •']};}
            
            // ---- LIST ----
            if([/^ê³µì§€\s*ëª©ë¡/,/ê³µì§€.*(?:ë³´ì—¬|í™•ì¸|ì¡°íšŒ|ë¦¬ìŠ¤íŠ¸|ëª©ë¡|ë³´ê¸°|ì•Œë ¤)/,/(?:ì „ì²´|ëª¨ë“ |ìµœê·¼)\s*ê³µì§€/,/ê³µì§€.*(?:ë­|ëª‡|ìˆ|ì–´ë–¤)/].some(p=>p.test(lower))){await notices._load();if(!state.notices.length)return{message:'ğŸ“‹ ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.\n\nìƒˆ ê³µì§€ë¥¼ ë“±ë¡í•´ë³´ì‹œê² ì–´ìš”?',suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','â“ ë„ì›€ë§']};let html=`ğŸ“‹ <b>ì „ì²´ ê³µì§€ì‚¬í•­ (${state.notices.length}ê±´)</b>\n`;state.notices.slice(0,5).forEach((n,i)=>{html+=this._renderNoticeCard(n,i);});if(state.notices.length>5)html+=`\n<span style="color:var(--c-s400)">...ì™¸ ${state.notices.length-5}ê±´</span>`;return{message:html,suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ” ê³µì§€ ê²€ìƒ‰','ğŸ—‘ï¸ ê³µì§€ ì‚­ì œ']};}

            // ---- SEARCH ----
            if([/^ê³µì§€\s*ê²€ìƒ‰/,/ê³µì§€.*ê²€ìƒ‰/,/ê²€ìƒ‰.*ê³µì§€/,/ê³µì§€.*ì°¾ì•„/,/ì°¾ì•„.*ê³µì§€/].some(p=>p.test(lower))){let kw=text.replace(/ê³µì§€\s*ê²€ìƒ‰\s*/g,'').replace(/ê²€ìƒ‰\s*/g,'').replace(/ê³µì§€\s*/g,'').replace(/(?:ì°¾ì•„|ì¤˜|ì£¼ì„¸ìš”|í•´ì¤˜|ì¢€)/g,'').trim();if(!kw){state.chatContext={type:'search'};return{message:'ğŸ” ê²€ìƒ‰í•  <b>í‚¤ì›Œë“œ</b>ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',suggestions:['ì·¨ì†Œ']};}return await this._doSearch(kw);}

            // ---- DELETE ----
            if([/^ê³µì§€\s*ì‚­ì œ/,/ê³µì§€.*ì‚­ì œ/,/ì‚­ì œ.*ê³µì§€/,/ê³µì§€.*(?:ì§€ì›Œ|ì—†ì• |ì œê±°)/].some(p=>p.test(lower))){await notices._load();const numM=lower.match(/(\d+)/);if(numM){const idx=parseInt(numM[1])-1;if(idx>=0&&idx<state.notices.length){const t=state.notices[idx];state.chatContext={type:'delete',step:'confirm',noticeId:t.id,noticeTitle:t.title};return{message:`ğŸ—‘ï¸ ì‚­ì œí• ê¹Œìš”?\n${this._renderNoticeCard(t)}\n\n"<b>ì‚­ì œ</b>" ë˜ëŠ” "<b>ì·¨ì†Œ</b>"`,suggestions:['âœ… ì‚­ì œ','âŒ ì·¨ì†Œ']};}}let kw=text.replace(/ê³µì§€\s*ì‚­ì œ\s*/g,'').replace(/ì‚­ì œ\s*/g,'').replace(/ê³µì§€\s*/g,'').replace(/(?:ì§€ì›Œ|ì—†ì• |ì œê±°|ì¤˜|ì£¼ì„¸ìš”|í•´ì¤˜|ì¢€)/g,'').trim();if(kw){const found=state.notices.find(n=>n.title.includes(kw));if(found){state.chatContext={type:'delete',step:'confirm',noticeId:found.id,noticeTitle:found.title};return{message:`ğŸ—‘ï¸ ì‚­ì œí• ê¹Œìš”?\n${this._renderNoticeCard(found)}\n\n"<b>ì‚­ì œ</b>" ë˜ëŠ” "<b>ì·¨ì†Œ</b>"`,suggestions:['âœ… ì‚­ì œ','âŒ ì·¨ì†Œ']};}return{message:`âŒ "${utils.escapeHtml(kw)}" ê³µì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ” ê³µì§€ ê²€ìƒ‰']};}if(!state.notices.length)return{message:'ğŸ“‹ ì‚­ì œí•  ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.',suggestions:['ğŸ“ ê³µì§€ ë“±ë¡']};let html='ğŸ—‘ï¸ ì‚­ì œí•  ê³µì§€ <b>ë²ˆí˜¸</b>ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n';state.notices.slice(0,5).forEach((n,i)=>{html+=this._renderNoticeCard(n,i);});state.chatContext={type:'delete',step:'select'};return{message:html,suggestions:['ì·¨ì†Œ']};}

            // ---- EDIT ----
            if([/^ê³µì§€\s*ìˆ˜ì •/,/ê³µì§€.*ìˆ˜ì •/,/ìˆ˜ì •.*ê³µì§€/,/ê³µì§€.*(?:ë°”ê¿”|ë³€ê²½|ê³ ì³|í¸ì§‘)/].some(p=>p.test(lower))){await notices._load();const numM=lower.match(/(\d+)/);if(numM){const idx=parseInt(numM[1])-1;if(idx>=0&&idx<state.notices.length){const t=state.notices[idx];notices.open(t.id);return{message:`âœï¸ <b>${utils.escapeHtml(t.title)}</b> ìˆ˜ì • ì°½ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}}if(!state.notices.length)return{message:'ğŸ“‹ ìˆ˜ì •í•  ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.',suggestions:['ğŸ“ ê³µì§€ ë“±ë¡']};let html='âœï¸ ìˆ˜ì •í•  ê³µì§€ <b>ë²ˆí˜¸</b>ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n';state.notices.slice(0,5).forEach((n,i)=>{html+=this._renderNoticeCard(n,i);});state.chatContext={type:'edit',step:'select'};return{message:html,suggestions:['ì·¨ì†Œ']};}

            // ---- HELP ----
            if(/^(?:ë„ì›€ë§|ë„ì›€|help|\?|ëª…ë ¹ì–´|ì‚¬ìš©ë²•|ê¸°ëŠ¥)/.test(lower)){return{message:`ğŸ“Œ <b>ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥</b>\n\nğŸ“ <b>ê³µì§€ ë“±ë¡</b> â€” "ê³µì§€ ë“±ë¡í•´ì¤˜"\nğŸ“‹ <b>ê³µì§€ ëª©ë¡</b> â€” "ê³µì§€ ë³´ì—¬ì¤˜"\nğŸ” <b>ê³µì§€ ê²€ìƒ‰</b> â€” "ê³µì§€ ê²€ìƒ‰ íšŒì˜"\nâœï¸ <b>ê³µì§€ ìˆ˜ì •</b> â€” "1ë²ˆ ê³µì§€ ìˆ˜ì •"\nğŸ—‘ï¸ <b>ê³µì§€ ì‚­ì œ</b> â€” "ê³µì§€ ì‚­ì œ íšŒì˜"\nğŸ½ï¸ <b>íšŒì‹ ì°¾ê¸°</b> â€” "ê°•ë‚¨ ê³ ê¸° íšŒì‹ ì°¾ì•„ì¤˜"\nğŸ“Š <b>í˜„í™©</b> â€” "ê³µì§€ì‚¬í•­ í˜„í™©"\n\nğŸ’¡ ìì—°ì–´ë¡œ í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!`,suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ íšŒì‹ ì°¾ê¸°']};}

            if(/ì•ˆë…•|í•˜ì´|í—¬ë¡œ|hello|hi|ë°˜ê°€/.test(lower)){return{message:`ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, <b>${utils.escapeHtml(state.user.name)}</b>ë‹˜!`,suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ íšŒì‹ ì°¾ê¸°','â“ ë„ì›€ë§']};}
            if(/ê³ ë§ˆ|ê°ì‚¬|ë•¡í|thank/.test(lower)){return{message:`ğŸ˜Š ë„ì›€ì´ ë˜ì—ˆë‹¤ë‹ˆ ê¸°ì©ë‹ˆë‹¤!`,suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ íšŒì‹ ì°¾ê¸°']};}
            if(/í˜„í™©|í†µê³„|ìƒíƒœ|ìš”ì•½/.test(lower)){await notices._load();const c=state.notices.length;return{message:`ğŸ“Š <b>í˜„í™©</b>\n\nâ€¢ ì „ì²´ ê³µì§€: <b>${c}ê±´</b>\nâ€¢ ìµœê·¼ ë“±ë¡ì¼: <b>${c>0?utils.formatDate(state.notices[0].createdAt):'ì—†ìŒ'}</b>`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}

            return{message:`ğŸ¤– ìš”ì²­ì„ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”.\n\nâ€¢ "ê³µì§€ ë“±ë¡í•´ì¤˜"\nâ€¢ "ê³µì§€ ëª©ë¡ ë³´ì—¬ì¤˜"\nâ€¢ "ê°•ë‚¨ ê³ ê¸° íšŒì‹ ì°¾ì•„ì¤˜"\n\n<b>ë„ì›€ë§</b>ì„ ì…ë ¥í•´ë³´ì„¸ìš”.`,suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ íšŒì‹ ì°¾ê¸°','â“ ë„ì›€ë§']};
        },

        async _handleContext(text){
            const lower=text.trim().toLowerCase();const ctx=state.chatContext;
            if(/^(?:ì·¨ì†Œ|ìº”ìŠ¬|cancel|ê·¸ë§Œ|ëŒì•„ê°€)/.test(lower)){state.chatContext=null;return{message:'â†©ï¸ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.',suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ íšŒì‹ ì°¾ê¸°','â“ ë„ì›€ë§']};}

            // DINING CONTEXT
            if(ctx.type==='dining'){
                if(ctx.step==='area'){
                    const areas={'ê°•ë‚¨':'ê°•ë‚¨êµ¬','ê°•ë™':'ê°•ë™êµ¬','ê°•ë¶':'ê°•ë¶êµ¬','ê°•ì„œ':'ê°•ì„œêµ¬','ê´€ì•…':'ê´€ì•…êµ¬','ê´‘ì§„':'ê´‘ì§„êµ¬','êµ¬ë¡œ':'êµ¬ë¡œêµ¬','ê¸ˆì²œ':'ê¸ˆì²œêµ¬','ë…¸ì›':'ë…¸ì›êµ¬','ë„ë´‰':'ë„ë´‰êµ¬','ë™ëŒ€ë¬¸':'ë™ëŒ€ë¬¸êµ¬','ë™ì‘':'ë™ì‘êµ¬','ë§ˆí¬':'ë§ˆí¬êµ¬','ì„œëŒ€ë¬¸':'ì„œëŒ€ë¬¸êµ¬','ì„œì´ˆ':'ì„œì´ˆêµ¬','ì„±ë™':'ì„±ë™êµ¬','ì„±ë¶':'ì„±ë¶êµ¬','ì†¡íŒŒ':'ì†¡íŒŒêµ¬','ì–‘ì²œ':'ì–‘ì²œêµ¬','ì˜ë“±í¬':'ì˜ë“±í¬êµ¬','ìš©ì‚°':'ìš©ì‚°êµ¬','ì€í‰':'ì€í‰êµ¬','ì¢…ë¡œ':'ì¢…ë¡œêµ¬','ì¤‘êµ¬':'ì¤‘êµ¬','ì¤‘ë‘':'ì¤‘ë‘êµ¬','í™ëŒ€':'ë§ˆí¬êµ¬','ì‹ ì´Œ':'ì„œëŒ€ë¬¸êµ¬','ì´íƒœì›':'ìš©ì‚°êµ¬','ê±´ëŒ€':'ê´‘ì§„êµ¬','ì ì‹¤':'ì†¡íŒŒêµ¬','ì—¬ì˜ë„':'ì˜ë“±í¬êµ¬'};
                    let foundArea='';for(const[k,v]of Object.entries(areas)){if(lower.includes(k)){foundArea=v;break;}}
                    if(!foundArea){return{message:'âŒ ì„œìš¸ ì§€ì—­ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\nì˜ˆ: ê°•ë‚¨, ë§ˆí¬, ì¢…ë¡œ, í™ëŒ€',suggestions:['ê°•ë‚¨','ë§ˆí¬','ì¢…ë¡œ','ì„œì´ˆ','ì·¨ì†Œ']};}
                    if(ctx.foods&&ctx.foods.length>0){
                        let query='ì„œìš¸ '+foundArea+' '+ctx.foods.join(' ')+' ë§›ì§‘';
                        const url='https://map.naver.com/p/search/'+encodeURIComponent(query);window.open(url,'_blank');
                        state.chatContext=null;
                        return{message:`ğŸ½ï¸ ê²€ìƒ‰ ì™„ë£Œ!\n\nğŸ“ <b>${foundArea}</b>\nğŸ´ <b>${ctx.foods.join(', ')}</b>\n\nìƒˆ íƒ­ì„ í™•ì¸í•´ì£¼ì„¸ìš”!`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ ë‹¤ë¥¸ íšŒì‹','â“ ë„ì›€ë§']};
                    }
                    state.chatContext={type:'dining',step:'food',area:foundArea,people:ctx.people||''};
                    return{message:`ğŸ“ <b>${foundArea}</b> ì„ íƒ!\n\nì–´ë–¤ ìŒì‹ì„ ì›í•˜ì‹œë‚˜ìš”?`,suggestions:['ğŸ¥© ê³ ê¸°','ğŸ· ì‚¼ê²¹ì‚´','ğŸŸ íšŒ','ğŸ£ ì¼ì‹','ğŸ ì–‘ì‹','ğŸº ìˆ ì§‘']};
                }
                if(ctx.step==='food'){
                    const foodMap={'ê³ ê¸°':'ê³ ê¸° ë§›ì§‘','ì‚¼ê²¹ì‚´':'ì‚¼ê²¹ì‚´','ì†Œê³ ê¸°':'ì†Œê³ ê¸° ë§›ì§‘','ì¹˜í‚¨':'ì¹˜í‚¨ ë§›ì§‘','íšŒ':'íšŒ í•´ì‚°ë¬¼','í•´ì‚°ë¬¼':'íšŒ í•´ì‚°ë¬¼','ì´ˆë°¥':'ì´ˆë°¥ ì¼ì‹','ì¼ì‹':'ì´ˆë°¥ ì¼ì‹','ì¤‘ì‹':'ì¤‘ì‹ ì¤‘êµ­ì§‘','ì–‘ì‹':'ì–‘ì‹ íŒŒìŠ¤íƒ€','íŒŒìŠ¤íƒ€':'ì–‘ì‹ íŒŒìŠ¤íƒ€','í•œì‹':'í•œì‹ í•œì •ì‹','ì¡±ë°œ':'ì¡±ë°œ ë³´ìŒˆ','ë³´ìŒˆ':'ì¡±ë°œ ë³´ìŒˆ','ê³±ì°½':'ê³±ì°½ ë§‰ì°½','í”¼ì':'í”¼ì','ìˆ ì§‘':'ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼','í˜¸í”„':'ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼','ì´ìì¹´ì•¼':'ìˆ ì§‘ í˜¸í”„ ì´ìì¹´ì•¼','ì™€ì¸':'ì™€ì¸ë°” ì™€ì¸','ë·”í˜':'ë·”í˜','ì¹´í˜':'ë² ì´ì»¤ë¦¬ ì¹´í˜'};
                    let foods=[];for(const[k,v]of Object.entries(foodMap)){if(lower.includes(k)&&!foods.includes(v))foods.push(v);}
                    if(foods.length===0)foods=[text.trim()];

                    let query='ì„œìš¸ '+ctx.area+' '+foods.join(' ');
                    if(ctx.people==='10~20ëª…'||ctx.people==='20ëª…ì´ìƒ')query+=' ë‹¨ì²´ì„';
                    query+=' ë§›ì§‘';
                    const url='https://map.naver.com/p/search/'+encodeURIComponent(query);window.open(url,'_blank');

                    const record={area:ctx.area,foods,people:ctx.people,query,date:new Date().toISOString()};
                    let history=storage.get('diningHistory')||[];history.unshift(record);storage.set('diningHistory',history.slice(0,10));
                    dining.renderHistory();
                    state.chatContext=null;
                    return{message:`ğŸ½ï¸ ê²€ìƒ‰ ì™„ë£Œ!\n\nğŸ“ <b>${utils.escapeHtml(ctx.area)}</b>\nğŸ´ <b>${foods.join(', ')}</b>${ctx.people?'\nğŸ‘¥ <b>'+ctx.people+'</b>':''}\n\nìƒˆ íƒ­ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”!`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ½ï¸ ë‹¤ë¥¸ íšŒì‹','â“ ë„ì›€ë§']};
                }
            }

            // REGISTER
            if(ctx.type==='register'){
                if(ctx.step==='title'){state.chatContext={type:'register',step:'content',title:text.trim()};return{message:`ğŸ“ ì œëª©: <b>${utils.escapeHtml(text.trim())}</b>\n\n<b>ë‚´ìš©</b>ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`,suggestions:['ì·¨ì†Œ']};}
                if(ctx.step==='content'){state.chatContext={type:'register',step:'confirm',title:ctx.title,content:text.trim()};return{message:`ğŸ“ ë“±ë¡í• ê¹Œìš”?\n\n<b>ì œëª©:</b> ${utils.escapeHtml(ctx.title)}\n<b>ë‚´ìš©:</b> ${utils.escapeHtml(text.trim())}\n\n"<b>ë“±ë¡</b>" ë˜ëŠ” "<b>ì·¨ì†Œ</b>"`,suggestions:['âœ… ë“±ë¡','âŒ ì·¨ì†Œ']};}
                if(ctx.step==='confirm'){if(/^(?:ë“±ë¡|í™•ì¸|ë„¤|ì˜ˆ|yes|ok|ã…‡|ì‘)/.test(lower)){try{await notices._db().add({title:ctx.title,content:ctx.content,author:state.user.name,authorEmail:state.user.email,createdAt:new Date().toISOString()});await notices._load();ui.renderNotices();ui.renderDashboard();state.chatContext=null;return{message:`âœ… ë“±ë¡ ì™„ë£Œ!\n${this._renderNoticeCard(state.notices[0])}`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}catch{state.chatContext=null;return{message:'âŒ ë“±ë¡ ì‹¤íŒ¨',suggestions:['ğŸ“ ê³µì§€ ë“±ë¡']};}}state.chatContext=null;return{message:'â†©ï¸ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.',suggestions:['ğŸ“ ê³µì§€ ë“±ë¡','ğŸ“‹ ê³µì§€ ëª©ë¡','â“ ë„ì›€ë§']};}
            }

            // DELETE
            if(ctx.type==='delete'){
                if(ctx.step==='select'){const num=parseInt(lower);if(!isNaN(num)&&num>=1&&num<=state.notices.length){const t=state.notices[num-1];state.chatContext={type:'delete',step:'confirm',noticeId:t.id,noticeTitle:t.title};return{message:`ğŸ—‘ï¸ ì‚­ì œí• ê¹Œìš”?\n${this._renderNoticeCard(t)}\n\n"<b>ì‚­ì œ</b>" ë˜ëŠ” "<b>ì·¨ì†Œ</b>"`,suggestions:['âœ… ì‚­ì œ','âŒ ì·¨ì†Œ']};}return{message:'âŒ ì˜¬ë°”ë¥¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.',suggestions:['ì·¨ì†Œ']};}
                if(ctx.step==='confirm'){if(/^(?:ì‚­ì œ|í™•ì¸|ë„¤|ì˜ˆ|yes|ok|ã…‡|ì‘)/.test(lower)){try{await notices._db().doc(ctx.noticeId).delete();await notices._load();ui.renderNotices();ui.renderDashboard();state.chatContext=null;return{message:`âœ… "<b>${utils.escapeHtml(ctx.noticeTitle)}</b>" ì‚­ì œ ì™„ë£Œ!`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}catch{state.chatContext=null;return{message:'âŒ ì‚­ì œ ì‹¤íŒ¨',suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡']};}}state.chatContext=null;return{message:'â†©ï¸ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.',suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}
            }

            // EDIT
            if(ctx.type==='edit'&&ctx.step==='select'){const num=parseInt(lower);if(!isNaN(num)&&num>=1&&num<=state.notices.length){const t=state.notices[num-1];notices.open(t.id);state.chatContext=null;return{message:`âœï¸ <b>${utils.escapeHtml(t.title)}</b> ìˆ˜ì • ì°½ ì—´ë¦¼`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}return{message:'âŒ ì˜¬ë°”ë¥¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.',suggestions:['ì·¨ì†Œ']};}

            // SEARCH
            if(ctx.type==='search'){state.chatContext=null;return await this._doSearch(text.trim());}

            state.chatContext=null;return await this._processCommand(text);
        },

        async _doSearch(kw){await notices._load();const r=state.notices.filter(n=>n.title.toLowerCase().includes(kw.toLowerCase())||n.content.toLowerCase().includes(kw.toLowerCase()));if(!r.length)return{message:`ğŸ” "${utils.escapeHtml(kw)}" ê²°ê³¼ ì—†ìŒ`,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};let html=`ğŸ” "${utils.escapeHtml(kw)}" ê²°ê³¼ (${r.length}ê±´)\n`;r.slice(0,5).forEach((n,i)=>{html+=this._renderNoticeCard(n,i);});return{message:html,suggestions:['ğŸ“‹ ê³µì§€ ëª©ë¡','ğŸ“ ê³µì§€ ë“±ë¡']};}
    };

    /* INIT */
    async function init(){toast.init();$('chatbotContainer').style.display='none';$('chatTooltip').style.display='none';await fb.init();gis.load().catch(()=>{});
        document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){$('noticeModal').hidden=true;$('confirmModal').hidden=true;if(state.chatOpen)chat.toggle();}});
        ['noticeModal','confirmModal'].forEach(id=>{$(id).addEventListener('click',(e)=>{if(e.target===e.currentTarget)e.currentTarget.hidden=true;});});
        // Load dining history
        state.diningHistory=storage.get('diningHistory')||[];
    }
    if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',init);else init();

    return Object.freeze({auth,router,notices,ui,chat,dining});
})();
</script>
</body>
</html>
